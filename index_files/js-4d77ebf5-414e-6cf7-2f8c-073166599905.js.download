function hiddenRecaptchaLoad(){$(".evo-recaptcha").each(function(){if(typeof $(this).data("recaptchaid")=="undefined"){var n=$(this).attr("id"),i=$(this).data("sitekey"),t=grecaptcha.render(n,{sitekey:i,callback:function(){EVO.recaptcha[n]&&$.isFunction(EVO.recaptcha[n])&&EVO.recaptcha[n]();grecaptcha.reset(t)},size:"invisible"});$(this).data("recaptchaid",t)}})}function removeHash(){var t,i,n=window.location;"pushState"in history?history.pushState("",document.title,n.pathname+n.search):(t=document.body.scrollTop,i=document.body.scrollLeft,n.hash="",document.body.scrollTop=t,document.body.scrollLeft=i)}function waitForCdnImage(n,t){$.ajax({url:n,cache:!1,type:"GET",success:t,error:function(){setTimeout(function(){waitForCdnImage(n,t)},1e3)}})}function LazyLoadThumbWithHover(n,t){t=$.extend({onError:function(n){var t=n.data("title");t&&n.before($("<span/>",{Class:"poster-title"}))}},t);LazyLoadImages(n,t)}function isTrue(n){return n!=undefined?typeof n=="boolean"?n:n.toLowerCase()=="true":!1}function getParameterByName(n){n=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i="[\\?&]"+n+"=([^&#]*)",r=new RegExp(i),t=r.exec(window.location.search);return t==null?"":decodeURIComponent(t[1].replace(/\+/g," "))}function getParam(n){return[getParameterByName(n),$.deparam.fragment()[n]].filter(function(n){return n}).join()}function LazyLoadImages(n,t){if(typeof $().lazy=="function"){t=$.extend({effect:"fadeIn",effectTime:"fast",bind:"event",visibleOnly:!0},t);var i=!1;return n==null&&(n=$("body"),i=!0),n.jquery||(n=$(n)),i||(t.appendScroll=n),$("img.lazy,div.lazy",n).lazy(t)}}function onYouTubePlayerAPIReady(){ytplayer=new YT.Player("ytplayer",{playerVars:{playlist:$("#ytplayer").data("ytid")}})}function onYouTubeIframeAPIReady(){var n=$("body").data("youtube-listener");$.isFunction(n)&&(n.call(),$("body").data("youtube-listener",null))}function ValueChange(){onVmeReady()}function isOldTicketing(){return $(".remaining-total .total").length>0}function onVmeReady(){var n,i,t;if(V.ecRepeatCounter=1,n=0,isOldTicketing()?n=$(".remaining-total .total").html().replace("$",""):($(".payment.visa-checkout .innards .button-wrapper").stopLoading(),i=EVO.tickets.totals(),i&&(n=i.Total)),$.isFunction(V.init)&&(t=$("html.ri,html.nz").length===0,V.init({apikey:$("#VmeApiKey").val(),settings:{locale:t?"en_AU":"en_NZ",countryCode:t?"AU":"NZ",review:{buttonAction:"Pay"}},paymentRequest:{total:parseFloat(n).toFixed(2),description:"Ticket Total Amount",currencyCode:t?"AUD":"NZD"}})),$.isFunction(V.on)){V.on("payment.success",function(n){$("#VmeCallId").val(n.callid);isOldTicketing()?EVO.post({url:"/Ticketing/Order/CompleteVisaCheckoutTransaction",data:{encPaymentData:n.encPaymentData,encKey:n.encKey},success:function(n){var i=$("#step-content-wrapper"),t;i.isLoading()?V.ecRepeatCounter++:($("#CardNumber").val(n.cardNumber),$("#Email").hasValue()||$("#Email").val(n.email),$("#Name").hasValue()||$("#Name").val(n.name),$("#CardTypeId").val(n.paymentType),t=parseInt(n.expiryYY)%100,$("#CardExpiry").setVal(n.expiryMM.padLeft(2,"0")+"/"+t.padLeft(2,"0")),$("#SelectedPaymentType").val(6),$("form.payment-form").submit())},error:function(n){EVO.Alert(n)},errorMessage:"There was an error completing the v.me order"}):($("#VmeEncPaymentData").val(n.encPaymentData),$("#VmeEncKey").val(n.encKey),EVO.tickets.sendVisaCheckoutPayment(n))});V.on("payment.cancel",function(){$("#VmeCallId").val("")});V.on("payment.error",function(n,t){$("#VmeCallId").val("");EVO.Alert(JSON.stringify(t))})}}var EVO=EVO||{},delay,ecValidator,ytplayer,asyncFor,deBouncer,$buoop,V;$(function(){EVO.click(".confirm-cancel",function(){return $(this).trigger("cancel"),$.modal.close(),!1})});EVO.Alert=function(n,t){return EVO.Message("Warning",n,t)};EVO.ClearValidationSummary=function(){var n="[data-valmsg-summary=true]",t;$(n).removeClass("validation-summary-errors").addClass("validation-summary-valid");t=$(n).find("ul");t.html("")};EVO.DisplayValidationSummary=function(n){var i="[data-valmsg-summary=true]",t;$(i).removeClass("validation-summary-valid").addClass("validation-summary-errors");t=$(i).find("ul");t.html("");n=n.split("\n");$.each(n,function(n,i){t.append("<li>"+i+"<\/li>")})};EVO.Confirm=function(n,t,i){var r={footer:'<button class="btn blue confirm-ok">Yes<\/button><button class="btn blue confirm-cancel">No<\/button>',callback:t,cancelcallback:i,header:"Warning"},u;typeof t=="object"&&(r=$.extend(r,t));u=EVO.Message(r.header,n,r);$(".confirm-ok",u).click(function(){return $.modal.close(),r.callback&&$.isFunction(r.callback)&&r.callback.apply(this),!1});$(".confirm-cancel",u).on("cancel",function(){r.cancelcallback&&$.isFunction(r.cancelcallback)&&r.cancelcallback.apply(this)});return u};EVO.Success=function(n,t){t||(t={});t.headerClass="success";EVO.Message("Success!",n,t)};EVO.Message=function(n,t,i){t=t.replace(/\n/g,"<br />");var r=$.extend({headerClass:"alert",keyboard:!0,footer:'<div><button class="btn blue confirm-cancel">Ok<\/button><\/div>',outerClass:""},i||{}),u=EVO.Guid(),f='<p class="'+r.headerClass+'">'+n+'<\/p><div class="message">'+t+"<\/div>";return $('<div class="ec-message '+u+" "+r.outerClass+'">'+f+r.footer+'<div class="clearfix"><\/div><\/div>').modal(r),$("."+u)};EVO.GetLoader=function(n){$(n).loader()};EVO.click=function(n,t,i){return $("body").on("click",n,function(n){if(i||n.preventDefault(),$(this).hasClass("isloader")){if($(this).isLoading())return!1;$(this).loading()}$.isFunction(t)&&t.call(this,n)})};EVO.change=function(n,t){$("body").on("change",n,function(n,i){$.isFunction(t)&&t.call(this,n,i)})};EVO.submit=function(n,t,i){$("body").on("submit",n,function(n){var r,u,h;if(i||n.preventDefault(),$.isFunction(t))t.call(this,n);else{if(r=$(this),!r.valid())return;if(u=r.submitBtn(),u.setLoading())return;var e=r.find(".evo-recaptcha"),f=e.data("recaptchaid"),o=e.length>0&&typeof f!="undefined"&&typeof grecaptcha!="undefined",s=function(){EVO.post({url:t.url||r.attr("action"),data:t.data||r.serialize(),success:function(n){if($.isFunction(t.success)){var i={btn:u,form:r,response:n};t.success.call(r,i)}o&&grecaptcha.reset(f)},error:function(n,i){if($.isFunction(t.error)){var e={btn:u,form:r,response:i};t.error.call(r,n,e)}o&&grecaptcha.reset(f)},errorMessage:t.errorMessage})};o?(h=e.attr("id"),EVO.recaptcha.init(h,s),grecaptcha.execute(f)):s()}});typeof t=="object"&&isTrue(t.resetValidation)&&$(n).resetValidation()};EVO.hover=function(n,t,i){if(!EVO.isMobile())$("body").on({mouseenter:t,mouseleave:i},n)};EVO.recaptcha={init:function(n,t){EVO.recaptcha[n]=t}};EVO.resize=function(n){$(window).smartresize(n)};EVO.hash=function(n,t){$(window).on("hashchange",n);isTrue(t)&&$(window).trigger("hashchange")};EVO.toHttpsUrl=function(n){return window.location.origin.replace("http:","https:")+n};EVO.Toast=function(n,t){var i,u,r;return t||(t={}),i=$("#toast"),i.length===0&&(i=$("<div/>").attr("id","toast").appendTo("body")),u=EVO.Guid(),t.toastClass||(t.toastClass="info"),t.timeout||(t.timeout=1500),r=$("<div/>").attr("id",u).addClass(t.toastClass).html(n).appendTo(i),r.css("right",0),t.keepAlive||setTimeout(function(){r.fadeThenSlideToggle()},t.timeout),r};EVO.LoadingToast=function(n){return n||(n="sending.."),EVO.Toast(n,{keepAlive:!0})};EVO.StopLoadingToast=function(n,t){n.Success?t.stopLoadingToastSuccess():t.stopLoadingToastError(n.Message)};EVO.ErrorToast=function(n){return EVO.Toast(n,{toastClass:"error",duration:8e3})};EVO.pushState=function(n){$.removeEmptyProperties(n);$.isEmptyObject(n)?(removeHash(),$(window).trigger("hashchange")):$.bbq.pushState(n,2)};EVO.updateState=function(n,t){var i=EVO.getState();i[n]=t;EVO.pushState(i)};EVO.waitForScriptElement=function(n,t,i){var r,u=document.getElementsByTagName("script")[0];document.getElementById(n)||(r=document.createElement("script"),r.id=n,r.onload=function(){i&&$.isFunction(i)&&i.call()},r.src=t,u.parentNode.insertBefore(r,u))};EVO.setStorage=function(n,t){typeof Storage!="undefined"&&sessionStorage.setItem(n,t)};EVO.getStorage=function(n){if(typeof Storage!="undefined")return sessionStorage.getItem(n)};EVO.getState=function(){return $.bbq.getState()};EVO.displayError=function(){var n=EVO.getState(),t=n.error;t&&(EVO.Alert(t),n.error="",EVO.pushState(n))};EVO.log=function(n){(EVO.getState().debug||$("html.debug").length>0)&&console.log(DateFormat.format.date(new Date,"HH:mm:ss.SSS")+" "+n)};EVO.toLower=function(n){return n?n.toLowerCase():""};EVO.input=function(n,t){$("body").on("input",n,t)};EVO.copyText=function(n){var t=$("<textarea>").css("display","none").addClass("copy-btn"),i;$("body").append(t);i=new Clipboard(".copy-btn",{text:function(){return n}});$(".copy-btn").trigger("click");i.destroy();t.remove()};EVO.copy=function(n){EVO.copyText(n.text())};EVO.ensureRecaptchaScriptLoaded=function(){typeof grecaptcha=="undefined"?$("body").append($.tmpl($("#recaptcha-script-template"))):hiddenRecaptchaLoad()};EVO.reset=function(n){n[0].reset();n.find(".floating-placeholder input").trigger("input")};EVO.clone=function(n){return typeof n=="undefined"?undefined:JSON.parse(JSON.stringify(n))};EVO.removeCookie=function(){var n=new Date;n.setDate(n.getDate()-1);$.cookie("evo_removeuser",null,{path:"/",expires:n})};EVO.scrollToTop=function(n){if(n){if(typeof n.jquery!="undefined")if(n.length>0)n=n.get(0);else{console.log("evoscroll: element not found");return}}else n=document.getElementById("hidden-top");n?n.scrollIntoView({behavior:"smooth",block:"start",inline:"start"}):console.log("scroll top not working")};EVO.scrollToView=function(n,t){if(n){typeof n=="string"?n=$(n):typeof n.jquery=="undefined"&&(n=$(n));t=$.extend({topBuffer:$(window).height()/3},t);var i=n.offset().top;$("html, body").animate({scrollTop:i-t.topBuffer})}else console.log("scroll top not working")};EVO.scrollToHorizontalView=function(n){var n=$.extend({wrapper:$(window),items:"> .active",buffer:100},n);n.wrapper.each(function(t,i){var r=$(i),u=1e9,s=!1,e=0,h=$(n.items,r),c,o,f;h.each(function(n,t){var i=$(t).offset().left;i<u&&(s=!0,u=i,e=$(t).outerWidth())});s&&(c=!1,o=r.offset().left+r.width(),u+e>o?(f=u-(r.scrollLeft()+o)+e+n.buffer,r.scrollLeft(f)):u<0&&(f=r.scrollLeft()+u-n.buffer,r.scrollLeft(f)))})};EVO.any=function(n){return n&&n.length>0};EVO.ploralise=function(n,t){return t===1?n:n+"s"};EVO.get=function(n){EVO.AjaxBase(n,"GET")};EVO.post=function(n){EVO.AjaxBase(n,"POST")};EVO.AjaxBase=function(n,t){var i=n.error,r;n.error=function(t){isTrue(n.handleRedirect)&&EVO.redirectResponse(t)||$.isFunction(i)&&i.call(this,n.errorMessage,t)};$.isFunction(n.success)&&(r=n.success,n.success=function(t){var u,f;(typeof t=="string"&&(t=JSON.parse(t)),u=n.toast,isTrue(n.handleRedirect)&&EVO.redirectResponse(t))||(t.Success?(u&&u.stopLoadingToastSuccess(),r(t.Data)):isTrue(t.Reauthenticate)?(u&&u.stopLoadingToastError("authentication required"),$("body").trigger("reauthenticate",n)):$.isFunction(n.error)&&(f=t.Message,n.errorMessage&&(!f||f==="Server Error")&&(f=n.errorMessage),$.isFunction(i)&&i(f,t),u&&u.stopLoadingToastError(f)))});n.type=t;EVO.DomainUrl&&n.url.startsWith("/")&&(n.url=EVO.DomainUrl+n.url,n.crossDoman=!0,n.dataType="jsonp");isTrue(n.https)&&(n.url=EVO.toHttpsUrl(n.url));$.ajax(n)};EVO.redirectResponse=function(n,t){if(typeof t=="string"&&(t={message:t}),t=$.extend({message:undefined,preRedirect:undefined},t),n&&n.Redirect){var i=function(n){$.isFunction(t.preRedirect)&&t.preRedirect.call(this,n);isTrue(n.ForceRefresh)?($(window).off("hashchange"),window.location.href=n.Redirect,location.reload()):window.location=n.Redirect};return isTrue(n.Success)?i(n):isTrue(n.RedirectOnOk)?EVO.Alert(t.message,{onClose:function(){i(n)}}):i(n),!0}return!1};EVO.ga=function(n,t,i,r){if(typeof ga!="undefined"&&$.isFunction(ga))ga("send","event",n,t,i,r);else if(typeof _gat!="undefined"&&$.isFunction(_gat._createTracker)){var u=_gat._createTracker(_gaAccountNo);u._trackEvent(n,t,i,r)}};EVO.gaEvent=function(n){typeof dataLayer!="undefined"&&dataLayer.push({event:n})};EVO.addTrans=function(n,t,i,r){if(typeof _gaq!="undefined")_gaq.push(["_addTrans",n.id,n.affiliation,n.total,n.tax,"",n.city,"",""]),$.isArray(t)&&$.each(t,function(n,t){_gaq.push(["_addItem",t.id,t.sku,t.name,t.category,t.price,t.quantity])}),$.isArray(i)&&$.each(i,function(n,t){_gaq.push(["_addItem",t.id,t.sku,t.name,t.category,t.price,t.quantity])}),_gaq.push(["_trackTrans"]);else if(typeof dataLayer!="undefined"){var u=[];$.isArray(t)&&Array.prototype.push.apply(u,t);$.isArray(i)&&Array.prototype.push.apply(u,i);r&&u.push(r);dataLayer.push({transactionId:n.id,transactionAffiliation:n.affiliation,transactionTotal:n.total,transactionTax:n.tax,transactionShipping:"",transactionProducts:u})}};delay=function(){var n=0;return function(t,i){clearTimeout(n);n=setTimeout(t,i)}}(),function(n){n.fn.loadingLight=function(t){return t&&typeof t=="boolean"&&(t={replace:!0}),t=t||{},t.additionalClass=(t.additionalClass||"")+" light",n(this).loading(t)};n.fn.loading=function(t){var u,f,i,r;if(t&&typeof t=="boolean"&&(t={replace:!0}),u=n.extend({},{additionalClass:"",adjustSize:!0,placement:"after",replace:!1},t||{}),f=EVO.Guid(),this!==undefined){if(i=n(this),r=n('<div class="ec-loading '+u.additionalClass+'" id="'+f+'"><span><\/span><\/div>'),u.placement==="after")i.siblings(".ec-loading").length===0&&(i.data("loader",f),i.data("loading",!0),r=i.after(r));else if(u.placement==="append")i.find(".ec-loading").length===0&&(i.data("loader",f),i.data("loading",!0),r=i.append(r));else throw"Unsupported loading placement";if(u.replace){if(i.data("hidden",!0),u.adjustSize)var o=i.outerWidth(),s=i.outerHeight(),e=i.css("float");i.hide();r=n("#"+f);e&&r.css("float",e);r.width(o);r.css("margin",0)}n(this).trigger("postLoading")}return this};n.fn.stopLoading=function(){if(this===undefined)n(".ec-loading").remove();else{n(this).data("loading",!1);var t=n(this).loader();t.length>0&&t.remove();n(this).trigger("postStopLoading")}return this};n.fn.loader=function(){var t=n(this).data("loader");return(n(this).data("hidden")&&n(this).show(),n.trim(t).length>0)?n("[id="+t+"]"):[]};n.fn.isLoading=function(){return n(this).data("loading")===!0};n.fn.active=function(t){return typeof t=="boolean"&&!t?n(this).removeClass("active"):n(this).addClass("active")};n.fn.inactive=function(){return n(this).removeClass("active")};n.fn.isActive=function(){return n(this).hasClass("active")};n.fn.resetCss=function(){return n(this).removeAttr("style")};n.fn.getDataArray=function(t){return n(this).map(function(){return n(this).data(t)}).get()};n.fn.showHide=function(t,i){return t?n(this).show(i):n(this).hide(i)};n.fn.fadeInOut=function(t,i){return t?n(this).fadeIn("fast",i):n(this).fadeOut("fast",i)};n.fn.sum=function(t){var i=0;return n(this).each(function(){i+=parseFloat(t.call(this))}),i}}(jQuery);$.arrayIntersect=function(n,t){return $.grep(n,function(n){return $.inArray(n,t)>-1})};typeof String.prototype.startsWith!="function"&&(String.prototype.startsWith=function(n){return this.slice(0,n.length)==n});typeof String.prototype.depascalise!="function"&&(String.prototype.depascalise=function(){return this.replace(/([a-z](?=[A-Z]))/g,"$1 ")});typeof String.prototype.trimEnd!="function"&&(String.prototype.trimEnd=function(n){return n=n||"\\s",this.replace(new RegExp("["+n+"]+$","g"),"")});typeof String.prototype.trimStart!="function"&&(String.prototype.trimStart=function(n){return n=n||"\\s",this.replace(new RegExp("^["+n+"]+","g"),"")});typeof String.prototype.commaSeparated!="function"&&(String.prototype.commaSeparated=function(){return this.split(",").filter(function(n){return n})});typeof String.prototype.commaSeparatedInts!="function"&&(String.prototype.commaSeparatedInts=function(){return this.split(",").filter(function(n){return n}).map(function(n){return parseInt(n)})});typeof String.prototype.alphaNumeric!="function"&&(String.prototype.alphaNumeric=function(){return this?this.replace(/[^a-z0-9]/gi,""):this});typeof Date.prototype.toDate!="function"&&(Date.prototype.toDate=function(){return new Date(this.getFullYear(),this.getMonth(),this.getDate())});typeof Date.prototype.addHours!="function"&&(Date.prototype.addHours=function(n){return this.setTime(this.getTime()+n*36e5),this});typeof String.prototype.replaceLast!="function"&&(String.prototype.replaceLast=function(n,t){var i=this.lastIndexOf(n);return i>=0?this.substring(0,i)+t+this.substring(i+n.length):this.toString()});typeof String.prototype.padLeft!="function"&&(String.prototype.padLeft=function(n,t){for(var i=this;i.length<n;)i=t+i;return i});typeof Number.prototype.padLeft!="function"&&(Number.prototype.padLeft=function(n,t){return(this+"").padLeft(n,t)});Array.prototype.map||(Array.prototype.map=function(n,t){return $.isArray(t)?$.map(t,n):[]});Array.prototype.equals||(Array.prototype.equals=function(n,t){if(!n||(arguments.length==1&&(t=!0),this.length!=n.length))return!1;for(var i=0;i<this.length;i++)if(this[i]instanceof Array&&n[i]instanceof Array){if(!this[i].equals(n[i],t))return!1}else{if(t&&this[i]!=n[i])return!1;if(!t)return this.sort().equals(n.sort(),!0)}return!0});Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(n){var i,u,f,t,r;if(this==null)throw new TypeError('"this" is null or not defined');if(i=Object(this),u=i.length>>>0,typeof n!="function")throw new TypeError("predicate must be a function");for(f=arguments[1],t=0;t<u;){if(r=i[t],n.call(f,r,t,i))return r;t++}return undefined},configurable:!0,writable:!0});typeof Packery!="undefined"&&(typeof Packery.prototype.getShiftPositions!="function"&&(Packery.prototype.getShiftPositions=function(n){n=n||"id";var t=this;return this.items.map(function(i){return{attr:i.element.getAttribute(n),x:i.rect.x/t.packer.width,y:i.rect.y/t.packer.height}})}),typeof Packery.prototype.initShiftLayout!="function"&&(Packery.prototype.initShiftLayout=function(n,t){if(!n){this.layout();return}if(typeof n=="string")try{n=JSON.parse(n)}catch(r){console.error("JSON parse error: "+r);this.layout();return}t=t||"id";this._resetLayout();this.items=n.map(function(n){var r="["+t+'="'+n.attr+'"]',u=this.element.querySelector(r),i=this.getItem(u);if(i)return i.rect.x=n.x*this.packer.width,i.rect.y=n.y*this.packer.height,i},this);this.items=this.items.filter(function(n){return n!==undefined});var i=[],u=this;$(this.$element[0]).find(this.options.itemSelector).each(function(n,t){u.getItem(t)||i.push(t)});this.addItems(i);this.shiftLayout()}));Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(n){var i,r,u,t,f;if(this==null)throw new TypeError('"this" is null or not defined');if(i=Object(this),r=i.length>>>0,typeof n!="function")throw new TypeError("predicate must be a function");for(u=arguments[1],t=0;t<r;){if(f=i[t],n.call(u,f,t,i))return t;t++}return-1}});typeof Number.prototype.toCurrency!="function"&&(Number.prototype.toCurrency=function(n,t,i,r){n=n||2;var f="\\d(?=(\\d{"+(t||3)+"})+"+(n>0?"\\D":"$")+")",u=this.toFixed(Math.max(0,~~n));return"$"+(r?u.replace(".",r):u).replace(new RegExp(f,"g"),"$&"+(i||","))});RegExp.escape=function(n){return n.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")};Array.prototype.intersect=function(n){var i=[],r,t;for(r in this)t=this[r],n.indexOf(t)>-1&&i.push(t);return i};typeof Array.prototype.merge!="function"&&(Array.prototype.merge=function(n){var t=this;return t.concat(n.filter(function(n){return t.indexOf(n)<0}))});Array.prototype.filter||(Array.prototype.filter=function(n){"use strict";var i,f,r,e,t,u;if(this===void 0||this===null)throw new TypeError;if(i=Object(this),f=i.length>>>0,typeof n!="function")throw new TypeError;for(r=[],e=arguments[1],t=0;t<f;t++)t in i&&(u=i[t],n.call(e,u,t,i)&&r.push(u));return r});Object.defineProperties(Date,{MIN_VALUE:{value:-864e13},MAX_VALUE:{value:864e13}});EVO.EcValidator=function(){function t(){}function n(n,t){t=t?t:[];$.validator.unobtrusive.adapters.add(n,t,function(t){t.rules[n]=t.params;t.message!=null&&(t.messages[n]=t.message)})}var i="mobilevalidator",r="cardtypevalidator",u="cinebuzzcardvalidator",f="datevalidator",e="datesplitvalidator",o="ajaxvalidator",s="cardexpiryvalidator",h="requiredunlessdigitalcheckoutvalidator",c="checked";return t.prototype={init:function(){n(i,["regex"]);n(o,["url"]);n(f);n(e);n(r);n(s);n(u,["regex"]);n(h);n(c)}},$.validator.addMethod(r,function(n,t){var i=$(t).data("validtypes")||[],e=i.map(function(n){return n.code}),o=i.map(function(n){return n.name}),s="Only "+o.join(", ").replaceLast(", "," or ")+" cards are accepted for this transaction",r,u,f;$(t).rules("add",{messages:{cardtypevalidator:s}});n=n.split(" ").join("");r={visa:/^4[0-9]{12}(?:[0-9]{3})?$/,mastercard:/^5[1-5]\d{14}$|^2(?:2(?:2[1-9]|[3-9]\d)|[3-6]\d\d|7(?:[01]\d|20))\d{12}$/,amex:/^3[47][0-9]{13}$/,dinersclub:/^3(?:0[0-5]|[68][0-9])[0-9]{11}$/};for(u in r)if(r[u].test(n)&&(f=$.inArray(u,e),f>-1))return $(t).trigger("validcardtype",i[f]),!0;return $(t).trigger("validcardtype",null),!1}),$.validator.addMethod(i,function(n,t,i){var r=new RegExp(i.regex);return r.test(n)}),$.validator.addMethod(u,function(n,t,i){if(n){var r=new RegExp(i.regex);return r.test(n)}return!0}),$.validator.addMethod(o,function(n,t,i){var u=n,r,f;return $("#existingUsername").length&&$("#existingUsername").val()===n?!0:(u.length>0&&(r=$(".username-status"),f=r.data("username"),r.attr("data-status",""),f!==u&&delay(function(){r.loading({placement:"append"});r.data("username",u);delay(function(){EVO.get({url:i.url,data:{model:u},success:function(n){n===r.data("username")&&(r.stopLoading(),r.attr("data-status","success"))},error:function(){r.stopLoading();r.attr("data-status","error");$(".edit-details-tab form").validate().showErrors({EditUsername:"Username already taken"})}})},300)},600)),!0)}),$.validator.addMethod(f,function(n){var t=n.split("/"),i=new Date(t[2],t[1]-1,t[0]);return i.getMonth()+1===Number(t[1])&&i.getDate()===Number(t[0])}),$.validator.addMethod(s,function(n,t){var i=new Date,u=function(){if(n.length!==5)return!1;var t=n.split("/");return t.length!==2?!1:isNaN(t[0])||isNaN(t[1])?!1:(i=new Date(2e3+Number(t[1]),t[0],1),i=new Date(i-1e3),i.getMonth()+1===Number(t[0])&&i.getFullYear()-2e3===Number(t[1]))},r=u();return r?i<new Date&&(r=!1,$(t).rules("add",{messages:{cardexpiryvalidator:"Expiration is in the past"}})):$(t).rules("add",{messages:{cardexpiryvalidator:"Invalid card expiry"}}),r}),$.validator.addMethod(e,function(n,t){var r=$(t).closest("form"),u=$("#DobDD",r).val(),f=$("#DobMM",r).val(),o=$("#DobYYYY",r).val(),i=u&&f&&o,e;if(i){try{e=new Date(o,f-1,u);i=e.getDate()==u&&e.getMonth()==f-1}catch(s){}i||$(t).rules("add",{messages:{datesplitvalidator:"Please enter a valid date of birth"}})}else $(t).rules("add",{messages:{datesplitvalidator:"Date of birth required"}});return i}),$.validator.addMethod(c,function(n){return isTrue(n)}),$.validator.addMethod(h,function(n){var t=parseInt($("#SelectedPaymentType").val());return t===6||t===4||t===2?!0:typeof n!="undefined"&&n.length>0}),$.validator.addMethod("date",function(n,t){if(this.optional(t))return!0;var i=!1;try{$.datepicker.parseDate("dd/mm/yy",n);i=!0}catch(r){i=!1}return i}),new t};ecValidator=new EVO.EcValidator;ecValidator.init();$.validator.setDefaults({ignore:":hidden:not(.eccheckbox-input)"});$.validator.methods.date=function(n,t){return this.optional(t)||EVO.ParseDate(n)};EVO.floatingPlaceholder={init:function(){$("body").on("input",".floating-placeholder input,.floating-placeholder textarea,.floating-placeholder select",EVO.floatingPlaceholder.perform);$("body").on("change",".floating-placeholder select",EVO.floatingPlaceholder.perform);$(".floating-placeholder").find("input, textarea, select").trigger("input")},perform:function(){$(this).val()!=""?$(this).closest(".input").addClass("filled"):$(this).closest(".input").removeClass("filled")}};EVO.helper={loadTrailer:function(){var n,t;$("#ytplayer").length>0&&(typeof YT=="undefined"?(n=document.createElement("script"),n.src="https://www.youtube.com/iframe_api",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(n,t)):onYouTubePlayerAPIReady())}};EVO.showMask=function(n){$("#mt-mask").show();$("body").addClass("modal-open");$("#mt-mask").unbind("click");$.isFunction(n)&&$("#mt-mask").bind("click",n)};EVO.hideMask=function(){$("#mt-mask").hide();$("body").removeClass("modal-open")};EVO.Guid=function b(n){return n?(n^Math.random()*16>>n/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,b)};EVO.ParseDate=function(n){var t;if(!n)return undefined;if(Object.prototype.toString.call(n)==="[object Date]")return n;for(t=n.split(/[- :T]/);t.length<6;)t.push(0);var i=new Date(t[0],t[1]-1,t[2],t[3],t[4],t[5]),u=parseInt(t[3]),r=(24+u-i.getHours())%24;return r>0&&(i=i.addHours(r)),i};EVO.ParseTime=function(n){var t=n.split(/[- :T.]/);return t.length===6?new Date(t[0],t[1]-1,t[2],t[3],t[4],t[5]):new Date(t[0],t[1]-1,t[2])};EVO.stripHtml=function(n){var t=$("<div/>").html(n);return t.text()};EVO.escapeHtml=function(n){return document.createElement("div").appendChild(document.createTextNode(n)).parentNode.innerHTML};EVO.location={get:function(n){var u;if(navigator.geolocation){var t=$.extend({success:function(){},error:function(){},errorMessage:"Error determining location",timeout:1e4,maximumAge:3e5},n,{}),i=!1,f=function(n){if(!i){i=!0;var r=t.errorMessage;n.code===1&&(r="Location permission denied");n.code===2&&(r="Position unavailable");n.code===3&&(r="Location timed out");$.isFunction(t.error)&&t.error(r)}},r=EVO.storage.get("_evocoords");r?$.isFunction(t.success)&&t.success(r):(u=function(n){var i={latitude:n.coords.latitude,longitude:n.coords.longitude};EVO.storage.set("_evocoords",i,30);$.isFunction(t.success)&&t.success(i)},navigator.geolocation.getCurrentPosition(u,f,t))}else EVO.Alert("Location not supported by your browser")},distance:function(n,t,i,r){function u(n){return n*Math.PI/180}var f=u(i-n),e=u(r-t),n=u(n),i=u(i),o=Math.sin(f/2)*Math.sin(f/2)+Math.sin(e/2)*Math.sin(e/2)*Math.cos(n)*Math.cos(i),s=2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o));return 6371*s}},function(n){n.fn.numeric=function(){return this.keyup(n.fn.numeric.keyup)};n.fn.numeric.keyup=function(){this.value=this.value.replace(/[^0-9\.]/g,"")};n.fn.numericInt=function(){return this.on("paste",n.fn.numericInt.paste).on("keypress",n.fn.numericInt.keypress)};n.fn.numericInt.paste=function(){var t=n(this);setTimeout(function(){var n=t.val().replace(/[^0-9]/g,"");t.val(n)},10)};n.fn.numericInt.keypress=function(t){var i=t.which,u=t.ctrlKey||t.metaKey,f=[0,jQuery.ui.keyCode.BACKSPACE,jQuery.ui.keyCode.ENTER],r;return u&&[88,67,86,97,99,118,120].indexOf(i)>-1||f.indexOf(i)>-1?!0:(r=n(this).val()+String.fromCharCode(i),!/\D/.test(r))};n.fn.addError=function(t){return n(this).each(function(){return t&&n(this).after("<span class='field-validation-error'>"+t+"<\/span>"),n(this).addClass("input-validation-error")})};n.fn.removeError=function(){return n(this).each(function(){var t=n(this).next();return t.hasClass("field-validation-error")&&t.remove(),n(this).removeClass("input-validation-error")})};n.fn.onEnterClick=function(t){return n(this).on("keypress",function(i){var r=i.keyCode?i.keyCode:i.which;if(r===13)return i.preventDefault(),n.isFunction(t)?t(i,this):t.jquery?t.trigger("click"):n(t).trigger("click"),!1})};n.fn.onEnter=function(){return n(this)};n.fn.lazyLoadContent=function(t){function r(){u||(u=!0,i.length>0?i.eachAsync({progress:function(t){if(n.inviewport(t,{threshold:0}))n(t).trigger("appear"),counter=0;else if(counter++>5)return!1},done:function(){u=!1}}):f.unbind("scroll",r))}var i=this,u=!1,f=n(window);f.bind("scroll",r);f.bind("resize",r);i.eachAsync({progress:function(r){this.loaded=!1;var u=n(r);u.one("appear",function(){if(!r.loaded){r.loaded=!0;var u=n.grep(i,function(n){return!n.loaded});i=n(u);t(n(r))}})},done:function(){r()}})};n.fn.eachAsync=function(n){return asyncFor({total:this.length,context:this}).progress(function(t){n.progress(this[t])}).done(n.done),this};n.eachAsync=function(n,t){return asyncFor({total:n.length,context:n}).progress(function(n){t.progress(this[n])}).done(t.done),this};n.fn.isChecked=function(){return n(this).hasClass("eccheckbox")&&n(this).hasClass("active")||n(this).parent(".eccheckbox").hasClass("active")};n.fn.showValidationMessage=function(t){var u=n(this),r=u.data("vlderrid"),i;r?i=n("#"+r):(r=EVO.Guid(),i=n("<span/>").attr("id",r),u.data("vlderrid",r),u.after(i));u.addClass("input-validation-error");i.removeClass("field-validation-valid");i.addClass("field-validation-error");i.html(t);i.show()};n.fn.removeValidationMessage=function(){var t=n(this).data("vlderrid"),i;t!==undefined&&t.length>0&&(i=n("#"+t),n(this).data("vlderrid",""),i.remove());n(this).removeClass("input-validation-error")};n.fn.hasValue=function(){return n.trim(n(this).val()).length>0};n.fn.valueRequired=function(t){var i=!0;return n(this).each(function(r,u){var e=n(u).hasValue(),f,o;i=i&&e;e||(f=t,f||(o=n(u).getName(),f=o+" is required."),n(u).showValidationMessage(f))}),i};n.fn.enable=function(){return n(this).removeAttr("disabled")};n.fn.evoshow=function(){return n(this).removeClass("evohide")};n.fn.evohide=function(){return n(this).addClass("evohide")};n.fn.disable=function(){return n(this).attr("disabled","disabled")};n.fn.fadeThenSlideToggle=function(t,i,r){var u=n(this);return u.is(":hidden")?u.slideDown(t,i).fadeTo(t,1,i,r):u.fadeTo(t,0,i).slideUp()};n.fn.stopLoadingToast=function(t){return EVO.StopLoadingToast(t,n(this)),this};n.fn.stopLoadingToastSuccess=function(){var t=n(this);return t.html("Success!!").addClass("success").removeClass("info"),setTimeout(function(){t.fadeThenSlideToggle()},1e3),this};n.fn.stopLoadingToastError=function(t){var i=n(this);return i.html(t).addClass("error").removeClass("info"),setTimeout(function(){i.fadeThenSlideToggle()},1e4),this};n.fn.highlightSuccess=function(){n(this).effect("highlight",{color:"#007f46"},2e3)};n.fn.highlightError=function(){n(this).effect("highlight",{color:"#CB0B0E"},2e3)};n.fn.allVisible=function(){return n(this).filter(function(){return n(this).isVisible()})};n.fn.isVisible=function(){return n(this).css("display")!=="none"};n.fn.anyVisible=function(){return n(this).allVisible().length>0};n.fn.evoSubmit=function(t){return n(this).submit(function(i){return i.preventDefault(),t&&n.isFunction(t)&&t.apply(this),!1})};n.fn.konami=function(t,i){return i==undefined&&(i="38,38,40,40,37,39,37,39,66,65"),this.each(function(){var r=[];n(this).keydown(function(u){r.push(u.keyCode);r.toString().indexOf(i)>=0&&(n(this).unbind("keydown",arguments.callee),t(u))})})};n.fn.getCollectionSibling=function(t){var i=n(this).attr("id"),r=i.indexOf("__"),u;if(r>-1)return u=i.substring(0,r+2),n("#"+u+t)};n.fn.getName=function(){var t=n(this).attr("name").split("."),i=t[t.length-1];return i.depascalise()};n.fn.mtFilter=function(t){t=t||{};var i=n(this).find(">");i.each(function(i,r){var u=n(r),f=isTrue(u.data("sortdone"))&&!isTrue(t.resetData);f||t.getSortData&&(n.each(t.getSortData,function(t,i){n.isFunction(i)&&u.data("sort-"+t,i(u))}),u.data("sortdone",!0));t.alreadyFiltered||(!t.filter||t.filter.apply(u)?u.show():u.hide())});t.sortBy&&(t.getSortData?i.sortElements(function(i,r){var u=n(i).data("sort-"+t.sortBy),f=n(r).data("sort-"+t.sortBy);return u>f?1:u<f?-1:0}):console.log("sort data not supplied"))};n.handleError=function(n,t,i,r){n.error&&n.error.call(n.context||window,t,i,r);n.global&&(n.context?jQuery(n.context):jQuery.event).trigger("ajaxError",[t,n,r])};n.httpSuccess=function(n){try{return!n.status&&location.protocol=="file:"||n.status>=200&&n.status<300||n.status==304||n.status==1223||jQuery.browser.safari&&n.status==undefined}catch(t){}return!1};n.httpData=function(xhr,type,filter){var ct=xhr.getResponseHeader("content-type"),xml=type=="xml"||!type&&ct&&ct.indexOf("xml")>=0,data=xml?xhr.responseXML:xhr.responseText;if(xml&&data.documentElement.tagName=="parsererror")throw"parsererror";return filter&&(data=filter(data,type)),type=="script"&&jQuery.globalEval(data),type=="json"&&(data=eval("("+data+")")),data};n.removeEmptyProperties=function(n){var t=n||this,i;for(i in t)(t[i]===null||t[i]===undefined||t[i]==="")&&delete t[i]};n.fn.ensureInView=function(){var t=n(this),i=t.height()+t.offset().top-(n(window).height()+window.pageYOffset);i>0&&n("html, body").animate({scrollTop:i+window.pageYOffset+20},100)};n.fn.maxHeight=function(t){t=t||n.fn.height;var i=0;return this.each(function(){i=Math.max(i,t.call(n(this)))}),i};n.fn.headerScroll=function(t){var f={scrollUpClass:"scroll-up",scrollDownClass:"scroll-down",applyTo:n("body")},i=n.extend(f,t),r={},u=999999999999999;n(this).smartscroll(function(){var f=n("body").outerHeight(),e=typeof r[f]=="number"?r[f]:u,t=n(this).scrollTop();e===u||(t===0?(i.applyTo.removeClass(i.scrollUpClass),i.applyTo.removeClass(i.scrollDownClass)):t>e?(i.applyTo.addClass(i.scrollDownClass),i.applyTo.removeClass(i.scrollUpClass)):t<e&&(i.applyTo.removeClass(i.scrollDownClass),i.applyTo.addClass(i.scrollUpClass)));r[f]=t})};n.fn.evoInput=function(t){function i(n,t){var r="",i,u;for(n=n||"",t=t||"",i=0;i<n.length;i++)u=n.substr(0,i)+n.substr(i+n.length-t.length),u===t&&(r=n.substr(i,n.length-t.length));return r}var r=function(){var u=n(this),e=this,r=u.val()||"",f=u.data("evolastval"),h=i(r,f),c=i(f,r),o,s;n.isFunction(t)&&(o=t.call(e,h,c,r,f),typeof o=="string"?(r=o,u.data("evolastval",r).val(r).focus(),e.setSelectionRange&&(s=r.length*2,setTimeout(function(){e.setSelectionRange(s,s)},1))):u.val(f).focus())};this.off("input");return this.on("input",r)};n.fn.cardExpiry=function(){return n(this).evoInput(function(n,t,i,r){if(n.length==1){var u=i.length;if(u===3&&n=="/")return i;if(!isNaN(n)){if(u===4||u===5)return i;if(u===1)return n*1<=1?i:"0"+n+"/";if(u===2)return i+"/"}}else if(/^[01][0-9]\/[0-9]{2}/.test(i))return i;return t||(i=r),i})};n.fn.creditCardMask=function(){return n(this).evoInput(function(t,i,r){var u="",f=r.split(" ").join(""),e=[4,8,12];return n.each(f.split(""),function(i,r){if(!isNaN(r)){if(u+=r,i===3)(/^3[47][0-9]/.test(u)||/^3(?:0[0-5]|[68][0-9])/.test(u))&&(e=[4,10]);n.inArray(i+1,e)>-1&&(t||i<f.length-1)&&(u+=" ")}}),u})};n.fn.setVal=function(t){return n(this).val(t).trigger("input")};n.fn.insertAt=function(t,i){return this.each(function(){t===0?n(this).prepend(i):n(this).children().eq(t-1).after(i)})};n.fn.resetValidation=function(){var t=n(this);t.removeData("validator");t.removeData("unobtrusiveValidation");n.validator.unobtrusive.parse(t)};n.fn.serializeForm=function(){var t=n.deparam(n(this).serialize());return n.removeEmptyProperties(t),t}}(jQuery);asyncFor=function(n){var f={total:0,limit:100,pause:10,context:this},t=$.extend(f,n),i=$.Deferred(),r=0,u=0;return this.loop=function(){if(u<t.total){for(r=0;r<t.limit;r+=1,u+=1)i.notifyWith(t.context,[u]);this.setTimeout(this.loop,t.pause)}else i.resolveWith(t.context)},this.setTimeout(this.loop,t.pause),i};jQuery.fn.sortElements=function(){var n=[].sort;return function(t,i){i=i||function(){return this};var r=this.map(function(){var t=i.call(this),n=t.parentNode,r=n.insertBefore(document.createTextNode(""),t.nextSibling);return function(){if(n===this)throw new Error("You can't sort elements if any one is a descendant of another.");n.insertBefore(this,r);n.removeChild(r)}});return n.call(this,t).each(function(n){r[n].call(i.call(this))})}}();window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")),function(n){n.extend(jQuery.tmpl.tag,{"for":{_default:{$2:"var i=1;i<=1;i++"},open:"for ($2){",close:"};"}})}(jQuery),function(n){var t=n.fn.on,i;n.fn.on=function(){var n=Array.apply(null,arguments),r=n[n.length-1],u,f;return isNaN(r)||r===1&&n.pop()?t.apply(this,n):(u=n.pop(),f=n.pop(),n.push(function(){var n=this,t=arguments;clearTimeout(i);i=setTimeout(function(){f.apply(n,t)},u)}),t.apply(this,n))}}(this.jQuery||this.Zepto);deBouncer=function(n,t,i,r){var u=function(n,t,i){var u;return function(){function o(){i||n.apply(f,e);u=null}var f=this,e=arguments;u?clearTimeout(u):i&&n.apply(f,e);u=setTimeout(o,t||r)}};jQuery.fn[t]=function(n){return n?this.bind(i,u(n)):this.trigger(t)}};deBouncer(jQuery,"smartresize","resize",250);deBouncer(jQuery,"smartscroll","scroll",100);deBouncer(jQuery,"smartmousemove","mousemove",100),function(n){n.fn.getHiddenDimensions=function(n){var t=this,r={position:"absolute",visibility:"hidden",display:"block"},i={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0},u=t.parents().andSelf().not(":visible"),n=n==null?!1:n,f=[];return u.each(function(){var t={},n;for(n in r)t[n]=this.style[n],this.style[n]=r[n];f.push(t)}),i.width=t.width(),i.outerWidth=t.outerWidth(n),i.innerWidth=t.innerWidth(),i.height=t.height(),i.innerHeight=t.innerHeight(),i.outerHeight=t.outerHeight(n),u.each(function(n){var i=f[n],t;for(t in r)this.style[t]=i[t]}),i}}(jQuery),function(n){n.fn.resizeToMax=function(t){function r(t,i){var r=this;return r.settings=t,r.count=0,r.height=0,r.execute=function(){var f=i.find(r.settings.items),u,e;r.count++;u=f.maxHeight(function(){return n(this).actual("height")});u>0&&(e=r.height,r.height=u,e!==u&&(r.count=0));r.count>=2&&(clearInterval(r.interval),f.height(u),n.isFunction(t.onResize)&&t.onResize.call(r,i),t.additionalElements&&t.additionalElements.length>0&&t.additionalElements.height(u+t.buffer),n.isFunction(t.completed)&&t.completed.call(r,i))},r.execute(),r.interval=setInterval(r.execute,t.timeout),r}var i=n.extend({timeout:200,items:".equal-height-item",buffer:10},t,{});return n(this).each(function(t,u){if(!n(u).data("evoresizetomax")){var f=new r(i,n(u));n(u).data("evoresizetomax",f)}}),this}}(jQuery),function(n){typeof define=="function"&&define.amd?define(["jquery"],n):n(jQuery)}(function(n){n.fn.addBack=n.fn.addBack||n.fn.andSelf;n.fn.extend({actual:function(t,i){var s,u,h,c;if(!this[t])throw'$.actual => The jQuery method "'+t+'" you called does not exist';var f=n.extend({absolute:!1,clone:!1,includeMargin:!1,display:"block"},i),r=this.eq(0),e,o;return f.clone===!0?(e=function(){r=r.clone().attr("style","position: absolute !important; top: -1000 !important; ").appendTo("body")},o=function(){r.remove()}):(s=[],u="",e=function(){h=r.parents().addBack().filter(":hidden");u+="visibility: hidden !important; display: "+f.display+" !important; ";f.absolute===!0&&(u+="position: absolute !important; ");h.each(function(){var i=n(this),t=i.attr("style");s.push(t);i.attr("style",t?t+";"+u:u)})},o=function(){h.each(function(t){var i=n(this),r=s[t];r===undefined?i.removeAttr("style"):i.attr("style",r)})}),e(),c=/(outer)/.test(t)?r[t](f.includeMargin):r[t](),o(),c}})});$.extend($.tmpl.tag,{"var":{open:"var $1;"}});UTIL={exec:function(n,t,i){var i=i===undefined?"init":i;t!==""&&n[t]&&typeof n[t][i]=="function"&&n[t][i]()},init:function(){var n=$("body").attr("data-controller"),t;n&&(t=$("body").attr("data-action"),UTIL.exec(EVO,n),UTIL.exec(EVO,n,t))}};$(function(){EVO.global!==undefined?(EVO.global.beforeUtil(),UTIL.init(),EVO.global.afterUtil()):UTIL.init()});EVO.ga=function(n,t,i,r){typeof ga!="undefined"&&$.isFunction(ga)&&ga("send","event",n,t,i,r)},function(n){n.fn.evofilter=function(t){var i=n.extend({items:"> *",filters:n(this).data("filters")},t,{}),r=n(i.items,n(this));return r.each(function(t,r){var u=!0;n.each(i.filters,function(t,i){u=u&&i.apply(n(r))});u?n(r).evoshow():n(r).evohide()}),i.after&&n.isFunction(i.after)&&i.after.call(this,i),n(this)}}(jQuery);EVO.filter={init:function(n){var u=$.extend({resizeParent:!1},n,{}),t,i,r;$("body").off("filter-clicked",".filter .eccheckbox");$("body").on("filter-clicked",".filter .eccheckbox",function(){var n=$(this).closest(".filter"),t=n.data("filter-attribute"),r=$.bbq.getState(),i=$(".eccheckbox.active",n).map(function(){return $(this).data("val")}).get();EVO.updateState(t,i.join())});$("body").off("click",".filter .filter-title");EVO.click(".filter .filter-title",function(){var n=$(this).closest(".filter");n.isActive()?n.inactive():n.active()});t=$.bbq.getState();i=!1;$.isEmptyObject(t)||$(".filter").each(function(){var u=$(this).data("filter-attribute"),n=t[u],r;n&&(r=n.commaSeparated(),$.each(r,function(){var n=$('.eccheckbox[data-val="'+this+'"]').active();n.closest(".filter").active();i=!0}))});r=$(".filter-dependant");i?r.addClass("filter-applied"):r.removeClass("filter-applied");isTrue(u.resizeParent)&&$(".filter-wrapper").each(function(n,t){var i=$(t).outerHeight();$(t).parent().height(i)})},addFilterOptions:function(n,t,i,r){var u=$(".filter-items",i),f=$("#filter-item-template");n&&$.each(n,function(n,r){$('.eccheckbox[data-val="'+r.code+'"]',i).length!==0||isTrue(r.doNotDisplay)||(r.type=t,u.append($.tmpl(f,r)))});$(".eccheckbox",i).length>0?i.show():i.hide();isTrue(r)},buildNoResultsText:function(n){var a=$.extend({usesTopBar:isTrue($(".top-bar").data("hashes-cinemas"))},n,{}),v=EVO.getState(),e=[],i=function(n){return"<b>"+n+"<\/b>"},o=$("#session-list .movie-container").data("attributenamekey"),t,c,f;$(".filter-wrapper .filter").each(function(n,t){var s=$(this).data("filter-attribute"),u=(v[s]||"").commaSeparated(),r,f;u.length>0&&(r=[],$.each(u,function(n,i){var u=$('.eccheckbox[data-val="'+i+'"]',t),f;u.length===0&&o&&o[i]&&(u=$.tmpl($("#filter-item-template"),{type:$(t).data("filter-attribute"),name:o[i],code:i}),$(t).find(".filter-items").append(u.active()));f=$.trim(u.find("label").html());f&&r.push(f)}),r.length>0&&(f=r.join("/"),e.push(i(f))))});var s=$(".date.active").html(),r=!1,l=EVO.getState().date;if(l){var y=new Date(l),u=new Date,h=u.getDay(),p=new Date(u.getFullYear(),u.getMonth(),u.getDate()+(h>=2?11-h:4-h));r=y>p}t=r?"Session times are still to be confirmed":"No sessions";s&&(/\d/.test(s)&&(t+=r?" for":" on"),t+=" "+i(s));a.usesTopBar&&(c=EVO.topbar.selectedMovieNames(),c.length>0&&(t+=" for "+i(c.join(", ").replaceLast(", "," or "))),f=EVO.topbar.selectedCinemaNames(),f.length>0&&(t+=" at "+(f.length>1?"cinemas ":"")+i(f.join(", ").replaceLast(", "," or "))));e.length>0&&(t+=" with filter "+e.join(" and "));r&&(t+=". Every Monday we refresh and load new programming for the following week so we recommend checking back on a Tuesday morning for the best results of the upcoming weekend. Thank you.");$(".filter-message").html(t).show()}};EVO.global={beforeUtil:function(){function i(){EVO.order.removeUpcoming();EVO.post({url:"/Cinebuzz/Logout",success:function(){EVO.sso.logout(function(){EVO.watchlist.clearLocal();window.location.reload()});EVO.user.refresh()},error:function(n){EVO.Alert(n)},errorMessage:"Error logging out"})}var t,n;EVO.click(".user-logged-in.mobile-cinebuzz",function(){$("body").hasClass("dashboard")&&$("body").hasClass("cinebuzz")?i():window.location="/Cinebuzz";$(this).addClass("trigger-handled")});t=getParam("evtcampaign");t&&(n=new Date,n.setDate(n.getDate()+1),$.cookie("_evocampaign",t,{expires:n,path:"/"}));isTrue($.cookie("evo_removeuser"))&&(EVO.user.clear(),EVO.removeCookie("evo_removeuser"));EVO.preferences.init();EVO.click(".btn-join, .join-now",function(){var n=$(this).data("promo");n&&$(".register-form #PromoCode").val(n);EVO.topbar.cinebuzzJoin()});EVO.click(".btn-login",function(){EVO.topbar.cinebuzzLogin($(this).data("message"))});EVO.click(".btn.submit",function(){$(this).closest("form").submit()});EVO.topbar.init();EVO.click(".eccheckbox a",function(n){n.stopPropagation()},!0);EVO.click(".eccheckbox",function(){var t=$(this).data("checkboxgroup"),n=$(this).hasClass("active");n?($(this).removeClass("active"),$("input",this).val(!1),$(this).trigger("unchecked")):(t&&$('.eccheckbox[data-checkboxgroup="'+t+'"]').removeClass("active"),$(this).addClass("active"),$("input",this).val(!0),$(this).trigger("checked"));$(this).trigger("filter-clicked",!n);$(this).trigger("change",!n);$("input",this).trigger("change",!n);LazyLoadImages()});$(".search-section form").evoSubmit(function(){var n=$(this).find("#Search").val();window.location="/Search#q="+n});EVO.click(".logout-btn",i);EVO.click(".logged-in-content .logout",i);EVO.click(".popup-trailer",function(){var n=$(this).closest(".movie-container-item"),t={TrailerUrl:$(this).data("trailers"),Rating:$(this).data("rating"),Title:n.data("name")||$(this).data("name"),Id:n.data("id")||$(this).data("id"),Code:$(this).data("code")},i=$.tmpl($("#movie-trailer-video-template"),t).evomodal({animate:!0,onOpen:function(){EVO.helper.loadTrailer()},onClose:function(){}});EVO.movioTracker.movieTrailer(t.Code)});EVO.click(".sold-out",function(){$(this).hasClass("session-btn")?EVO.Alert("Sorry, this session has sold out"):EVO.Alert("Sorry, this item has sold out")});EVO.click(".cinema-toast .close",function(){$(this).closest(".cinema-toast").fadeOut(function(){$(this).remove()})});EVO.click(".cinema-toast .undo",function(){var n=$(this).data("id"),t="undo-cinema-"+n;EVO.setStorage(t,!0);EVO.preferences.removeCinema(n);$(this).closest(".cinema-toast").find(".close").trigger("click")});EVO.click(".seating-modal .seats [data-seat]",function(){var n=$(this).closest(".seating-modal").data("href");n&&(window.location=n)});EVO.change("#cinema-remember",function(){if($(this).isChecked())$.cookie("_evo_nocinemaupdate",null);else{var n=new Date;n.setHours(n.getHours()+1);$.cookie("_evo_nocinemaupdate",!0,n)}});EVO.click(".skiptomain",function(){var t=$(this),i=t.data("hashtrigger"),r,n,u,f,e;i&&(i.indexOf("#")>-1?location.hash=i:console.log("Not implemented yet"));r=t.data("element");r&&(n=$(r),n.length>0&&($(window).scrollTop(n.offset().top),u=t.data("focus"),f=!1,u&&(e=$(u),e.length>0&&(e.get(0).focus(),f=!0)),f||n.focus()))});EVO.click(".fb-share",function(n){if(!EVO.isMobile()){n.preventDefault();var t=$(this).data("url");return t&&typeof FB!="undefined"&&(isTrue($(this).data("share"))?FB.ui({method:"share",mobile_iframe:!0,href:t},function(){}):FB.ui({method:"send",link:t,redirect_uri:t})),!1}},!0);EVO.user.setLoggedInFaveCinema();$(window).headerScroll();$("input.no-spaces").on({keydown:function(n){if(n.which===32)return!1},change:function(){this.value=this.value.replace(/\s/g,"")}});EVO.floatingPlaceholder.init();EVO.user.joined();$(".evo-recaptcha.pageload").length>0&&EVO.ensureRecaptchaScriptLoaded()},afterUtil:function(){var n,t;LazyLoadImages();EVO.iePlaceholder();$(".same-height-wrapper").resizeToMax();n=$(".toastr-toasts").data("toasts");n&&n.length>0&&typeof toastr!="undefined"&&$.each(n,function(n,t){var f="_evotoast_"+t.Id,i,r,u;isTrue($.cookie(f))||($.removeEmptyProperties(t),i=$.extend({Position:"toast-top-right",Style:"info",DisplayDuration:5e3,CookieExpiration:525600},t),r=i.Content,i.Title&&(r="<h3>"+i.Title+"<\/h3>"+r),i.LinkUrl&&(r='<a href="'+i.LinkUrl+'">'+r+"<\/a>"),$.isFunction(toastr[i.Style])&&(toastr.options.positionClass=i.Position,toastr.options.timeOut=i.DisplayDuration,toastr[i.Style](r)),u=new Date,u.setMinutes(u.getMinutes()+i.CookieExpiration),$.cookie(f,!0,{expires:u}))});$("body").hasClass("ticketing")||(t=EVO.storage.get("evo_abandon"),t&&(EVO.storage.remove("evo_abandon"),EVO.movioTracker.abortedTicketPurchase(t)));EVO.movioTracker.checkLogin();EVO.order.getUpcoming({success:function(n){if(n&&n.length>0){var t=$("<div/>").addClass("upcoming-burger").html($("<a/>").attr("href","/Cinebuzz/Dashboard#tab=orders-tab").html("My Upcoming Orders ("+n.length+")"));$(".hamburger-menu").prepend(t)}}});typeof Modernizr!="undefined"&&Modernizr.inputtypes.date===!1&&$("input[type=date]").each(function(n,t){var i=$(t).attr("max");i&&(i=EVO.ParseDate(i));$(t).datepicker({dateFormat:"dd/mm/yy",maxDate:i}).attr("type","text").removeAttr("max")});$(window).trigger("resize")}};EVO.isMobile=function(){return $("#mobile-test").css("display")==="block"};EVO.sessionTime=function(n){var t=n;return Object.prototype.toString.call(n)!=="[object Date]"&&(t=EVO.ParseDate(n)),DateFormat.format.date(t,"h:mm a")};EVO.displayDate=function(n){var i=n,t;return(Object.prototype.toString.call(n)!=="[object Date]"&&(i=EVO.ParseDate(n)),t=new Date,EVO.equalsDay(t,i))?"Today":(t.setDate(t.getDate()+1),EVO.equalsDay(t,i))?"Tomorrow":DateFormat.format.date(i,"E dd/MM")};EVO.dayDate=function(n){var t=n;return Object.prototype.toString.call(n)!=="[object Date]"&&(t=EVO.ParseDate(n)),DateFormat.format.date(t,"dd MMM yyyy")};EVO.releaseDate=function(n){var t=n;return Object.prototype.toString.call(n)!=="[object Date]"&&(t=EVO.ParseDate(n)),DateFormat.format.date(t,"MMM dd")};EVO.equalsDay=function(n,t){return n.getFullYear()===t.getFullYear()&&n.getMonth()===t.getMonth()&&n.getDate()===t.getDate()};EVO.rating=function(n){return(n||"").replace("+","")};EVO.iePlaceholder=function(){$.fn.placeholder&&$("input, textarea").placeholder()};EVO.movioTracker={applyTracker:function(n){EVO.user.get(function(t){var i,r,u;t&&t.movioId&&(i=t.movioId,i&&(r=0,u=setInterval(function(){typeof evo_mt=="function"?(clearInterval(u),(typeof EVO.movioTracker.memberSet=="undefined"||EVO.movioTracker.memberSet!==i)&&(evo_mt("set","memberId",{id:i,hashed:!0}),EVO.movioTracker.memberSet=i),typeof n=="function"&&n.call(this)):r>20&&clearInterval(u);r++},200)))})},checkLogin:function(){isTrue(EVO.storage.get("evo_login"))&&(EVO.storage.remove("evo_login"),EVO.movioTracker.applyTracker(function(){evo_mt("send","TrackMemberLogin",{loginDateTime:new Date})}))},setLogin:function(){EVO.storage.set("evo_login",!0)},movieDetail:function(n){EVO.movioTracker.applyTracker(function(){evo_mt("send","TrackMovieDetail",{movieId:n})})},movieRating:function(n,t){EVO.movioTracker.applyTracker(function(){evo_mt("send","TrackMovieRating",{movieId:n,rating:t})})},movieTrailer:function(n){EVO.movioTracker.applyTracker(function(){evo_mt("send","TrackMovieTrailer",{movieId:n,viewDateTime:new Date})})},abortedTicketPurchase:function(n){EVO.movioTracker.applyTracker(function(){evo_mt("send","trackabortedpurchase",{movieId:n})})},movieWishList:function(n,t){EVO.movioTracker.applyTracker(function(){t?evo_mt("send","TrackMovieWatchlist",{movieId:n}):evo_mt("delete","TrackMovieWatchlist",{movieId:n})})}},function(n){var t;n.fn.mtisotope=function(i){var r=n(this),o=r.data("isotope"),u,e;if(n.isFunction(i.after)&&i.filter){u=n("> *",r);u.removeClass("filter-hide");var s=u.length,f=0,h=i.filter,c=function(){var t=h.call(this);return t||n(this).addClass("filter-hide"),f++,f===s&&i.after(r),t};i.filter=c}return i.destroy&&o&&r.isotope("destroy"),i.isMovieContainer&&(i.getSortData||i.sortBy||(e=EVO.helper.hashedSortBy(),i.getSortData=EVO.filter.movieSortByOptions(),i.sortBy=e),t=delay(function(){r[0].style.height==="0px"&&r.find(".filter-no-results").length===0&&r.isotope("destroy").mtisotope(i)},500)),r.isotope(i),r};n.fn.evomodal=function(t){var f,i,r,u;return t||(t={}),f=n(this),i=t.onOpen,t.onOpen=function(r){n("body").addClass("modal-open");t.posFix&&n("body").addClass("posfix");t.animate?r.overlay.fadeIn(function(){r.container.slideDown(function(){r.data.fadeIn(function(){n.isFunction(i)&&i.call(r)})})}):(r.overlay.show(),r.container.show(),r.data.show(),n.isFunction(i)&&i.call(r));EVO.iePlaceholder()},r=t.onClose,t.onClose=function(i){n("body").removeClass("modal-open");n("body").removeClass("posfix");t.animate?i.data.fadeOut(function(){i.container.slideUp(function(){i.overlay.fadeOut(function(){n.modal.close()})})}):(n.isFunction(r)&&r.call(i),n.modal.close())},u=f.modal(t),isTrue(t.fullscreen)&&u.d.container.addClass("fullscreen"),u};n.fn.btnLoading=function(){n(this).data("loading",!0);n(this).addClass("loading");n(this).off("postStopLoading");n(this).on("postStopLoading",function(){n(this).removeClass("loading")});return this};n.fn.setLoading=function(){return n(this).isLoading()?!0:(n(this).btnLoading(),!1)};n.fn.btn=function(){return n(this).find(".btn")};n.fn.submitBtn=function(){return n(this).find(".submit")}}(jQuery);EVO.preferences={collection:{},init:function(){EVO.preferences.collection=EVO.storage.get("evo_preferences")||{}},save:function(){EVO.storage.set("evo_preferences",EVO.preferences.collection)},setProperty:function(n,t){EVO.preferences.collection[n]=t;EVO.preferences.save()},cinemas:function(){return EVO.preferences.collection.cinemas||[]},getStateSelector:function(){return EVO.preferences.collection["state-selector"]},setStateSelector:function(n){return EVO.preferences.setProperty("state-selector",n)},updateCinemas:function(n){EVO.preferences.collection.cinemas=n;EVO.preferences.save()},removeCinema:function(n){var t=EVO.preferences.cinemas(),i=$.grep(t,function(t){return t!=n});EVO.preferences.collection.cinemas=i;EVO.preferences.save()},setFaveCinema:function(n){EVO.preferences.setProperty("favecinema",n);EVO.topbar.updateFaveCinemaText()},getFaveCinema:function(){return EVO.preferences.collection.favecinema}},function(n){n.fn.slider=function(t){var r=n(this),i;if(r.length>0){i=n.extend({current_item:0,items_shown:0,offset:0,items:"> *",snap:!0,postSlide:null,slideToActive:!1,displayArrows:!0,slider:r,arrowHideClass:null,widthAdjustment:0,useParentWidth:!1},t||{});function u(t){this.settings=t;this.canvas=null;var i=this;if(i.settings.displayArrows){i.settings.rightArrow.off("click");i.settings.rightArrow.on("click",function(){return(isNaN(i.settings.items_shown)||i.settings.items_shown===0)&&i.setItemsShown(),i.settings.current_item=Math.min(i.settings.actualItems.length,i.settings.current_item+=i.settings.items_shown),i.moveToCurrentItem(),!1})}if(i.settings.displayArrows){i.settings.leftArrow.off("click");i.settings.leftArrow.on("click",function(){return(isNaN(i.settings.items_shown)||i.settings.items_shown===0)&&i.setItemsShown(),i.settings.current_item=Math.max(0,i.settings.current_item-=i.settings.items_shown),i.moveToCurrentItem(),!1})}n(window).on("resize",function(){var n=i.getSliderWidth();i.settings.currentWidth&&n==i.settings.currentWidth||i.init()});i.settings.wrapper.off("scroll");i.settings.wrapper.on("scroll",function(){var t=i.settings.wrapper.width(),r=0;i.settings.actualItems.each(function(i,u){var f=n(u).position().left,e;if(f>0&&f>t)return!1;e=Math.abs(f);e<t&&(t=e,r=i)});r!=i.settings.current_item&&(i.settings.current_item=r,i.settings.snap&&(typeof i.settings.snap=="boolean"||n.isFunction(i.settings.snap)&&i.settings.snap())?i.moveToCurrentItem():i.showHideArrows(i.settings.wrapper.scrollLeft()))},250);i.init()}return u.prototype={moveToCurrentItem:function(){var i,t;this.settings.actualItems&&this.settings.actualItems.length>0&&(i=this.settings.wrapper.scrollLeft()+n(this.settings.actualItems[this.settings.current_item]).position().left-this.settings.offset,this.showHideArrows(i),t=this,t.settings.wrapper.animate({scrollLeft:i},300,function(){t.settings.postSlide&&n.isFunction(t.settings.postSlide)&&t.settings.postSlide.call(r)}))},showHideArrows:function(n){this.settings.displayArrows&&(this.settings.current_item+this.settings.items_shown>=this.settings.items_total||this.settings.useParentWidth&&this.settings.maxLeftScroll<=n?this.settings.arrowHideClass?this.settings.rightArrow.addClass(this.settings.arrowHideClass):this.settings.rightArrow.fadeOut("fast"):this.settings.arrowHideClass?this.settings.rightArrow.removeClass(this.settings.arrowHideClass):this.settings.rightArrow.fadeIn("fast"),this.settings.current_item===0?this.settings.arrowHideClass?this.settings.leftArrow.addClass(this.settings.arrowHideClass):this.settings.leftArrow.fadeOut("fast"):this.settings.arrowHideClass?this.settings.leftArrow.removeClass(this.settings.arrowHideClass):this.settings.leftArrow.fadeIn("fast"))},init:function(){var t,n;this.setItemsShown();this.settings.slideToActive&&(t=this.settings.actualItems.index(this.settings.actualItems.filter(".active")),t>-1&&(n=Math.floor(t/this.settings.items_shown)*this.settings.items_shown,isNaN(n)&&(n=0),this.settings.current_item=n));this.moveToCurrentItem()},setItemsShown:function(){this.settings.currentWidth=this.getSliderWidth();this.settings.items_shown=Math.floor(this.settings.currentWidth/this.settings.actualItems.outerWidth(!0));this.settings.maxLeftScroll=n(this.settings.actualItems[0]).parent().width()-this.settings.currentWidth},getSliderWidth:function(){return this.settings.slider.width()-this.settings.widthAdjustment}},this.each(function(t,f){var e=r.parent(),o;i.actualItems=r.find(i.items);i.rightArrow=e.find(".right-arrow");i.leftArrow=e.find(".left-arrow");i.wrapper=i.wrapper||i.actualItems.parent();i.items_total=i.actualItems.length;o=new u(i);n(f).data("evoslider",o)})}}}(jQuery),function(n){n.fn.sortBy=function(t){var i=n.extend({items:"> *",sortBy:""},t,{}),u=n(this).data("sortedBy"),r;if((!u||u!==i.sortBy)&&(n(this).data("sortedBy",i.sortBy),r=n(i.items,n(this)),r.each(function(t,r){var u=n(r),f=isTrue(u.data("sortdone"))&&!isTrue(i.resetData);f||i.sortData&&(n.each(i.sortData,function(t,i){n.isFunction(i)&&u.data("sort-"+t,i(u))}),u.data("sortdone",!0))}),i.sortBy))if(i.sortData){if(typeof i.sortData[i.sortBy]=="undefined"){if(isTrue(i.updateDefaultState))return EVO.updateState("sortby",i.defaultSortBy),n(this);i.sortBy=i.defaultSortBy}r.sortElements(function(t,r){var u=n(t).data("sort-"+i.sortBy),f=n(r).data("sort-"+i.sortBy);return u>f?1:u<f?-1:0})}else console.log("sort data not supplied");return n(this)}}(jQuery);EVO.sso={login:function(n,t){var f=EVO.sso.subscribers(),r=f.length,i,u;if(r===0)t&&$.isFunction(t)&&t.call(this);else for(i=0,u=0;u<r;u++)$.ajaxSetup({xhrFields:{withCredentials:!0}}),EVO.post({url:f[u]+"/Cinebuzz/SSOLogin",data:{token:n.token},success:function(){i++;i===r&&t&&$.isFunction(t)&&t.call(this)},error:function(n){console.log(n);i++;i===r&&t&&$.isFunction(t)&&t.call(this)},errorMessage:"Error with SSO"})},logout:function(n){var u=EVO.sso.subscribers(),t=0,i=u.length,r;if(i===0)n&&$.isFunction(n)&&n.call(this);else for(r=0;r<i;r++)$.ajaxSetup({xhrFields:{withCredentials:!0}}),EVO.post({url:u[r]+"/Cinebuzz/Logout",success:function(){t++;t===i&&n&&$.isFunction(n)&&(n.call(this),EVO.user.refresh())},error:function(r){console.log(r);t++;t===i&&n&&$.isFunction(n)&&n.call(this)},errorMessage:"Error with SSO"})},subscribers:function(){return $(".sso-subscriber").map(function(n,t){return $(t).val()}).get()}};EVO.storage={get:function(n){var t;return(EVO.storage.isLocalStorageEnabled()?(EVO.storage.removeExpired(),t=localStorage.getItem(n),t||(t=$.cookie(n),t&&(localStorage.setItem(n,t),$.cookie(n,null,{path:"/"})))):t=$.cookie(n),t)?$.parseJSON(t):t},set:function(n,t,i){var f=t?JSON.stringify(t):undefined,r,u;EVO.storage.isLocalStorageEnabled()?(localStorage.setItem(n,f),i&&(r=!0,typeof i=="number"?i=(new Date).getTime()+6e4*i:typeof i=="Date"?i=i.getTime():r=!1,r&&(u=$.parseJSON(localStorage.getItem("evo_expirations")||"{}"),u[n]=i,localStorage.setItem("evo_expirations",JSON.stringify(u))))):$.cookie(n,f,{path:"/",expires:i/1440})},remove:function(n){EVO.storage.isLocalStorageEnabled()?localStorage.removeItem(n):$.removeCookie(n)},removeExpired:function(){var n=$.parseJSON(localStorage.getItem("evo_expirations")||"{}"),t=(new Date).getTime();$.each(n,function(n,i){i<t&&localStorage.removeItem(n)})},isLocalStorageEnabled:function(){if(typeof Storage!="undefined")try{return localStorage.getItem("bob"),!0}catch(n){}return!1}};EVO.sessionStorage={get:function(n){var t=undefined;return(EVO.storage.isLocalStorageEnabled()&&(t=sessionStorage.getItem(n)),t&&t!=="undefined")?$.parseJSON(t):$("body").data("_evo_sessionstorage_"+n)},set:function(n,t){var i=!1,r;if(EVO.storage.isLocalStorageEnabled())try{r=t?JSON.stringify(t):undefined;sessionStorage.setItem(n,r);i=!0}catch(u){}i||$("body").data("_evo_sessionstorage_"+n,t)},remove:function(n){EVO.storage.isLocalStorageEnabled()&&sessionStorage.removeItem(n);$("body").removeData("_evo_sessionstorage_"+n)}};EVO.tabs={init:function(n){var t=$.extend({defaultScreen:"nowshowing",headerWrapper:".tabs",stateProp:"tab",forceTrigger:!0,jumpToTop:!1,tabType:"span"},n,{}),i=EVO.getCommaSelector;EVO.click(i(t.headerWrapper," "+t.tabType),function(){if(!$(this).isActive()){var n=$(this).data("option");n===t.defaultScreen&&(n=null);$(this).hasClass("tab-handled")||(EVO.updateState("tab",n),$(this).trigger("clicked"))}});$("#mobile-options").change(function(){$(i(t.headerWrapper," "+t.tabType+'[data-option="'+$(this).val()+'"]')).trigger("click")});EVO.hash(function(){var r=EVO.getState(),n=r[t.stateProp]||t.defaultScreen,u=$(i(t.headerWrapper," .active")).data("option");u!==n&&($(".option.active").inactive().trigger("deselected"),$(i(t.headerWrapper," "+t.tabType)).inactive(),$(i(t.headerWrapper,' [data-option="'+n+'"]')).active().trigger("selected"),$('.mobile-tabs option[value="'+n+'"]').attr("selected","selected"),$(".option."+n).active().trigger("activated"),t.ensureInView&&$(i(t.headerWrapper,' [data-option="'+n+'"]:visible')).get(0).scrollIntoView(!1),t.jumpToTop&&window.scrollTo(0,0));$(".option."+n).active().trigger("selected")},t.forceTrigger)}};EVO.getCommaSelector=function(n,t){var i=n.split(",").map(function(n){return n+t});return i.join()};EVO.topbar={init:function(n){var t=$.extend({updateFtab:!0,updateState:!1,updateText:!0,setFromState:!0},n,{});EVO.click(".menu-mask-trigger",function(){var n=$(this),t;if(!n.hasClass("trigger-handled"))return n.hasClass("open")||$(".menu-mask-trigger.open").not(this).each(function(t,i){var r=$(i),u;n!==r&&(u=r.data("topbar-ownchange"),typeof u=="function"?u.call(this,{closing:!0}):r.trigger("change",{ignoreMask:!0}))}),t=n.data("topbar-ownchange"),typeof t=="function"?t.call(this):n.trigger("change"),!1},!0);EVO.change(".menu-mask-trigger",function(n,t){var i=$(this);if(i.toggleClass("open"),i.hasClass("open")||i.trigger("done"),!t||!isTrue(t.ignoreMask))if(t=t||{},isTrue(t.hardClose))$(".menu-mask").removeClass("open"),$("body").removeClass("modal-open");else{if(i.hasClass("open")){$(".menu-mask").addClass("open");$("body").addClass("modal-open");return}$(".menu-mask-trigger.open").length>0||($(".menu-mask").removeClass("open"),$("body").removeClass("modal-open"))}});EVO.click(".menu-mask",function(){$(".menu-mask-trigger.open").each(function(n,t){$(t).trigger("change",{ignoreMask:n!==0,hardClose:!0})})});EVO.click(".event-cinema-redirect a",function(){var n=$(this).attr("href");location=n});EVO.topbar.onChange(function(){var i=$(".top-bar .ftab"),r=i.data("url"),n=EVO.getState();$(".top-bar .top-select:visible").each(function(i,r){var u=$(".eccheckbox.active",r).map(function(){return $(this).data("id")}).get(),f=$(r).data("param");n[f]=u.join();t.updateText&&$(r).trigger("update-text")});$.removeEmptyProperties(n);$.isEmptyObject(n)||(r+="#"+$.param(n));t.updateFtab&&i.attr("href",r);t.updateState&&EVO.pushState(n)});$("#cinema-select .eccheckbox").bind("filter-clicked",function(){var n=$(this).closest("#cinema-select"),t;n.find("#cinema-remember_checkbox").isActive()&&(t=isTrue($.cookie("_evo_nocinemaupdate")),t?$.cookie("_evo_nocinemaupdate",null):EVO.preferences.updateCinemas(EVO.topbar.getIds(n)))});EVO.click(".cancel-modal",function(){$(".menu-mask-trigger.login.open").trigger("change")});EVO.change(".hamburger-wrapper",function(){$(".hamburger-menu").toggleClass("open");$(".navbar-toggle").toggleClass("open");$("body").toggleClass("side-nav")});$(".mobile-ticket").data("topbar-ownchange",function(n){var t=$(".top-bar .top-select.open"),i;t.length>0&&(!n||!n.closing)?t.find(".done.btn").trigger("click"):($(this).trigger("change"),i=$(".top-bar").toggleClass("active").isActive(),$("body").toggleClass("side-nav"))});EVO.topbar.faveCinemaInit();EVO.topbar.topSelectsInit();EVO.topbar.cinebuzzInit()},topSelectsInit:function(){var n;EVO.click(".top-select .top-select-options-wrapper",function(n){n.stopPropagation()});EVO.click(".top-select .done",function(){var n=$(".top-bar").isActive();n?$(this).closest(".top-select").trigger("change",{ignoreMask:!0}):$(this).closest(".top-select").trigger("change")});EVO.click(".top-select",function(){var n=$(this);$(".top-select.open").not(n).trigger("change");n.trigger("change");n.hasClass("open")&&n.trigger("open")});EVO.click("#any-movie",function(){var n=$(this).closest(".top-select");n.find(".eccheckbox.active").trigger("click");n.find(".done").trigger("click")});EVO.click(".top-select .clear-all",function(){var n=$(this).closest(".top-select-options-wrapper");n.find(".top-select-options .eccheckbox.active").trigger("click")});$(".top-select").bind("update-text",function(){var t=$(this),n,i,r;isTrue(t.data("statictext"))||(n=$(".eccheckbox.active",t).map(function(){return $(this).data("name")}).get(),i=$(".text",t),n.length===0?i.html($(t).data("default-text")):n.length===1?i.html(n[0]):(r=$.tmpl($(this).data("text"),{length:n.length}),r.length>0&&i.html(r[0])))});var t=EVO.getState(),i=(t.cinemas||"").commaSeparatedInts(),r=EVO.preferences.cinemas().merge(i);if(isTrue($(".top-bar").data("hashes-cinemas"))&&EVO.updateState("cinemas",r.join()),$(".top-select").each(function(n,u){var o=$(u).data("param"),f=t[o],e,s;o==="cinemas"&&(f=r.join(),isTrue($(u).data("autoselectfromfave"))||(f=i.join()));f&&(e=!1,s=f.commaSeparated(),$.each(s,function(n,t){$('.eccheckbox[data-id="'+t+'"]',u).active();e=!0}),e&&($(u).find(".eccheckbox:first").trigger("filter-clicked"),$(u).trigger("update-text")))}),$("html.au").length>0&&$("body.bcc").length===0&&$("body.gu").length===0){$(".top-select").on("open",function(){var t,i;$(this).find(".state-wrapper").length>0&&(t=EVO.preferences.getStateSelector(),t&&(i=$(this).find('[data-state-selector="'+t+'"]'),i.isActive()||n.call(i)))});n=function(){var n=$(this),i=n.data("state"),t=n.closest(".top-select-options-wrapper");$(".state",t).inactive();$(".state-wrapper",t).inactive();n.active();t.find('.state-wrapper[data-state="'+i+'"]').active()};EVO.click(".top-select .state",n);EVO.click("[data-state-selector]",function(){var n=$(this);EVO.preferences.setStateSelector(n.isActive()?n.data("state-selector"):null)})}},faveCinemaInit:function(){EVO.change(".fave-wrapper .menu-mask-trigger",function(){var r=$(this).closest(".fave-wrapper"),t,n,i;r.toggleClass("open");r.hasClass("open")&&($(".fave-nearby-options").hide(),t=EVO.preferences.getFaveCinema(),n=EVO.preferences.getStateSelector(),t&&t.id&&(i=$('.fave-wrapper .eccheckbox[data-id="'+t.id+'"]'),n=i.data("state"),i.active()),$(".fave-options .state").length===1&&(n=$(".fave-options .state:first").data("state")),n&&($(".fave-wrapper .top-select").trigger("click"),$('.fave-options .state[data-state="'+n+'"]').trigger("click")))});var n=function(){$(".fave-wrapper .menu-mask-trigger.open").each(function(n,t){n===0?$(t).trigger("change"):$(t).removeClass("open")})};EVO.click(".fave-options .state",function(){$(".fave-options .state.active").inactive();var n=$(this).active().data("state");$(".fave-options .state-wrapper").hide();$('.fave-options .state-wrapper[data-state="'+n+'"]').show()});EVO.click(".fave-wrapper .close",n);EVO.click(".fave-wrapper .clear-fave",function(){EVO.preferences.setFaveCinema();$(".fave-wrapper .eccheckbox.active").inactive();$(".fave-wrapper").trigger("change")});EVO.click("#fave-nearby",function(){var n=$(this);if(n.setLoading())return!1;EVO.location.get({success:function(t){var r,f,u,i,s,o;n.stopLoading();r=[];$(".fave-options .fave-cinemas .eccheckbox").each(function(n,i){var u=$(i).data("long"),f=$(i).data("lat"),e=EVO.location.distance(t.latitude,t.longitude,f,u);r.push({item:$(i),distance:e})});r.sort(function(n,t){return n.distance-t.distance});f=$(".fave-options .fave-nearby-options").html("");$(".fave-options .fave-cinemas .eccheckbox").data("distance",undefined);var h=$("#fave-nearby-template"),e=EVO.preferences.getFaveCinema(),c=Math.min(r.length,10);for(u=0;u<c;u++)i=r[u],s=(i.distance>5?i.distance.toFixed(0):i.distance.toFixed(1))+"km",i.dist=s,i.id=i.item.data("id"),i.name=i.item.data("name"),i.code=i.item.data("code"),i.url=i.item.data("url"),o=$.tmpl(h,i),f.append(o),e&&e.id&&e.id===i.id&&o.active();f.show();$(".fave-states").hide();$(".fave-cinemas .state-wrapper").hide()},error:function(t){n.stopLoading();EVO.Alert(t)}})});EVO.change(".fave-wrapper .eccheckbox input",function(t,i){if(i){var r=$(this).closest(".eccheckbox"),u={id:r.data("id"),name:r.data("name"),code:r.data("code"),url:r.data("url"),shortName:r.data("shortname")};EVO.preferences.setFaveCinema(u);n()}else EVO.preferences.setFaveCinema()});EVO.change(".fave-wrapper .top-select",function(){$(".fave-options .fave-nearby-options").html("");$(".fave-options .fave-states").show();$(".fave-options .fave-states .state.active").trigger("click");$(".fave-options .state").length===1&&$(".fave-options .state:first").trigger("click")});EVO.topbar.updateFaveCinemaText()},cinebuzzInit:function(){EVO.change("header .login, .global-header .login",function(){$(".cinebuzz-toggle",this).toggleClass("open");$(".cinebuzz-top-form").toggleClass("open");$(".cinebuzz-top-form").hasClass("open")&&setTimeout(function(){$(".cinebuzz-top-form .headers .big span.active").trigger("click")},500)});EVO.click(".trigger-reset",function(){return $.modal.close(),$(".cinebuzz-top-form").hasClass("open")&&$("header .login").trigger("click"),$(".reset-password").modal(),EVO.ensureRecaptchaScriptLoaded(),!1});EVO.click(".cinebuzz-top-form > .close",function(){EVO.topbar.closeMenuMask()});EVO.submit(".reset-password form",{success:function(n){n.response&&n.response.Redirect?window.location=n.response.Redirect:($.modal.close(),EVO.Success("Please check your email for reset instructions"),n.btn.stopLoading(),n.form[0].reset())},error:function(n,t){t.btn.stopLoading();$.modal.close();EVO.Alert(n)},errorMessage:"Error resetting the password"});EVO.submit(".cinebuzz-top-form form.login-form",{success:function(n){EVO.user.refresh();EVO.movioTracker.setLogin();EVO.sso.login(n.response,function(){var t=n.form.data("submit-alternate");t&&$.isFunction(t)?t.call(this,n):EVO.redirectResponse(n.response)||(window.location="/Cinebuzz/Dashboard")})},error:function(n,t){EVO.Alert(n);t.btn.stopLoading()},errorMessage:"Incorrect username and/or password. Please try again."});EVO.submit(".cinebuzz-top-form form.register-form",{success:function(n){EVO.user.refresh();EVO.user.setJoined();var t=n.form.data("submit-alternate");t&&$.isFunction(t)?t.call(this,n):$(".cinebuzz-content").length>0?window.location.reload():window.location="/Cinebuzz/Dashboard/Complete#tab=edit-details-tab"},error:function(n,t){EVO.Alert(n);t.btn.stopLoading();n.indexOf("already exists")>-1&&$('.headers span[data-form="form.login-form"]').trigger("click")},errorMessage:"Unable to creat user"});EVO.change("#DateOfBirth",function(){var n=EVO.ParseDate($(this).val()),t=new Date,i=t.setYear(t.getFullYear()-14);$(".parent-approve-wrapper").showHide(n&&n>i)});EVO.user.updateUserContent();EVO.click(".cinebuzz-top-form .headers .big span[data-form]",function(){$(this).siblings(".active").inactive();$(this).active();$(".header-content").hide();var n=$($(this).data("form")).show(),t=n.find("input:first").focus()});$('input[name="PostCode"]').numericInt()},onDone:function(n){$(".top-bar .top-select").bind("done",n)},onChange:function(n){$(".top-bar .top-select .eccheckbox").bind("filter-clicked",n)},change:function(){$(".top-bar .top-select .eccheckbox:first").trigger("filter-clicked")},selectedCinemas:function(){return EVO.topbar.getIds($("#cinema-select"))},selectedMovies:function(){return EVO.topbar.getIds($("#movie-select"))},selectedCinemaNames:function(){return $("#cinema-select .eccheckbox.active").map(function(){return $(this).data("name")}).get()},selectedMovieNames:function(){return $("#movie-select .eccheckbox.active").map(function(){return $(this).data("name")}).get()},openCinemas:function(){$("#cinema-select").hasClass("open")||$("#cinema-select").trigger("click")},getIds:function(n){return $(".eccheckbox.active",n).map(function(){return $(this).data("id")}).get()},cinebuzzJoin:function(){EVO.topbar.cinebuzzBase("register-form")},cinebuzzLogin:function(n){EVO.topbar.cinebuzzBase("login-form",n)},cinebuzzBase:function(n,t){$.modal.close();t?$(".login-form .message").html(t).show():$(".login-form .message").html("").hide();$(".login-section .login:not(.open)").trigger("click");$('.cinebuzz-top-form .login [data-form="form.'+n+'"]').trigger("click")},updateFaveCinemaText:function(){var n=EVO.preferences.getFaveCinema();n&&n.id?($(".fave").text(n.name),$(".fave-url").attr("href",n.url),$(".fave-wrapper").addClass("fave-set"),$(".fave-short").text(n.shortName||n.name)):($(".fave").text("Favourite cinema"),$(".fave-short").text("my cinema"),$(".fave-url").attr("href","#"),$(".fave-wrapper").removeClass("fave-set"),$(".fave-cine-btn").inactive());$("body").trigger("fave-cinema-set")},onFaveChange:function(n){EVO.change(".fave-wrapper",n)},closeMenuMask:function(){$(".menu-mask.open").trigger("click")},openMenuMask:function(){}};$buoop={vs:{i:11,f:25,o:12.1,s:7},c:2,reminder:24,reminderClosed:150};EVO.user={get:function(n,t){var u,f,r,i,e;if(EVO.user.isCalling&&!t){u=0;f=setInterval(function(){(!EVO.user.isCalling||u>10)&&(clearInterval(f),EVO.user.get(n,!0));u++},200);return}r=EVO.sessionStorage.get(EVO.user.storageKey);i=function(){typeof n=="function"&&n.call(this,r)};r?i():(e=EVO.sessionStorage.get("_ecnouser"),e?i():(EVO.user.isCalling=!0,EVO.get({url:"/Cinebuzz/GetUserDetails",success:function(n){EVO.user.isCalling=!1;n?r=EVO.user.refresh():EVO.sessionStorage.set("_ecnouser",!0);i()},error:function(){EVO.user.isCalling=!1;i()}})))},updateUserContent:function(){EVO.user.get(function(n){n?($(".logged-out-content").hide(),$(".logged-in-content").show()):($(".logged-out-content").show(),$(".logged-in-content").hide());EVO.user.updateHeader(n)})},updateHeader:function(n){var i=$(".user-dependant"),t;n?(i.addClass("user-logged-in"),$(".cinebuzz-name").html(n.FirstName),$(".cinebuzz-number").html(n.CardNumber),$(".cinebuzz-barcode").html(n.CardNumber?'<img src="/Barcode/'+n.CardNumber+'" />':""),n.Points>0?($(".cinebuzz-points").html(n.Points),$(".cinebuzz-points-wrapper").show()):$(".cinebuzz-points-wrapper").hide(),$(".redeem-btn").each(function(t,i){var r=$(i).data("points");r>n.Points&&$(i).remove()}),t=$("header .login"),t.hasClass("open")&&t.trigger("click")):i.removeClass("user-logged-in")},refresh:function(){var t=$.cookie(EVO.user.storageKey),n;if(t)return n=JSON.parse(t),EVO.removeCookie(EVO.user.storageKey),EVO.sessionStorage.set(EVO.user.storageKey,n),n;EVO.user.clear()},clear:function(){EVO.sessionStorage.remove(EVO.user.storageKey);EVO.sessionStorage.remove("_ecnouser")},storageKey:"Cinebuzz",isCalling:!1,setLoggedInFaveCinema:function(){var n=EVO.preferences.getFaveCinema(),t;n||(t=EVO.user.get(function(n){n&&n.PreferredCinemas&&n.PreferredCinemas.length>0&&typeof n.PreferredCinemas[0]=="object"?EVO.preferences.setFaveCinema(n.PreferredCinemas[0]):$("body.show-fav-cinema").length>0&&(isTrue(EVO.sessionStorage.get("_evo_favcine"))||(EVO.sessionStorage.set("_evo_favcine",!0),$(".fave-wrapper .menu-mask-trigger:first:visible").trigger("click")))}))},joined:function(){isTrue(EVO.sessionStorage.get("_evojoined"))&&(EVO.sessionStorage.remove("_evojoined"),EVO.gaEvent("signup"))},setJoined:function(){EVO.sessionStorage.set("_evojoined",!0)}};EVO.watchlist={init:function(n){n=$.extend({success:undefined,error:undefined},n,{});EVO.watchlist.items=EVO.storage.get("evo_watchlist");EVO.user.get(function(t){!EVO.watchlist.items&&t?EVO.get({url:"/Cinebuzz/Watchlist",success:function(t){EVO.storage.set("evo_watchlist",t,1440);EVO.watchlist.items=t;typeof n.success=="function"&&n.success.call(this,EVO.watchlist.items)},error:function(t){typeof n.error=="function"?n.error.call(this,t):console.log(t)},errorMessage:"Error retrieving watchlist"}):EVO.watchlist.items&&typeof n.success=="function"?n.success.call(this,EVO.watchlist.items):EVO.watchlist.items=EVO.watchlist.items||[]})},add:function(n,t){EVO.watchlist.post({addIds:[n]},t)},remove:function(n,t){EVO.watchlist.post({removeIds:[n]},t)},clearLocal:function(){EVO.storage.remove("evo_watchlist")},post:function(n,t){EVO.post({url:"/Cinebuzz/Watchlist",data:n,success:function(n){EVO.storage.set("evo_watchlist",n,1440);typeof t=="function"&&t.call(this)},error:function(n){EVO.Alert(n)},errorMessage:"Error updating watchlist, please try again later"})}};EVO.addon={init:function(){EVO.order.setInApp();$("#addon-cinema-select .eccheckbox.active:not(:first)").inactive();EVO.hash(EVO.addon.update,!0);EVO.sessions.init();EVO.order.steps.tickets.init();EVO.order.steps.payment.init();EVO.order.steps.fab.init();$("#CardExpiry").cardExpiry();$("#CardNumber").creditCardMask();$("#GiftCardNumber").numericInt();$("#PIN").numericInt();EVO.click("form.payment-form .continue",function(){$(this).closest("form").submit()});EVO.submit("form.payment-form",function(){var n=$("#addon-wrapper"),t;if(n.isLoading()||!EVO.addon.validate($(this)))return!1;$("#step-content-wrapper").hide();n.loading({placement:"append"});t=$(this);window.scrollTo(0,0);EVO.post({url:t.attr("action"),data:t.serialize(),success:function(n){EVO.redirectResponse(n)||(n&&n.masterpass?MasterPass.client.checkout(n.masterpass):$(window).trigger("hashchange"))},error:function(t,i){EVO.redirectResponse(i,t)||(EVO.Alert(t),n.stopLoading())},errorMessage:"Unable to take payment"})});EVO.submit(".booking-details form",{success:function(n){var t=n.response;t&&t.sessionId&&(EVO.pushState({sessionId:t.sessionId}),n.btn.stopLoading())},error:function(n,t){EVO.Alert(n);t.btn.stopLoading()},errorMessage:"Error finding booking"});$("body").on("change","#addon-cinema-select",function(){$(this).trigger("update-text");var n=EVO.topbar.getIds($(this)).slice(0,1);$("#CinemaId").val(n)});$("#addon-cinema-select:visible").trigger("change");$("body").on("done","#addon-cinema-select",function(){var n=EVO.topbar.getIds($(this));EVO.updateState("cinemas",n.join())});EVO.click(".session-btn",function(){var t=$(this),n=t.data("sessionid");n&&EVO.pushState({sessionId:n})})},validate:function(n){var t=0;return($('select[name$="Quantity"]').each(function(){t+=($(this).val()||0)*1}),t===0)?(EVO.Alert("No items selected"),!1):EVO.order.steps.payment.validate(n)},update:function(){var t=EVO.getState(),s=t.orderToken,i=t.token,h=t.sessionId,n,f,e,r,u,c,l,o;if(s||i||h){if($("#addon-select-options").evohide(),$(".addon-concession-wrapper").evoshow(),n=$("#addon-wrapper"),isTrue(n.data("ignoreHashChange"))){n.data("ignoreHashChange",!1);return}n.isLoading()||n.loading({placement:"append"});window.scrollTo(0,0);EVO.get({url:"/Ticketing/AddOn/GetOrderDetails",data:{orderToken:s,sessionId:h,token:i,isMobile:EVO.isMobile()},success:function(t){var f,r,e,u;if(t){if(isTrue(t.confirm)){window.location="/Ticketing/Manage#token="+i;return}n.stopLoading();EVO.order.steps.fab.response(t);EVO.order.steps.fab.table.on("change",'select[name$="Quantity"]',function(){$(".payment-total .total").html($(".final-total .total").html());EVO.order.steps.payment.updateTotals()});EVO.order.steps.payment.response(t);$("#Token").val(t.Token);$("#step-content-wrapper").show();n.data("ignoreHashChange",!0);$('select[name$="Quantity"]:first').trigger("change");t.Token!==i&&($(window).off("hashchange"),f=window.location.href.split("#")[0],window.location.replace(f+"#token="+t.Token),EVO.hash(EVO.addon.update));r=$(".session-details");r&&r.data("sessionid")===t.SessionId||(e=$("#session-details-template"),u=$.tmpl(e,t),$("#order-details").html("").append(u.clone()).evoshow(),$(".mobile-session-info").html("").append(u));LazyLoadImages(null,{visibleOnly:!1})}n.stopLoading()},error:function(t){n.stopLoading();EVO.Alert(t)},errorMessage:"Error retrieving order details"})}else $("#addon-select-options").evoshow(),$(".addon-concession-wrapper").evohide(),f=EVO.topbar.getIds($("#addon-cinema-select")),f.length>0?($(".booking-details").show(),$("#session-list").show(),e=$("#addon-movie"),r=t.date,r||(u=e.data("firstsession"),u&&(c=EVO.ParseDate(u).toDate(),l=(new Date).toDate(),c>l&&(r=u))),EVO.sessions.getSessions({cinemaIds:f.slice(0,1),movieIds:((e.data("id")||"")+"").commaSeparatedInts(),date:r})):($(".booking-details").hide(),$("#session-list").hide());o=t.error;o&&EVO.Alert(o)}};EVO.cinebuzz={landing:function(){var n,t;EVO.click(".mobile-link",function(){var n=$(this).data("type");EVO.updateState("type",n);$(window).trigger("hashchange");$(".member-body").evomodal({containerCss:{"background-color":"#252728",width:"100%","min-height":"300px"}})});EVO.resize(function(){var t=$(this).height(),i=$(this).width(),n=i/(1280/375);n=Math.min(n,t-$("header").height()-32);$(".hero-image").height(n);EVO.isMobile()||$(".banner").height(n)});n=EVO.getState();n&&isTrue(n.express)&&(t=function(t,i){var r=n[t];r&&$(i).val(r)},t("email",".register-form #JoinEmail"),t("card",".register-form #CinebuzzCardNumber"));EVO.hash(function(){var n=EVO.getState(),i,t,r;typeof n.loyaltydisabled!="undefined"&&EVO.Alert("Cinebuzz is currently unavailable");typeof n.logon!="undefined"&&EVO.topbar.cinebuzzLogin();(typeof n.activate!="undefined"||typeof n.join!="undefined")&&($(".join-now").trigger("click"),i=n.promo,i&&$(".register-form #PromoCode").val(i));t=n.type||$("#DefaultCinebuzzExperience").val();t&&($("a.image-link").removeClass("selected"),$("a.image-link[data-type="+t+"]").addClass("selected"),$(".member-content").removeClass("current"),$(".member-content."+t).addClass("current"));r=n.error;typeof r!="undefined"&&(EVO.Alert(r),n.error="",EVO.pushState(n))},!0)},dashboard:function(){var n=$(".dashboard-containter");n.loading({placement:"append"});EVO.get({url:"/Cinebuzz/GetDashboardUser",success:function(t){if(!EVO.redirectResponse(t,{preRedirect:EVO.user.clear})){var i=$("#dashboard-template");n.stopLoading();n.append($.tmpl(i,t));n.data("model",t);EVO.cinebuzz.tabs.init();EVO.click(".btnAddCinema",function(){EVO.topbar.openCinemas()});EVO.user.refresh();EVO.tabs.init({defaultScreen:"dashboard-tab",jumpToTop:!0,ensureInView:!0})}},error:function(n){EVO.Alert(n,{onClose:function(){window.location="/Cinebuzz/Landing#logon"}})},errorMessage:"Error loading profile"})},resetpassword:function(){EVO.submit(".page-content form",{success:function(){EVO.user.refresh();EVO.user.updateUserContent();window.location="/Cinebuzz/Dashboard"},error:function(n,t){EVO.Alert(n);t.btn.stopLoading()},errorMessage:"Error resetting password"})},expressjoin:function(){EVO.submit(".page-content form",{success:function(n){n.btn.stopLoading();n.form.trigger("reset");EVO.Success("Thanks for your information, check your inbox to complete your enrolment")},error:function(n,t){t.btn.stopLoading();EVO.Alert(n)},errorMessage:"Error signing user up, please try again"})},getUserGiftCards:function(n){var t=$.extend({url:"/Cinebuzz/GetUserGiftCards",errorMessage:"Error retrieving Gift Cards"},n);EVO.get(t)},tabs:{init:function(){$(".option").on("selected",function(){var n=$(this),t;n.is(":visible")&&(t=$.trim(n.attr("class")).split(" "),$.each(t,function(t,i){var e=i.indexOf("-tab"),r,u,f;if(e>-1)return r=i.replace("-tab","").replace("-",""),$.isFunction(EVO.cinebuzz.tabs[r])&&(u=n.data("initialised"),f=$(".dashboard-containter").data("model"),EVO.cinebuzz.tabs[r].call(this,n,f,isTrue(u)),n.data("initialised",!0)),!1}))})},dashboard:function(n,t,i){i||EVO.cinebuzz.widgets.init(t)},watchlist:function(n,t,i){i||(EVO.click(".watchlist-refresh",function(){EVO.watchlist.clearLocal();$(".option.watchlist-tab").trigger("selected")}),EVO.click(".watchlist-remove",function(){var n=$(this).closest(".movie-container-item"),t=n.data("id"),i=n.data("moviecode");EVO.watchlist.remove(t,function(){$(".option.watchlist-tab").trigger("selected");EVO.movioTracker.movieWishList(i,!1)})}));var u=$(".no-watchlist",n).hide(),r=$(".movie-container",n);r.loadingLight({placement:"append"});EVO.watchlist.init({success:function(){r.stopLoading();var n=EVO.watchlist.items||[],t=$("#movie-thumb-template");r.find(".movie-container-item").remove();n.length>0?($.each(n,function(n,i){i.IsWatchlist=!0;r.append($.tmpl(t,i))}),setTimeout(function(){LazyLoadImages()},500)):u.show()},error:function(n){loader.stopLoading();EVO.Alert(n)}})},editdetails:function(n,t,i){i||(EVO.submit(".edit-details-tab form",{success:function(n){n.btn.stopLoading();EVO.Success("Your details have been successfully updated",{onClose:function(){t.IsCompleting?window.location="/Cinebuzz/Dashboard":$.modal.close()}});EVO.ClearValidationSummary()},error:function(n,t){EVO.Alert(n);t.btn.stopLoading()},errorMessage:"Error updating your profile",resetValidation:!0}),$("#EditUsername").setVal(t.User.Username),$("#EditFirstName").setVal(t.User.FirstName),$("#EditLastName").setVal(t.User.LastName),$("#EditEmail").setVal(t.User.Email),$("#ConfirmEmail").setVal(t.User.Email),$("#Address").setVal(t.User.Address),$("#Suburb").setVal(t.User.Suburb),$("#Postcode").setVal(t.User.PostCode),$("#State").setVal(t.User.State),$("#Mobile").setVal(t.User.MobileNumber),$("#EditGender").setVal(t.User.Gender),$("#EditPromoCode").setVal(t.User.PromoCode),isTrue(t.User.Subscribe)&&$("#Subscribe_checkbox").trigger("click"),$(".preference").each(function(n,i){var r=$('[name*="VistaPreferenceId"]',i).val(),u=$(".eccheckbox",i),f=$('[name*="IsActive"]',i);r&&$.inArray(r,t.User.Preferences)>-1?(u.active(),f.val(!0)):(u.inactive(),f.val(!1))}))},password:function(n,t,i){i||EVO.submit(".password-tab form",{success:function(n){EVO.Success("Password successfully changed",{onClose:function(){$.modal.close();n.btn.stopLoading();n.form[0].reset();window.location="/Cinebuzz/Dashboard"}})},error:function(n,t){EVO.Alert(n);t.btn.stopLoading()},errorMessage:"Error updating password",resetValidation:!0})},creditcard:function(n,t,i){i||($('[name="CardExpiry"]').cardExpiry(),$('[name="CardNumber"]').creditCardMask(),$("input[id*=CardNumber][type=tel]").bind("validcardtype",function(n,t){$(".options img.active").inactive();var i=$("[data-id=CardNumber]");t?($(this).data("type",t.code),$("input[id*=CardTypeId]").val(t.id),$('.options img[data-cardtypeid="'+t.id+'"]').active(),i.attr("data-selectedtype",t.code)):($(this).data("type",""),$("#CardTypeId").val(""),i.attr("data-selectedtype",""))}),EVO.submit(".manage-credit-card form",{success:function(n){EVO.Success("Card has been removed");n.form.closest("tr").remove();$(".manage-credit-card form").length===0&&$(".manage-credit-card").hide()},error:function(n,t){EVO.Alert(n);t.btn.stopLoading()},errorMessage:"Error removing Credit Card",resetValidation:!0}),EVO.submit("#form-credit-card",{success:function(n){$(".manage-credit-card").show();$.tmpl($("#success-card-add-template"),n.response).appendTo($(".manage-credit-card .table-content tbody"));EVO.Success("Card added succesfully");n.btn.stopLoading();n.form[0].reset()},error:function(n,t){EVO.Alert(n);t.btn.stopLoading()},errorMessage:"Error adding Credit Card",resetValidation:!0}))},giftcard:function(n,t,i){i||(EVO.submit("#form-gift-card",{success:function(n){$(".option.gift-card-tab").trigger("selected");n.btn.stopLoading();EVO.reset(n.form)},error:function(n,t){EVO.Alert(n);t.btn.stopLoading()},errorMessage:"Error adding gift card",resetValidation:!0}),EVO.submit(".manage-gift-card form",{success:function(n){n.form.closest("tr").remove();$(".manage-gift-card tbody tr").length===0&&$(".manage-gift-card").hide()},error:function(n,t){EVO.Alert(n);t.btn.stopLoading()},errorMessage:"Error removing Gift Card",resetValidation:!0}));var n=$(".manage-gift-card");n.isLoading()||(n.loading(),EVO.cinebuzz.getUserGiftCards({success:function(t){var i=$(".manage-gift-card tbody"),r;i.html("");t.cards&&t.cards.length>0?(r=$("#success-giftcard-add-template"),$.each(t.cards,function(n,t){i.append($.tmpl(r,t))}),n.show()):n.hide();n.stopLoading()},error:function(n){EVO.Alert(n)}}))},offers:function(n,t,i){!i},orders:function(n,t,i){var r,u;if(i||EVO.click(".orders-tab .headers span:not(.active)",function(){var t,n;$(".orders-tab .headers span.active").inactive();$(this).active();t=$($(this).data("content"));$(".order-content").hide();t.show();n=$(".orders-tab .past .book");$.trim(n.html()).length===0&&(n.loading({placement:"append"}),EVO.get({url:"/Cinebuzz/GetPastBookings",success:function(t){n.stopLoading();n.html(t);var i=$(".orders-tab .reward-footer").clone();n.find(".expiry-points").append(i)},error:function(n){EVO.Alert(n)},errorMessage:"Error retrieving past bookings"}))}),r=n.find(".upcoming .table-content:visible"),!isTrue(r.data("loaded"))){if(r.isLoading())return;r.children().remove();r.loading({position:"append"});EVO.get({url:"/Cinebuzz/GetUpcomingBookings",success:function(n){r.stopLoading();r.data("loaded",!0);$(".orders-tab .upcoming .table-content.mobile-content").append($.tmpl($("#upcoming-template-mobile"),{items:n}));$(".orders-tab .upcoming .table-content.desktop-content").append($.tmpl($("#upcoming-template-desktop"),{items:n}))},error:function(n){r.stopLoading();EVO.Alert(n)},errorMessage:"Error retrieving upcoming orders"})}u=EVO.getState();u.type==="past"&&($(this).find('span[data-content=".past"]').trigger("click"),u.type=undefined,EVO.pushState(u))},student:function(n,t,i){if(i||(EVO.submit(".student-tab form",{success:function(n){EVO.Success("Payment successfully taken",{onClose:function(){$.modal.close();$('.tab-link[data-option="student-tab"]').data("loaded",!1).trigger("change");n.btn.stopLoading()}})},error:function(n,t){EVO.Alert(n);t.btn.stopLoading()},errorMessage:"Error purchasing Student subscription",resetValidation:!0}),$("#CardExpiry").cardExpiry(),$("#CardNumber").creditCardMask(),$("#CardSecurityCode").numericInt()),!isTrue(n.data("loaded"))){var r=$(".student-tab").loading({placement:"append"});$(".student-prop").hide();EVO.get({url:"/Cinebuzz/GetStudentStatus",success:function(t){r.stopLoading();n.data("loaded",!0);t?($(".student-expiry").html(t),$(".already-student").show()):$(".debit-cards").show()},error:function(n){r.stopLoading();EVO.Alert(n)},errorMessage:"Error retrieving student status"})}}},widgets:{init:function(n){var n=$(".dashboard-containter").data("model"),r,i;if(n&&n.User){if(r=n.User,i=$("#dashboard-tab .grid-container"),!i.is(":visible"))return;i.find(".widget").remove();$(".widget-template").each(function(n,t){var e=$(t),u=$.tmpl(e,r),f;r.IsStaff&&isTrue(u.data("nostaff"))||(i.append(u),f=u.attr("id").alphaNumeric(),f&&$.isFunction(EVO.cinebuzz.widgets[f])&&EVO.cinebuzz.widgets[f].call(this,u))});$(".grid-container").data("packery")&&$(".grid-container").packery("destroy");var t=$(".grid-container").packery({itemSelector:".widget",columnWidth:".stamp",gutter:".gutter",initLayout:!1}),u=$(window).width(),f=EVO.storage.get("evo_dashpositions_"+n.User.Username+"_"+u);t.packery("initShiftLayout",f,"id");t.find(".widget").each(function(n,i){var r=new Draggabilly(i,{handle:".move"});t.packery("bindDraggabillyEvents",r)});t.on("dragItemPositioned",function(){var i=t.packery("getShiftPositions","id");EVO.storage.set("evo_dashpositions_"+n.User.Username+"_"+u,JSON.stringify(i))})}},pointstomovieswidget:function(n){var u=Math.PI,f=150,i=$(".pie-wrapper",n),t,r;i.length>0&&(i.each(function(n,t){var e=$(t),o=f,h=e.data("percent")||0,c=$(".outer",e),i=o/2,r=3.6*h,s;r%=360;r===0&&h>0&&(r=359.999);var l=r*u/180,a=Math.sin(l)*i,v=Math.cos(l)*-i,y=r>180?1:0,p="M 0 0 v -"+i+" A "+i+" "+i+" 1 "+y+" 1 "+a+" "+v+" z";c.attr("d",p);c.attr("transform","translate("+i+","+i+")");s=$(".inner",e);s.attr("d","M 0 0 v -"+i+" A "+i+" "+i+" 1 1 1 -0.001 -"+(i-1e-6)+" z");s.attr("transform","translate("+i+","+i+") scale(0.85)");$("svg",t).attr("width",o).attr("height",o)}),t=$(".slider-wrapper-flex .slider",n),t.slider({items:".pie-wrapper",wrapper:t,snap:!1,arrowHideClass:"noshow",useParentWidth:!0}),r=$(".slider-wrapper-flex .slider-container",n),t.outerWidth()<r.outerWidth()&&n.lazy({threshold:0,sliderLoader:function(){setTimeout(function(){t.animate({scrollLeft:100},300,function(){setTimeout(function(){t.animate({scrollLeft:0},300)},500)})},500)}}))},offerswidget:function(n){var i=$(".offer",n),t;i.length>0&&(t=$(".slider-wrapper-flex .slider",n),t.slider({items:".offer",wrapper:t,snap:!1,arrowHideClass:"noshow",useParentWidth:!0}))},watchlistwidget:function(n){var t=$(".slider-wrapper-flex",n).loading(!0),i=$(".no-watchlist",n).hide();EVO.watchlist.init({success:function(){var u;if(t.stopLoading(),u=EVO.watchlist.items||[],u.length>0){var e=$("#watchlist-item-widget-template"),r=$(".slider",t),f=$(".slider-container",r);$.each(u,function(n,t){f.append($.tmpl(e,t))});r.slider({items:".watchlist-item",wrapper:r,snap:!1,arrowHideClass:"noshow",useParentWidth:!0});setTimeout(function(){var n=LazyLoadImages(r,{chainable:!1});n.force($(".lazy:lt(4)",f))},500)}else i.show(),$(".arrow",n).hide(),t.hide()},error:function(n){loader.stopLoading();EVO.log(n)}})},rewardpointswidget:function(){EVO.click(".show-expiry",function(){EVO.Message("Points Expiring",$(".points-expiring-wrapper").html())})}}};EVO.cinemas={index:function(){EVO.getState().state||EVO.updateState("state",EVO.preferences.getStateSelector());EVO.filter.init();EVO.hash(function(){var n=EVO.getState().state||"all",i=$(".mobile-states a"),t;n&&EVO.isMobile()&&i.length>0&&($(".mobile-states a.active").inactive(),$('.mobile-states a[data-val="'+n+'"]').active(),$(".mobile-states a.active").get(0).scrollIntoView(!1));t=function(){$(".all-cinemas").evofilter({items:".cinema",filters:{state:function(){var n=getParam("state").commaSeparated(),t;return!n||n.length==0?!0:$.inArray("nearme",n)>-1?$(this).find(".distance").text().trim().length>0:(t=this.data("state"),$.inArray(t,n)>-1)},screen:function(){var n=getParam("exp").commaSeparated(),t;return!n||n.length==0?!0:(t=this.data("screentypes"),$.arrayIntersect(t,n).length>0)},nearme:function(){return!0}},after:function(){var t=n&&n==="nearme";$(".all .all-cinemas > a").sortElements(function(n,i){var r,u;return t?(r=$(n).data("distance")||0,u=$(i).data("distance")||0,r-u):(r=$(n).find(".title").text().trim(),u=$(i).find(".title").text().trim(),r>u)?1:r<u?-1:0});$(".cine-header").html("Showing "+$(".cinema").allVisible().length+" cinemas")}})};n&&n==="nearme"?EVO.location.get({success:function(n){var u=[],r;for($(".all-cinemas .cinema").each(function(t,i){var r=$(i).data("long"),f=$(i).data("lat"),e=EVO.location.distance(n.latitude,n.longitude,f,r);isTrue($(i).data("hassessions"))&&u.push({item:$(i),distance:e})}),u.sort(function(n,t){return n.distance-t.distance}),$(".all-cinemas .cinema .distance").html("&nbsp;"),$(".all-cinemas .cinema").data("distance",undefined),r=0;r<10;r++){var i=u[r],f=(i.distance>5?i.distance.toFixed(0):i.distance.toFixed(1))+"km",e=$(i.item).evoshow();e.closest("a").data("distance",i.distance).find(".distance").html(f)}t()},error:function(n){EVO.Alert(n)}}):($(".all-cinemas .distance").html(""),t())});$(".option.nearby").on("selected",function(){var n=$(this).find(".all-cinemas"),t;n.html("");t=n.loading({placement:"append"});EVO.location.get({success:function(n){var u=[],r,i,f;for($(".all .all-cinemas .cinema").each(function(t,i){var r=$(i).data("long"),f=$(i).data("lat"),e=EVO.location.distance(n.latitude,n.longitude,f,r);isTrue($(i).data("hassessions"))&&u.push({item:$(i),distance:e})}),u.sort(function(n,t){return n.distance-t.distance}),t.stopLoading(),r=0;r<10;r++)i=u[r],f=$(i.item).evoshow().closest("a").clone(),f.find(".distance").html((i.distance>5?i.distance.toFixed(0):i.distance.toFixed(1))+"km"),$(".option.nearby .all-cinemas").append(f)},error:function(i){n.html(i);t.stopLoading()}})});$(".option.all").on("selected",function(){var t=EVO.getState().state||"all",n;t&&EVO.isMobile()&&(n=$(".mobile-states a.active"),n.length>0&&n.get(0).scrollIntoView(!1))});EVO.tabs.init({defaultScreen:"all",headerWrapper:".headers"})},details:function(){var n,t,u,i,r,e,f;if($("#mobile-options").change(function(){$('.tabs span[data-option="'+$(this).val()+'"]').trigger("click")}),EVO.sessions.init(),EVO.corporatesales.init(),$(".option.promos,.option.events").bind("selected",function(){LazyLoadImages()}),$(".option.nowshowing").bind("selected",function(){EVO.sessions.getSessions({cinemaIds:[parseInt($("#Cinema_Id").val())],source:"www|cinemas"})}),$(".option.gettinghere").bind("activated",function(){var i=$("#Cinema_Longitude").val(),r=$("#Cinema_Latitude").val();if(i&&r){var f=document.getElementById("map_canvas"),u=new google.maps.LatLng(r,i),e={center:u,zoom:14,mapTypeId:google.maps.MapTypeId.ROADMAP},n=new google.maps.Map(f,e),o=new google.maps.Marker({map:n,position:u}),t;google.maps.event.addDomListener(window,"resize",function(){t&&clearTimeout(t);t=setTimeout(function(){var t=n.getCenter();google.maps.event.trigger(n,"resize");n.setCenter(t)},250)})}}),$(".themed").length>0){$(".option.nowshowing").trigger("selected");$(".option.gettinghere").trigger("activated");$("body").on("activated",".option",function(){$(this).is(":visible")&&$("html, body").animate({scrollTop:$(this).offset().top},100)});n=getParam("tab");n&&n.length>0&&setTimeout(function(){$("html, body").animate({scrollTop:$(".option."+n).offset().top},100)},500);t=function(){$(".view-all").each(function(n,t){var i=$($(t).data("wrapper")),r=i.height(),u=i.find(".inner").height();u<=r?$(t).hide():$(t).show()})};t();$(".desktop-content .events .same-height-wrapper").resizeToMax({additionalElements:$(".desktop-content .events .same-height-wrapper"),buffer:245,completed:t});$(".desktop-content .promos .same-height-wrapper").resizeToMax({additionalElements:$(".desktop-content .promos .same-height-wrapper"),buffer:245,completed:t});EVO.click(".view-all",function(){var n=$($(this).data("wrapper"));n.height("auto");$(this).hide()})}u=$("#init-tab").val();EVO.tabs.init({defaultScreen:u||"nowshowing",headerWrapper:".tabs",tabType:"> a"});$(".option.gettinghere").on("selected",function(){$(".gettinghere-btn").active()}).on("deselected",function(){$(".gettinghere-btn").inactive()});EVO.click(".cinema-details .dir",function(){var n=$('.tabs [data-option="gettinghere"]');n.trigger("click");$("html, body").animate({scrollTop:n.offset().top-100},100)});i=$(".fave-cine-btn").data("cinema");EVO.click(".fave-cine-btn",function(){var t=$(this),n=EVO.preferences.getFaveCinema();n&&n.id&&n.id===i.id?(t.inactive(),EVO.preferences.setFaveCinema()):(t.active(),EVO.preferences.setFaveCinema(i))});r=EVO.preferences.getFaveCinema();r&&r.id&&r.id===i.id&&$(".fave-cine-btn").active();e=$(".themed").length>0;$(".banners .img").length>0&&(f=$(".banners .desktop-banner-wrapper"),f.cycle({slides:"> a.img",pager:".cycle-pager",next:".cycle-next",prev:".cycle-prev",pagerTemplate:"<span><\/span>",autoHeight:!1,swipe:!0}));$("#cinema-gallery").length>0&&$("#cinema-gallery").magnificPopup({delegate:"div",type:"image",gallery:{enabled:!0,navigateByImgClick:!0,arrowMarkup:'<button type="button" class="mfp-arrow mfp-arrow-%dir%"><\/button>',preload:[0,1]},image:{titleSrc:function(n){return n.el.attr("data-caption")}}});EVO.sessions.filterScrollPositionInit()},pause:function(){$(".banners .desktop-banner-wrapper").cycle("pause")},print:function(){function n(i){var s=$(i+" .column.current"),r=$(i+" .column.next"),e=0,u=-1,f=$(i+" .current .col-item:visible"),o;f.each(function(n,i){return e+=$(i).outerHeight(),e>t?(u=n,!1):void 0});u!==-1&&u<f.length&&(r.length===0&&(o=$($(".column-template").html()).clone(),$(i).append(o),r=$(i).find(".column.left:last"),r.addClass("next")),f.slice(u).appendTo(i+" .column.next"),s.removeClass("current"),r.removeClass("next").addClass("current"),r.next(".column").addClass("next"),n(i))}var t=$(".column.current").height();n(".sessions-container");n(".synopsis-container");window.print()}};EVO.corporatesales={init:function(){EVO.submit(".contact-us-section form",{success:function(n){EVO.Success("Enquiry has been sent");n.form.trigger("reset");n.btn.stopLoading()},error:function(n,t){EVO.Alert(n);t.btn.stopLoading()},errorMessage:"Error submitting query"});$("#Telephone").numericInt()},index:function(){var n=!1;$(".option.movies").on("activated",function(){n||(n=!0,EVO.sessions.init(),EVO.movies.viewStyleOverride="list",EVO.movies.categories("comingsoon"))});EVO.click(".movie-options a",function(){var n=$(this).parent().data("value");$(".movie-options .active").inactive();n&&EVO.movies.categories(n)});EVO.click(".enquiry-btn",function(){var n=$(this).closest(".movie-container-item").data("name");n&&$("#Comments").val("Movie: "+n).trigger("input");$(window).scrollTop($(".options-wrapper").offset().top-100)},!0);EVO.tabs.init({defaultScreen:"overview"})}};EVO.error={init:function(){$(window).smartresize(function(){var t=$(this).height(),i=$(this).width(),n=i/(1280/720);n=Math.min(n,t-$("header").height()-32);$(".img").height(n)});$(window).trigger("resize")}};EVO.eventsfestivals={index:function(){},details:function(){var n=$(".movie-data").data("movies"),t;if(n&&n.length>0){EVO.sessions.init();$("body").on("change","#promo-cinema-select",function(){$(this).trigger("update-text")});$("body").on("done","#promo-cinema-select",function(){var n=EVO.topbar.getIds($(this));EVO.updateState("cinemas",n.join())});EVO.hash(function(){var r=EVO.topbar.getIds($("#promo-cinema-select")),t,i,u;r.length>0?($(".movie-list").hide(),$("#session-list").show(),t=$(".movie-data").data("dates"),EVO.sessions.getSessions({date:EVO.getState().date||t[0],validDates:t,cinemaIds:r,source:"www|movies",filter:function(){var n={movieIds:$(".movie-data").data("movieids"),screens:$(".movie-data").data("screens"),attribs:$(".movie-data").data("attribs")},t=EVO.ParseDate($(".movie-data").data("fromdate")),i=EVO.ParseDate($(".movie-data").data("todate"));(t||i)&&(n.sessionTimes={fromDate:t,toDate:i});EVO.sessions.filter(n)}})):($(".movie-list").show(),$("#session-list").hide(),i=$(".movie-list .movie-container").html("").addClass("list-view mobile-grid"),u=$("#"+i.data("template")),$.each(n,function(n,t){i.append($.tmpl(u,t))}),LazyLoadImages())},!0)}if(t=$(".photo-gallery-social .image-wrapper"),t.length>0&&t.cycle({slides:"> img",pager:"> .cycle-pager",pagerTemplate:"<span><\/span>",swipe:!0}),$(".related .slider-wrapper").resizeToMax({items:".ep-wrapper",additionalElements:$(".related .slider-wrapper"),completed:LazyLoadImages}),$(".related .slider").slider({items:".ep-wrapper",snap:!1}),$(".themed").length>0){EVO.change(".movie-container .top-select",function(){$(this).trigger("update-text")});$("body").on("done",".movie-container .top-select",function(){var n=EVO.topbar.getIds($(this)),t=$(this).siblings(".ftab"),i=t.data("url");n.length>0&&(i+="&cinemas="+n.join());t.attr("href",i)});EVO.isMobile()||($(".promo-banner-wrapper").resizeToMax({items:".top"}),$(".promo-banner-wrapper").resizeToMax({items:".bottom"}))}}};EVO.foodanddrink={index:function(){}};EVO.giftcard={balance:function(){$("#Pin").numericInt();EVO.submit("#giftcard-submit",{success:function(n){if(n.btn.stopLoading(),typeof n.response=="object"){if(n.response.giftCardDetails||n.response.voucherDetails){var t=$("#giftcarddetails-template"),i=$.tmpl(t,n.response);$("#card-details-wrapper").html("").append(i)}}else EVO.Success("Balance remaining: "+n.response)},error:function(n,t){EVO.Alert(n);t.btn.stopLoading()},errorMessage:"Error retrieving gift card balance"});EVO.hash(function(){var n=EVO.getState();n.cardNumber&&($("#GiftCardNumber").setVal(n.cardNumber),n.pin&&($("#Pin").setVal(n.pin),$("#giftcard-submit").trigger("submit")))},!0)}};EVO.home={index:function(){EVO.home.initHomepageBanners();$("body").on("fave-cinema-set",EVO.home.initHomepageBanners);ifvisible.on("idle",function(){$(".home-banners:visible").cycle("pause");$("[data-vimeoid]").each(function(n,t){var i=$(t).data("vimeo-player");if(i){$(t).data("vimeo-player",null);try{i.destroy()}catch(r){}}$(".vimeo-wrapper",t).html("")})});ifvisible.on("wakeup",function(){var n=$(".home-banners:visible .cycle-slide-active"),t=EVO.isMobile()?n.data("mobilevimeoid"):n.data("vimeoid");t?EVO.home.determineSlide($(".home-banners:visible"),n):isTrue(n.data("static"))||$(".home-banners:visible").cycle("resume")});var n="home-swipe";EVO.click(".swipe-tut",function(){$(this).remove();EVO.preferences.setProperty(n,!0)});isTrue(EVO.preferences.collection[n])&&$(".swipe-tut").trigger("click");EVO.click(".movie-options span",function(){var t=$(this),i,n;if(t.isActive())return!1;$(".movie-options span").inactive();t.active();i=t.data("url");n=$(".movie-container");n.loadingLight({placement:"append"});$(".movie-container-item",n).remove();EVO.movies.getMovies(i,function(t){n.stopLoading();$.each(t.Movies,function(t,i){n.append($.tmpl($("#movie-thumb-template"),i))});$(".slider").slider({items:".movie-container-item",offset:40,snap:function(){return!EVO.isMobile()}});var i=LazyLoadImages(n,{visibleOnly:!1,chainable:!1});i.force($(".lazy:lt(4)",n))})});$("#MovieOptions").change(function(){var n=$(this).val();$('.movie-options span[data-url="'+n+'"]').trigger("click")});$(".movie-options:visible span:first").trigger("click");typeof addToHomescreen!="undefined"&&addToHomescreen({skipFirstVisit:!0,startDelay:3,maxDisplayCount:2,displayPace:10080});EVO.isMobile()&&EVO.user.get(function(n){n&&(EVO.home.watchlist(),EVO.home.upcomingOrders(),EVO.click(".mobile-items-wrapper.watchlist .refresh",function(){EVO.home.watchlist(!0)}),EVO.click(".mobile-items-wrapper.upcoming .refresh",function(){EVO.home.upcomingOrders(!0)}))})},pause:function(){$(".home-banners").cycle("pause");var n=$("[data-vimeoid]:visible").data("vimeo-player");n&&isTrue($(n._originalElement).data("vimeo-initialized"))&&n.pause()},resume:function(){$(".home-banners").cycle("resume");var n=$("[data-vimeoid]:visible").data("vimeo-player");n&&isTrue($(n._originalElement).data("vimeo-initialized"))&&n.play()},initHomepageBanners:function(){var n=$(".home-banners:visible"),r,u,f,e,o,t;if(n.data("cycle.opts")&&n.cycle("destroy"),n.find('.wrapper[data-fave-cine="true"]').remove(),r=EVO.preferences.getFaveCinema(),r){for(t=[],u=n.find("> .wrapper"),i=0;i<u.length;i++)f=$(u[i]),isTrue(f.data("nationalonly"))&&t.push({index:i,val:f});e=$("#fave-cinema-banners").data("cinema-banners");e&&(o=$("#homepage-banner-template"),$.each(e,function(t,i){if(i.id&&i.id===r.id){var f=i.Galleries,u=$("#max-mobile").val()*1;return $.each(i.Galleries,function(t,i){i.desktopOnly=t>=u;i.fave=!0;n.prepend($.tmpl(o,i))}),!1}}));n.find('.wrapper[data-nationalonly="True"]').remove();$("body").data("national",t)}else t=$("body").data("national")||[],t&&t.length>0&&$.each(t,function(t,i){n.insertAt(i.index,i.val)});n.on("cycle-pager-activated",function(){n.cycle("resume")});n.on("cycle-pre-initialize",function(){var t=n.data("cycle.opts");t&&t.slides&&t.slides.length>0&&EVO.home.determineSlide(n,$(t.slides[0]))});n.on("cycle-before",function(n,t,i,r){$(r).removeClass("inactive")});n.on("cycle-after",function(t,i,r,u){EVO.home.determineSlide(n,$(u));$(r).addClass("inactive").data("vimeocomplete",!1)});n.cycle({slides:EVO.isMobile()?"> .wrapper:not(.desktop-content)":"> .wrapper:not(.mobile-content)",pager:".cycle-pager",next:".cycle-next",prev:".cycle-prev",pagerTemplate:"<span><\/span>",autoHeight:!1,swipe:!0,timeout:6e3});EVO.click(".unmute",function(){var t=$(this),i=t.closest(".wrapper"),n=i.data("vimeo-player");n&&(t.isActive()?(t.inactive(),n.setVolume(0)):(t.active(),n.evo_counter=0,n.setCurrentTime(0),n.setVolume(1)))})},determineSlide:function(n,t){var o=isTrue(t.data("static")),r,i,u,f,e;if(o&&n.cycle("pause"),r=EVO.isMobile()?t.data("mobilevimeoid"):t.data("vimeoid"),r)if(n.cycle("pause"),i=t.data("vimeo-player"),i&&isTrue($(i._originalElement).data("vimeo-initialized")))i.play();else if(u=function(){var f={id:r,height:n.outerHeight(),width:n.width(),loop:o,byline:!1,background:!0,muted:!0},i=new Vimeo.Player(t.find(".vimeo-wrapper").attr("id"),f),u=function(){n.cycle("next");n.cycle("resume")};i.on("error",u);i.evo_played=!1;i.on("timeupdate",function(n){n.percent>=.5&&(i.evo_played=!0);(n.percent>0&&n.percent<.5&&i.evo_played||n.percent>.97&&i.evo_played)&&(i.evo_played=!1,isTrue(t.data("vimeocomplete"))||(t.data("vimeocomplete",!0),EVO.gaEvent("hpvimeocomplete"),u(),i.setCurrentTime(0),i.pause()))});t.data("vimeo-player",i);i.play()},typeof Vimeo=="undefined"){f=document.createElement("script");f.src="https://player.vimeo.com/api/player.js";e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(f,e);var s=0,c=10,h=setInterval(function(){typeof Vimeo=="undefined"?(s++,s>c&&(clearInterval(h),n.cycle("next"),n.cycle("resume"))):(clearInterval(h),u())},200)}else u()},determineSlideYT:function(n,t){var i=t.data("youtubeid"),r,o,u,f,e;i&&(EVO.home.pause(),r=t.data("yt-player"),r?r.playVideo():(o=t.find(".youtube-wrapper"),u=function(){var r=isTrue(t.data("static")),u=new YT.Player(o.attr("id"),{height:n.outerHeight(),width:n.width(),videoId:i,playerVars:{autoplay:1,controls:0,showinfo:0,modestbranding:1,loop:r?1:0,fs:0,cc_load_policy:0,iv_load_policy:3,autohide:0,rel:0,playlist:i},events:{onReady:function(n){n.target.mute()},onStateChange:function(t){t.data!==0||r||(n.cycle("next"),n.cycle("resume"))},onError:function(){n.cycle("next");n.cycle("resume")}}});t.data("yt-player",u)},typeof YT=="undefined"?($("body").data("youtube-listener",u),f=document.createElement("script"),f.src="https://www.youtube.com/iframe_api",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(f,e)):u()))},watchlist:function(n){var t=$(".mobile-items-wrapper.watchlist");t.isLoading()||(n&&EVO.watchlist.clearLocal(),$(".home-list",t).remove(),t.loading({placement:"append"}),EVO.watchlist.init({success:function(n){var i=$("#home-watchlist-mobile-template");t.append($.tmpl(i,{items:n.slice(0,3)}));t.stopLoading()},error:function(n){t.append('<div class="home-list"><div class="no-items">'+n+"<\/div><\/div>");t.stopLoading()}}))},upcomingOrders:function(n){var t=$(".mobile-items-wrapper.upcoming");t.isLoading()||($(".home-list",t).remove(),t.loading({placement:"append"}),EVO.order.getUpcoming({callServer:n,success:function(n){var i=$("#home-upcoming-mobile-template");t.append($.tmpl(i,{orders:n.slice(0,3)}));t.stopLoading()},error:function(){EVO.Alert("Error getting watchlist")}}))},watchlistSubtext:function(n){var i=" ",t,r,u;return n&&n.ReleasedAt&&(t=EVO.ParseDate(n.ReleasedAt),t<new Date?i="Now Showing":(r=Math.round((t-new Date)/864e5),u=DateFormat.format.date(t,"d MMM"),i=u+" - "+r+" days to go")),i}};EVO.manage={index:function(){var n,t;EVO.order.setInApp();n=EVO.getState();n.error&&EVO.Alert(n.error);t=function(n){if(n.hasClass("disabled")){var t=n.data("message");return t?EVO.Alert(t):EVO.Alert("Error processing request"),!0}return!1};EVO.click(".option-selector[data-section]",function(){var n,i,r;if(t($(this)))return!1;n=$(this).data("section");n&&(i=$(n),i.length>0&&i.get(0).scrollIntoView({behavior:"smooth",block:"start",inline:"start"}));r=$(this).data("click");r&&$(r).trigger("click")});EVO.click("#swap",function(){$("#change-seats").addClass("swapping");var n=$("#seats-wrapper .seats .taken[data-seat]");$("#seats-wrapper .seats-wrapper").data("totalseats",n.length);$("#seats-wrapper .seat-row .current").removeClass("selected");n.trigger("click")});EVO.click(".confirm-swap",function(){var r=$(this),s,t,u,i,n,o;if(r.isLoading())return!1;if((s=EVO.manage.actualSeats,t={},$.each(EVO.manage.actualSeats,function(n,i){var r=i.AreaId+"";t[r]=t[r]||0;t[r]+=1}),u=EVO.manage.getSelectedSeats(),i={},$.each(u,function(n,t){var r=t.AreaId+"";i[r]=i[r]||0;i[r]+=1}),n=!0,$.each(t,function(t,r){var u=i[t]||0;u>r?(EVO.Alert("Too many seats selected for the area"),n=!1):u<r&&(EVO.Alert("You have not selected enough seats"),n=!1)}),n)&&($.each(i,function(i,r){var u=t[i]||0;u>r?(EVO.Alert("You have not selected enough seats"),n=!1):u<r&&(EVO.Alert("Too many seats selected for the area"),n=!1)}),n)){var e=$(this).closest(".confirm-swap-wrapper"),h=$(".seat-selection",e).data("sessionid"),c=$.map(u,function(n){return n.SeatName}),f=EVO.manage.response;f&&f.Seating&&f.Seating.Seats&&(r.btnLoading(),o={newSessionId:h,newSeats:c,token:getParam("token")},EVO.post({url:"/Api/Ticketing/SwapSeats",data:o,success:function(){EVO.Success("Seats succesfully swapped",{onClose:function(){location.reload()}});r.stopLoading()},error:function(n,t){EVO.Alert(n);t&&t.Data&&t.Data.Seating&&e.find("#seats-wrapper").html($.tmpl($("#seats-template"),t.Data.Seating));r.stopLoading()},errorMessage:"Error swapping seats"}))}});EVO.click("#cancel-swap",function(){$("#change-seats").removeClass("swapping");$("#seats-wrapper .seat-row .selected").removeClass("selected");$("#seats-wrapper .seat-row .current").addClass("selected")});EVO.click("#cancel-session-swap",function(){$("#change-seats").removeClass("swapping");$("body").removeClass("swapping-session");$("#movie-overview-list").html("");$("#session-swap-wrapper .session-info.to").html("");$("#session-swap-seating-plan").html("")});EVO.click("#change-seats.swapping [data-seat], #session-swap-seating-plan [data-seat]",function(){var n=$(this),f=n.data("seat"),t=[],e,c,i,o,r;if(EVO.any(f.RelatedSeats)&&(e=n.closest(".seats-wrapper"),$.each(f.RelatedSeats,function(n,i){t.push($('[data-seatname="'+i+'"]',e))})),n.hasClass("selected")){n.removeClass("selected");$.each(t,function(n,t){t.removeClass("selected")});return}c=EVO.manage.actualSeats;i={};$.each(EVO.manage.actualSeats,function(n,t){var r=t.AreaId+"";i[r]=i[r]||0;i[r]+=1});o=EVO.manage.getSelectedSeats();r={};$.each(o,function(n,t){var i=t.AreaId+"";r[i]=r[i]||0;r[i]+=1});var s=n.data("seat"),u=i[s.AreaId+""]||0,h=r[s.AreaId+""]||0;if(u===0){EVO.Alert("You can only swap seats in the area you have purchased");return}if(h>=u){EVO.Alert("ALL SEATS HAVE BEEN SELECTED<br />You have already selected all of your seats.<br />To make alternative choices please toggle your seats(s) on and off by clicking on them again.");return}if(t.length>0&&h+t.length>=u){EVO.Alert("TOO MANY SEATS HAVE BEEN SELECTED<br />You do not have enough tickets for the selected seats.<br />To make alternative choices please toggle your seats(s) on and off by clicking on them again.");return}n.addClass("selected");$.each(t,function(n,t){t.addClass("selected")})});EVO.click("#swap-session",function(){var n=$(this);if(t(n)||n.setLoading())return!1;EVO.get({url:"/Api/Ticketing/GetValidSwapSessions",data:{token:n.data("token")},success:function(t){if(t&&t.length>0){$("body").trigger("scroll");$("#session-swap-wrapper").removeClass("seating");var u=$("#session-list-template"),f=$("#movie-overview-list").html(""),i=$("#session-list .dates"),e=$("#date-template"),r=$("#session-list");r.appendTo($("#session-list-wrapper"));$(".date-mov-wrapper").remove();i.html("");$.each(t,function(n,t){var c=EVO.ParseDate(t.Date),s=DateFormat.format.date(c,"yyyy-MM-dd"),h,o;i.append($.tmpl(e,{date:s}));f.append($.tmpl(u,t));h=$.tmpl($("#session-list-template"),t);o=$("<div/>").addClass("date-mov-wrapper").attr("data-date",s);o.html(h);r.append(o)});EVO.sessions.init();$("body").addClass("swapping-session");$("#session-swap-wrapper").get(0).scrollIntoView();$(window).trigger("hashchange")}n.stopLoading()},error:function(t){n.stopLoading();EVO.Alert(t)},errorMessage:"Error getting session swap data"})});EVO.click("#session-list .session-btn",function(){var t,n;$("body").trigger("scroll");t=$("#session-list");$("#session-swap-wrapper").get(0).scrollIntoView();n=t.loading(!0);EVO.post({url:"/Api/Ticketing/GetSeatingOptions",data:{token:getParam("token"),sessionId:$(this).data("sessionid")},success:function(t){n.stopLoading();$("#session-swap-seating-plan").html("");t.Seats&&($("#session-swap-seating-plan").append($.tmpl($("#seats-template"),t)),$("#session-swap-wrapper").addClass("seating"));t.SessionDetails.Title="New Session";$("#session-swap-wrapper .session-info.to").html($.tmpl($("#session-details-template"),t.SessionDetails));LazyLoadImages()},error:function(t){n.stopLoading();EVO.Alert(t)},errorMessage:"Error swapping sessions"})});EVO.click("#show-legend",function(){$("#seats-wrapper .legend").show();$(this).hide()});EVO.click(".back-to-top",function(){$(".ticket-wrapper").get(0).scrollIntoView({behavior:"smooth"})});EVO.hash(function(){EVO.manage.update(function(){if($("#session-list:visible").length>0){var n=EVO.getState().date,t=$("#session-list .dates");t.find(".active").inactive();n||(n=t.find(".date:first").data("date"));n&&($('.date-mov-wrapper[data-date="'+n+'"]').show(),$('.date-mov-wrapper[data-date!="'+n+'"]').hide(),t.find('.date[data-date="'+n+'"]').active(),LazyLoadImages())}})},!0)},update:function(n){var u=EVO.getState(),i=u.token,t,r;if(i){if(t=$(".share-content"),r=t.data("token"),r&&r===i){$.isFunction(n)&&n.call(this);return}t.data("token",i);t.loading();EVO.get({url:"/Manage/Order",data:{token:i},success:function(r){var f,e,o,u;EVO.redirectResponse(r)||t.data("token")===i&&(t.stopLoading(),f=$.tmpl($("#order-template"),r),EVO.manage.response=r,r.Seating&&r.Seating.Seats&&r.Seating.Seats.SelectedSeats&&(EVO.manage.actualSeats=EVO.manage.getSeatsFromSeatNames(r.Seating.Seats.SelectedSeats)),t.html(f),r.Seating&&r.Seating!==null&&!r.Seating.SoldOut&&$("#seats-wrapper").length>0&&($("#seats-wrapper").append($.tmpl($("#seats-template"),r.Seating)),EVO.order.steps.seats.ensureSelectedSeatsInView()),t.data("sessiondetails",r.sessionDetails),r.addOns&&r.addOns.length>0&&(e=$("#fab-model-template"),o=$(".conc-wrapper"),$.each(r.addOns,function(n,t){t.Guid=EVO.Guid();t.Group="OrderConcessionItems";t.Manage=!0;t.token=r.token;o.append($.tmpl(e,t))}),u=$(".slider-wrapper-flex .slider"),u.slider({items:".fab-details",wrapper:u,snap:!1,arrowHideClass:"noshow"}),LazyLoadImages(u)),r.upcoming&&EVO.order.setUpcoming(r.upcoming),EVO.manage.complete(r),isTrue(getParam("print"))&&window.print(),$.isFunction(n)&&n.call(this))},error:function(n){EVO.Alert(n)},errorMessage:"Error finding order details"})}},complete:function(n){$(".skin-bg").lazy({visibleOnly:!0,afterLoad:function(n){$(n).closest(".not-loaded").removeClass("not-loaded")}});LazyLoadImages();$("#ShareUrl").trigger("input");new Clipboard(".copy-btn");EVO.storage.remove("evo_abandon");var t=EVO.preferences.getFaveCinema();t||EVO.preferences.setFaveCinema(n.cinema);typeof dataLayer!="undefined"&&(EVO.order.sendTrans(function(){EVO.addTrans(n.ecom.trans,n.ecom.tickets,n.ecom.concs,n.ecom.bookingFee);dataLayer.push({event:"paymentconfirmation"})}),dataLayer.push({event:"confirmationok"}));EVO.manage.whatsappIEFFFix();$("#session-swap-wrapper .session-info.from").html($.tmpl($("#session-details-template"),n.sessionDetails))},whatsappIEFFFix:function(){if($.browser.msie||$.browser.mozilla){var n=$(".whatsapp-share").attr("href"),t=n.replace("api.whatsapp","web.whatsapp");$(".whatsapp-share").attr("href",t)}},getSeatsFromSeatNames:function(n){var u,t,i,r,f;if(!n)return[];if(typeof n=="string"&&(n=[n]),u=[],t=EVO.manage.response,t.Seating&&t.Seating.Seats&&t.Seating.Seats.Rows)for(i=0;i<t.Seating.Seats.Rows.length;i++)for(r=0;r<t.Seating.Seats.Rows[i].Seats.length;r++)f=t.Seating.Seats.Rows[i].Seats[r],$.inArray(f.SeatName,n)>-1&&u.push(f);return u},getSelectedSeats:function(){return $(".seat-selection:visible .seats .selected").map(function(n,t){return $(t).data("seat")}).get()}};EVO.moonlight={rainout:function(){var n,t;EVO.submit(".page-content form",{success:function(n){var r,t,i,u;n.btn.stopLoading();$(".rainout-details").remove();$(".simple-page").after($.tmpl($("#details-template"),n.response.OriginalOrder));r=$("#session-list-template");t=$("#movie-overview-list").html("");$.each(n.response.RainoutSessions,function(n,i){var f=EVO.ParseDate(i.Date),u;t.append('<span class="date">'+DateFormat.format.date(f,"ddd D MMMM")+"<\/span>");u={Movies:[i.Movie]};t.append($.tmpl(r,u))});i=$(".popup-trailer").removeClass("grey").addClass("blue").removeClass("popup-trailer").html("View Details");u=i.closest(".movie-list-item").data("url");i.attr("href",u);LazyLoadImages()},error:function(n,t){EVO.Alert(n);t.btn.stopLoading()},errorMessage:"Error finding moonlight order"});$("body").bind("sessionsloaded",function(){$(".popup-trailer").removeClass("grey").addClass("blue").removeClass("popup-trailer").html("View Details")});$("body").on("click",".session-btn",function(){var n=$(this),t=n.closest(".movie-list-item"),i=t.data("name"),r=DateFormat.format.date(EVO.ParseDate($(this).data("time")),"ddd D MMMM");return EVO.Confirm("Swap to see '"+i+"' on "+r+"?",function(){EVO.post({url:"/Moonlight/SwapTickets",data:{bookingReference:$("#VistaTransactionReference").val(),sessionId:n.data("sessionid"),cinemaId:$("#SelectedCinemaId").val()},success:function(){EVO.Success("Tickets have been successfully swapped.")},error:function(n){EVO.Alert(n)},errorMessage:"Error swapping tickets. Please try again later."})}),!1});EVO.click(".movie-thumb-wrapper .poster-anchor",function(){});n=getParam("ref");n&&($("#BookingReference").val(n),t=getParam("cinemaId"),t&&($("#SelectedCinemaId").val(t),$(".page-content form").submit()))}};EVO.movies={index:function(){},details:function(){var i=function(){var n=$(".movie-details .bg-img-wrapper .img").length,t;n===0?$(".movie-details").addClass("noskin"):n===1?$(".movie-details .bg-img-wrapper .img").show():(t=$(".movie-details .bg-img-wrapper"),t.cycle({slides:"> .img",pager:".cycle-pager",next:".cycle-next",prev:".cycle-prev",pagerTemplate:"<span><\/span>",autoHeight:!1,swipe:!0,timeout:5e3,delay:5e3}),$(".bg-img-wrapper").addClass("hasitems"));LazyLoadImages()},t,r,n,u,f;$(".skin-bg").lazy({visibleOnly:!0,onError:function(n){$(n).closest(".skin").remove();$(".poster .popup-trailer").evoshow();i()},afterLoad:function(){i()}});t=parseInt($("#Movie_Id").val());$(".watchlist-wrapper").length>0&&EVO.watchlist.init({success:function(){var n=EVO.watchlist.items.findIndex(function(n){return n.Id===t});n>-1&&$(".watchlist-wrapper").active()}});$("body").on("done","#add-cinemas",function(){var n=EVO.topbar.getIds($(this));EVO.updateState("cinemas",n.join())});EVO.sessions.init();$(".promotions .slider-wrapper").resizeToMax({items:".ep-wrapper",additionalElements:$(".promotions .slider-wrapper")});r=EVO.getState().date;r||(n=$("#FirstSession").val(),n&&(u=EVO.ParseDate(n).toDate(),f=(new Date).toDate(),u>f&&EVO.updateState("date",n)));EVO.movioTracker.movieDetail($("#Movie_MovieCode").val());$(".promotions .slider").slider({items:".ep-wrapper",snap:!1});isTrue(EVO.getState().media)&&($(".movie-details .popup-trailer:first").trigger("click"),EVO.updateState("media"));EVO.click(".mobile-headers span",function(){var n=$($(this).data("section"));$(".mobile-section").hide();n.show();$(".mobile-headers span").inactive();$(this).active();n.trigger("active")});EVO.click(".showall-promos a",function(){$(this).remove();$(".promotions").addClass("showing-all")});EVO.click(".watchlist-option",function(){var n=$(this).closest(".watchlist-wrapper"),t=n.data("id"),i=$("#Movie_MovieCode").val();EVO.user.get(function(r){if(!r){$(".cinebuzz-top-form form").data("submit-alternate",function(){EVO.movioTracker.movieWishList(i,!1);EVO.watchlist.add(t,function(){window.location.reload()})});EVO.topbar.cinebuzzLogin();return}n.isActive()?(n.inactive(),EVO.watchlist.remove(t),EVO.movioTracker.movieWishList(i,!1)):(n.active(),EVO.watchlist.add(t),EVO.movioTracker.movieWishList(i,!0))})});$(".trailers-content").on("active",function(){if($.trim($(this).html()).length===0){var n={TrailerUrl:$(this).data("trailers"),Rating:"",Title:""},t=$.tmpl($("#movie-trailer-video-template"),n);$(this).append(t)}EVO.helper.loadTrailer()});EVO.hash(function(){var i=EVO.getState(),n=(i.cinemas||"").commaSeparatedInts();n&&n.length>0?$(".find-times").removeClass("no-cinemas"):$(".find-times").addClass("no-cinemas");EVO.sessions.getSessions({movieIds:[t],source:"www|movies"})},!0)},nowshowing:function(){$('#sortby option[value="release"]').remove();$('#sortby option[value="advanced"]').remove();EVO.movies.categories("nowshowing")},advancetickets:function(){EVO.movies.categories("advancetickets")},comingsoon:function(){$('#sortby option[value="popularity"]').remove();EVO.movies.categories("comingsoon")},getMovies:function(n,t,i){var r=$(".movie-container").data("url");n!==r?($(".movie-container").data("url",n),EVO.get({url:n,success:function(n){t(n);i&&$.isFunction(i)&&i()},error:function(n){EVO.Alert(n)},errorMessage:"Error retrieving movies"})):i&&$.isFunction(i)&&i()},categories:function(n){var e=$('.categories .movie-options .big span[data-value="'+n+'"]').active(),i,u,f,t,r;$("#MovieOptions").val(n);i=$(".movie-container");i.loadingLight({placement:"append"});u=e.text();i.addClass("mobile-grid");$(".movie-container-item",i).remove();$(".movie-container").removeData("sortedBy");EVO.movies.firstLoad&&(EVO.movies.firstLoad=!1,EVO.click(".mobile-filter",function(){$("body").addClass("mobile-filter-open");$(".right-filter").addClass("mobile-filtering").height("auto")}),EVO.click(".mobile-filter-done",function(){$("body").removeClass("mobile-filter-open");$(".right-filter").removeClass("mobile-filtering")}),EVO.click(".movie-list-info .view-style",function(){var n=$(this).data("type");EVO.movies.viewStyleOverride||EVO.preferences.setProperty("movie-view-style",n);$(".movie-list-info .view-style").inactive();$(this).active();n==="list"?$(".movie-container").addClass("list-view"):$(".movie-container").removeClass("list-view")}),f=EVO.movies.viewStyleOverride||EVO.preferences.collection["movie-view-style"]||$(".movie-list-info .view-style.active").data("type")||"grid",$('.movie-list-info .view-style[data-type="'+f+'"]').trigger("click"),t=EVO.movies.sortByOverride,t||(t=getParam("sortby"),t||(t=EVO.preferences.collection["movie-"+n+"-sort-by"],t||(t=$("#sortby").val()))),t&&($("#sortby").val(t),$(".sortby-mobile-option.active").inactive(),$('.sortby-mobile-option[data-option="'+t+'"]').active()),$("#sortby").change(function(){var t=$(this).val();EVO.preferences.setProperty("movie-"+n+"-sort-by",t);$(".sortby-mobile-option.active").inactive();$('.sortby-mobile-option[data-option="'+t+'"]').active();EVO.updateState("sortby",t)}),EVO.click(".sortby-mobile",function(){var n=$("#sortby"),t=$("option",n).length,i=n.prop("selectedIndex"),r=(i+1)%t;n.prop("selectedIndex",r).trigger("change")}),$("#MovieOptions").change(function(){var n=$(this).val();window.location=$('.movie-options .big span[data-value="'+n+'"] a').attr("href")}),r=function(n){var i=DateFormat.format.date(EVO.ParseDate(n.data("release")),"yyyyMMdd"),t=n.data("popularity")+"",r=("999999"+t).substring(t.length),u=(n.data("name")+"").replace(/[\W_-]/g,"").toLowerCase();return i+r+u},$(window).bind("hashchange",function(){var n=$(".categories .movie-options .big .active").data("url");EVO.movies.getMovies(n,function(n){i.stopLoading();$.each(n.Movies,function(n,t){i.append($.tmpl($("#movie-thumb-template"),t))});EVO.filter.addFilterOptions(n.Genres,"genre",$('.filter[data-filter-attribute="genre"]'));EVO.filter.addFilterOptions(n.Experiences,"exp",$('.filter[data-filter-attribute="exp"]'));EVO.filter.init({resizeParent:!0});$(".initial-hide").show()},function(){$(".movie-container").evofilter({items:".movie-container-item",filters:{genre:function(){var n=getParam("genre").commaSeparated(),t;return!n||n.length===0?!0:(t=this.data("genres").commaSeparated(),$.arrayIntersect(t,n).length>0)},exp:function(){var n=getParam("exp").commaSeparated(),t;return!n||n.length===0?!0:(t=$.map(this.data("experiences")||[],function(n){return n.code}),$.arrayIntersect(t,n).length>0)}},after:function(n){var i=$(this).find(".movie-container-item:visible").length,t,f;$(".movie-count").html(i+" movies "+u.toLowerCase()).show();t=$(".filter-message");i>0?(t.hide(),f=getParam("sortby")||$("#sortby").val(),$(this).sortBy({sortBy:f,items:n.items,sortData:{popularity:function(n){return-n.data("popularity")||0},alphabetical:function(n){return(n.data("name")+""||"").toLowerCase()},release:function(n){return r(n)},advanced:function(n){var t=r(n),i=n.data("firstsession");return i?"."+t:t}}}),LazyLoadImages()):(EVO.filter.buildNoResultsText({usesTopBar:!1}),t.show())}})})}));$(window).trigger("hashchange")},pause:function(){$(".movie-details .bg-img-wrapper").cycle("pause")},viewStyleOverride:undefined,sortByOverride:undefined,firstLoad:!0};EVO.premiumcinema={details:function(){EVO.change(".nowshowing.option .top-select",function(){$(this).trigger("update-text")});$("body").on("activated",".option",function(){LazyLoadImages()});$("body").on("done",".nowshowing.option .top-select",function(){var n=EVO.topbar.getIds($(this)),t=$(this).siblings(".ftab"),i=t.data("url");n.length>0&&(i+="&cinemas="+n.join());t.attr("href",i)});EVO.tabs.init({defaultScreen:"about"});EVO.corporatesales.init()}};EVO.search={index:function(){EVO.hash(function(){var n=$(".results"),t;n.isLoading()||(n.loading(!0),t=EVO.getState().q,$(".query").text(t),$(".menu-mask.open").length>0&&EVO.topbar.closeMenuMask(),t?EVO.get({url:"/Search/Query",data:{q:t},success:function(t){$(".search-field").hide();EVO.search.movieResponse(t,"nowShowing","#movie-thumb-template");EVO.search.movieResponse(t,"advanced","#movie-thumb-template");EVO.search.movieResponse(t,"comingSoon","#movie-thumb-template");EVO.search.movieResponse(t,"events","#results-template");EVO.search.movieResponse(t,"promos","#results-template");EVO.search.movieResponse(t,"cinemas","#results-template");n.stopLoading();$("#Search").val(t.query);$(".no-results").remove();t.nowShowing.length===0&&t.comingSoon.length===0&&t.advanced.length===0&&t.cinemas.length===0&&t.events.length===0&&t.promos.length===0&&$(".results").append($("<div/>").addClass("no-results").text("No results found for '"+t.query+"'"));$(".results").show();LazyLoadImages()},error:function(t){n.stopLoading();EVO.Alert(t)},errorMessage:"Search Error"}):n.stopLoading())},!0)},movieResponse:function(n,t,i){if(n[t]&&n[t].length>0){var u=$(i),r=$("."+t+" .content").html("");r.closest(".search-field").show();$.each(n[t],function(n,t){r.append($.tmpl(u,t))})}}};EVO.sessions={init:function(){EVO.click("#session-list .dates .date",function(){var n=$(this).data("date"),t=$("#session-list .date.active").data("date");n!==t&&($("#session-list .date.active").inactive(),$('#session-list .date[data-date="'+n+'"]').active(),EVO.equalsDay(new Date,EVO.ParseDate(n))&&(n=null),EVO.updateState("date",n))});$("body").on("filter-clicked",".show-attribs .eccheckbox",function(){var t=$(this).isChecked(),n;EVO.preferences.setProperty("show-session-types",t);n=$("#session-list");t?n.addClass("show-session-types"):n.removeClass("show-session-types")});EVO.click(".show-all-session-types",function(){$(".show-attribs .eccheckbox").trigger("click");$(this).toggleClass("active");$(this).isActive()?$(this).html("Hide Types"):$(this).html("Show Types")});isTrue(EVO.preferences.collection["show-session-types"])&&$(".show-all-session-types").trigger("click");EVO.click(".sortby-mobile",function(){var n=$(this).find(":not(.active)");$(this).find(".sortby-mobile-option").inactive();n.active();$("#sortby").val(n.data("option")).trigger("change")});var n=EVO.getState().exp;n&&n.indexOf("Std")>-1&&$('.eccheckbox[data-val="Std"]').show();EVO.click("#session-list.share-select .session-btn",function(n){n.stopPropagation();var t=$(this),i=t.closest(".movie-list-item"),u=t.closest(".cinema"),r=$.tmpl($("#share-confirm-template"),{Movie:i.data("name"),SessionTime:DateFormat.format.date(EVO.ParseDate(t.data("time")),"E dd MMM h:mm a"),SessionId:t.data("sessionid"),MovieId:i.data("id"),Cinema:u.find(".cinema-name:first").text()});r.modal({onClose:function(){$.modal.close();$(".share-side").trigger("click")}});LazyLoadImages(r)});EVO.click("#share-confirm-btn",function(){var n=$(this).data("sessionid");window.location="/Share/Create/"+n});EVO.click(".share-side",function(){if($("#session-list").toggleClass("share-select"),$("#session-list").hasClass("share-select")){var n=$.cookie(".evo_fandm");isTrue(n)?typeof toastr!="undefined"&&(toastr.options.positionClass="toast-bottom-center fnm",toastr.options.preventDuplicates=!0,toastr.success("Select a session to create a Friends&nbsp;and&nbsp;Movies event!")):($.cookie(".evo_fandm",!0,{expires:new Date(864e13)}),EVO.Confirm("You can now create and share an event with your friends.<br/>Once your friends click on the link they can see where you're sitting and book a seat next to you!<br/><br/>Select a session to create a Friends&nbsp;and&nbsp;Movies event!",{callback:function(){},cancelcallback:function(){$(".share-side").trigger("click")},footer:'<div class="buttons"><button class="btn blue confirm-ok">Choose my session<\/button><button class="btn blue confirm-cancel">Not right now<\/button><\/div>',header:"",outerClass:"fandm"}))}});EVO.click("#session-list .seats",function(){var n=$(this).closest(".session-btn"),t=n.data("sessionid"),i=n.attr("href");$("<div/>").loading({placement:"append"}).modal();EVO.get({url:"/Ticketing/Order/GetSeating?sessionId="+t,success:function(n){var t=$("<div/>").addClass("seating-modal");t.data("href",i);t.append($.tmpl($("#seats-template"),n));$.modal.close();t.evomodal({autoResize:!0})},error:function(n){$.modal.close();EVO.Alert(n)},errorMessage:"Error retrieving seating plan"})});EVO.click("#session-list .hover",function(){});EVO.click(".mobile-filter",function(){$("body").addClass("mobile-filter-open");$(".right-filter").addClass("mobile-filtering").height("auto")});EVO.click(".mobile-filter-done",function(){$("body").removeClass("mobile-filter-open");$(".right-filter").removeClass("mobile-filtering")});EVO.hover(".session-btn > span",function(){var n=$(this),t=n.find(".hover-wrapper"),i,r;t.length>0&&(i=n.closest(".movie-list-item"),r=i.offset(),r.left>t.offset().left?n.addClass("farleft"):r.left+i.outerWidth()<t.offset().left+t.outerWidth()&&n.addClass("farright"))},function(){$(this).removeClass("farleft").removeClass("farright")});EVO.click("#session-list .rating",function(){var t=$(this),n=t.data("light-mobile")||0;n=n+1;n>4&&(n=0,$("#session-list").hasClass("mobile-light")?($("#session-list").removeClass("mobile-light"),EVO.storage.remove("evo_mobilelight")):($("#session-list").addClass("mobile-light"),EVO.storage.set("evo_mobilelight",!0)));t.data("light-mobile",n)});isTrue(EVO.storage.get("evo_mobilelight"))&&$("#session-list").addClass("mobile-light");$("#sortby").change(function(){EVO.preferences.setProperty("sessions-sortby",$(this).val());EVO.updateState("sortby",$(this).val())});$(window).konami(function(){EVO.updateState("viewType","guide")})},index:function(){var t,i,r,n,u,f;EVO.topbar.onDone(function(){var t=EVO.topbar.selectedCinemas(),i=EVO.topbar.selectedMovies(),n=EVO.getState();n.cinemas=t.join();n.movies=i.join();EVO.pushState(n)});EVO.click(".top-bar.active .ftab.btn",function(){$(".mobile-ticket.menu-mask-trigger.open").trigger("click")},!0);t=EVO.getState();i=(t.movies||"").commaSeparated();!t.date&&i.length>0&&(r=$("#first-dates").data("first-dates"),n=null,$.each(i,function(t,i){var f=r[i],u;f&&(u=EVO.ParseDate(f),(!n||u<n)&&(n=u))}),u=(new Date).toDate(),n&&n>u&&(f=DateFormat.format.date(n,"yyyy-MM-dd"),EVO.updateState("date",f)));EVO.sessions.filterScrollPositionInit();EVO.hash(function(){var t=EVO.getState(),i=(t.cinemas||"").commaSeparatedInts(),r,n;i&&i.length>0?(r=(t.movies||"").commaSeparatedInts(),EVO.sessions.getSessions({movieIds:r,source:"www|sessions"})):setTimeout(function(){EVO.topbar.openCinemas()},500);n=getParam("sortby")||EVO.preferences.collection["sessions-sortby"];n&&($("#sortby").val(n),$(".sortby-mobile-option").inactive(),$('.sortby-mobile-option[data-option="'+n+'"]').active())},!0)},getSessions:function(n){var i=EVO.getState(),t=$.extend({cinemaIds:(i.cinemas||"").commaSeparatedInts(),date:i.date,validDates:[],filter:EVO.sessions.filter,movieIds:[]},n,{}),r,f,u;$(".select-a-cinema").remove();t.cinemaIds&&t.cinemaIds.length>0?(t.cinemaIds=t.cinemaIds.sort(),r={cinemaIds:t.cinemaIds,date:t.date,viewType:i.viewType},f=$("#session-list").data("data"),JSON.stringify(r)!==JSON.stringify(f)?($("#session-list .movie-container").remove(),u=$("#session-list").loading({placement:"append"}),$("#session-list").data("data",r),EVO.get({url:"/Cinemas/GetSessions",data:r,traditional:!0,success:function(n){var o=$("#session-list").data("data"),c,r,e,s,h,f;if((!o.date||o.date===n.SelectedDate)&&(!o.cinemaIds||JSON.stringify(o.cinemaIds)===JSON.stringify(n.CinemaIds))){if(n.source=t.source,$(".date.active").inactive(),$('.date[data-date="'+n.SelectedDate+'"]').active(),c=i.viewType,c&&c==="guide"&&t.cinemaIds.length===1){for(r=EVO.sessions.getTimelineObjects(n),n.Screens=r.screens,f=$.tmpl($("#timeline-template"),n),$("#session-list").append(f),$(".session-btn",f).each(function(n,t){var i=$(t),u=EVO.sessions.calculateTimelineLeft(i.data("time"),r.firstSession),f=i.data("runningtime")*3+20;i.css("left",u);i.width(f)}),e=$(".timeline-back"),s=0;s<r.hours;s++)$("tbody tr",e).append($("<td/>")),h=new Date(r.firstSession.getTime()),h.setHours(h.getHours()+s),$("thead tr",e).append($("<th/>").text(EVO.sessionTime(h)));e.height($(".timeline").height());e.width(r.hours*180)}else f=$.tmpl($("#session-list-template"),n),$("#session-list").append(f);if(n.Dates){var v=$("#date-template"),l=$("#session-list .dates"),a=!1;$.inArray(n.SelectedDate,n.Dates)===-1&&n.Dates.push(n.SelectedDate);$.each(n.Dates,function(n,i){$('.date[data-date="'+i+'"]',l).length===0&&(!t.validDates||t.validDates.length===0||$.inArray(i,t.validDates)>-1)&&(l.append($.tmpl(v,{date:i})),a=!0)});$(".initial-hide").show();$('#session-list .date[data-date="'+n.SelectedDate+'"]').active();a&&($("#session-list .date").sortElements(function(n,t){var i=$(n).data("date"),r=$(t).data("date");return i>r?1:i<r?-1:0}),$("#session-list .slider").slider({items:".date",snap:!1,slideToActive:!0,displayArrows:!EVO.isMobile(),widthAdjustment:$("#session-list .slider .dates").outerWidth(!0)-$("#session-list .slider .dates").width()}));EVO.filter.addFilterOptions(n.Genres,"genre",$('.filter[data-filter-attribute="genre"]'));EVO.filter.addFilterOptions(n.Experiences,"exp",$('.filter[data-filter-attribute="exp"]'));EVO.filter.addFilterOptions(n.Attributes,"attribs",$('.filter[data-filter-attribute="attribs"]'));t.filter&&$.isFunction(t.filter)&&t.filter({movieIds:t.movieIds})}LazyLoadImages();u.stopLoading()}$("body").trigger("sessionsloaded")},error:function(n){u.stopLoading();EVO.Alert(n)},errorMessage:"Error retrieving sessions"})):t.filter&&$.isFunction(t.filter)&&t.filter({movieIds:t.movieIds})):($(".initial-hide").hide(),$("#session-list .movie-container").remove(),$("#session-list").append('<span class="select-a-cinema">Please add a cinema(s)<\/span>'))},filter:function(n){var t=$.extend({movieIds:[],screens:getParam("exp").commaSeparated(),attribs:getParam("attribs").commaSeparated()},n,{}),i,r;EVO.filter.init({resizeParent:!EVO.isMobile()});i={};r=getParam("genre").commaSeparated();r&&r.length>0&&(i.genre=function(){var n=this.data("genres").commaSeparated();return $.arrayIntersect(n,r).length>0});t.movieIds&&t.movieIds.length>0&&(i.movieIds=function(){var n=this.data("id");return $.inArray(n,t.movieIds)>-1});$(".movie-container").evofilter({items:".movie-container-item",filters:i,after:function(n){var i={},u=t.screens,f,r;u&&u.length>0&&(i.exp=function(){var t=[this.data("screentype")],r=this.data("is3d"),n,i;return isTrue(r)&&t.push("threed"),n=$.arrayIntersect(t,u).length>0,n||(i=$.map(this.data("attributes"),function(n){return isTrue(n.IsExperience)?n.Code:null}),n=$.arrayIntersect(i,u).length>0),n});f=t.attribs;f&&f.length>0&&(i.attribs=function(){var n=$.map(this.data("attributes"),function(n){return n.Code});return $.arrayIntersect(n,f).length>0});t.sessionTimes&&(i.sessionTimes=function(){var i=EVO.ParseDate(this.data("time")),n=!0;return t.sessionTimes.fromDate&&i<t.sessionTimes.fromDate&&(n=!1),t.sessionTimes.toDate&&i>t.sessionTimes.toDate&&(n=!1),n});r=getParam("time").commaSeparated();r&&r.length===1&&(i.time=function(){var t=EVO.ParseDate(this.data("time")),n=!0,i=t.getHours()*100+t.getMinutes();return r[0]==="before5"?n=i<=1700:r[0]==="after5"&&(n=i>=1700),n});$(".movie-container-item:visible").evofilter({items:".session-btn",filters:i,after:function(){var t,i;$(this).each(function(){var t=!1,n=[];$(".cinema",this).each(function(){var i=$(".session-btn",this).allVisible().length;i>0?(t=!0,$(this).show()):(n.push($(".cinema-name",this).html()),$(this).hide())});n.length>0?$(".no-cinemas",this).show().find("span").html(n.join(", ").replaceLast(", "," or ")):$(".no-cinemas",this).hide().find("span").html("");t?$(this).evoshow():$(this).evohide()});t=$(".filter-message");$(".movie-container-item:visible").length===0?(EVO.filter.buildNoResultsText(),$(".share-side").hide(),t.show()):(t.hide(),$(".share-side").show(),i=getParam("sortby")||$("#sortby").val(),$(".movie-container:visible").sortBy({sortBy:i,items:n.items,defaultSortBy:"popularity",updateDefaultState:!0,sortData:{popularity:function(n){return-n.data("popularity")||0},alphabetical:function(n){return(n.data("name")+""||"").toLowerCase()}}}),LazyLoadImages())}})}})},getScreenTypeDesc:function(n,t){var i="";return n&&t&&$.each(t,function(t,r){if(r.code===n)return i=r.desc,!1}),i},getAttributeDesc:function(n){return n.Name},filterScrollPositionInit:function(){$(window).smartscroll(function(){var n=$(".filter-wrapper:visible"),t,i;n.length>0&&(t=$("#session-list").offset().top-$(window).scrollTop(),t<80?n.hasClass("filter-fixed")||(i=n.offset(),n.addClass("filter-fixed"),n.css("left",i.left)):(n.removeClass("filter-fixed"),n.css("left",0)))})},calculateTimelineLeft:function(n,t){var i=EVO.ParseDate(n),r=EVO.ParseDate(t),u=Math.abs(i-r),f=Math.floor(u/6e4);return f*3},getTimelineObjects:function(n){var u={},t=new Date(Date.MAX_VALUE),i=new Date(Date.MIN_VALUE),f,r;return $.each(n.Movies,function(n,r){$.each(r.CinemaModels,function(n,f){$.each(f.Sessions,function(n,f){var e=u[f.ScreenName]||{},s,o;e.Screen=f.ScreenName;e.ScreenTypeId=f.ScreenTypeId;e.Sessions=e.Sessions||[];s=EVO.ParseDate(f.StartTime);t>s&&(t=s);o=EVO.ParseDate(f.StartTime);o.setMinutes(o.getMinutes()+r.RunningTime);o>i&&(i=o);e.Sessions.push({RunningTime:r.RunningTime,Name:r.Name,StartTime:f.StartTime,ScreenType:f.ScreenType,Attributes:f.Attributes,Id:f.Id,BookingUrl:f.BookingUrl,Is3d:f.Is3d,SeatsAvailable:f.SeatsAvailable});u[f.ScreenName]=e})})}),f=[2,4,0,1,3,5,104],r=[],$.each(u,function(n,t){r.push(t)}),r.sort(function(n,t){return f.indexOf(n.ScreenTypeId)-f.indexOf(t.ScreenTypeId)}),t.setMinutes(0),{screens:r,firstSession:t,lastEnd:i,hours:Math.ceil((i-t)/36e5)}},getStyleSheetCode:function(n){return n&&!isNaN(n[0])?"_"+n:n}};EVO.share={index:function(){var r=EVO.getState(),t,n,i;r.error?EVO.Alert(r.error):(t=getParam("token"),n=getParam("o"),(t||n)&&(i=$(".share-content").loading(),EVO.get({url:"/Share/Sessions",data:{token:t,orderToken:n},success:function(t){i.stopLoading();i.html(t.html);t.Seating&&t.Seating.Seats&&$("#seats-wrapper").append($.tmpl($("#seats-template"),t.Seating));EVO.share.complete(t);n&&EVO.pushState({token:t.token})},error:function(n){EVO.Alert(n)},errorMessage:"Error finding shared session details"})));EVO.click("li[data-seat]",function(){window.location=$("#book").attr("href")})},complete:function(){var n,t;if(LazyLoadImages(),$("#ShareUrl").trigger("input"),new Clipboard(".copy-btn"),EVO.manage.whatsappIEFFFix(),n=$("#Skin").val(),n){$(".skin").show();$(".movie-details").css("background-image",'url("'+n+'")');t=7/32;$(window).on("resize",function(){var n=$(this).width(),i=$(".movie-details").outerHeight();$(".movie-details").css("min-height",n*t+30)},200);$(window).trigger("resize")}}};EVO.minesweeper={init:function(){var t=$(".seat-selection");if(t.length>0){t.addClass("minesweeper");var n=$("li:not(.spacer,.rowname)",t),r=Math.floor(n.length/10),i=5;n.each(function(n,t){setTimeout(function(){$(t).addClass("pot-bomb")},i);i+=5});setTimeout(function(){n=EVO.minesweeper.shuffle(n);n.each(function(n,t){n<r&&$(t).addClass("bomb")})},i);$("ul",t).each(function(n,t){$("li",t).each(function(t,i){$(i).attr("data-mine-row",n);$(i).attr("data-mine-seat",t)})});n.click(EVO.minesweeper.checkSeat);$(document).on("contextmenu",".seat-selection li:not(.spacer,.rowname)",function(){return $(this).toggleClass("suspect"),!1});EVO.order.pauseTimer()}},checkSeat:function(){var r=$(this),t=r.data("mine-row"),i=r.data("mine-seat"),n,u;return r.hasClass("bomb")?($(".bomb").addClass("revealed"),!1):(n=[],n.push(EVO.minesweeper.isValid(t-1,i-1)),n.push(EVO.minesweeper.isValid(t-1,i)),n.push(EVO.minesweeper.isValid(t-1,i+1)),n.push(EVO.minesweeper.isValid(t,i-1)),n.push(EVO.minesweeper.isValid(t,i+1)),n.push(EVO.minesweeper.isValid(t+1,i-1)),n.push(EVO.minesweeper.isValid(t+1,i)),n.push(EVO.minesweeper.isValid(t+1,i+1)),u=0,$.each(n,function(n,t){t.length>0&&t.hasClass("bomb")&&u++}),u===0?(r.addClass("spacer"),$.each(n,function(n,t){t.length>0&&!$(t).hasClass("spacer")&&EVO.minesweeper.checkSeat.call(t)})):r.html(u),!1)},isValid:function(n,t){return $('.seat-selection li[data-mine-row="'+n+'"][data-mine-seat="'+t+'"]:not(.spacer,.rowname)')},shuffle:function(n){for(var i,r,t=n.length;t;i=Math.floor(Math.random()*t),r=n[--t],n[t]=n[i],n[i]=r);return n}};EVO.order={index:function(){EVO.order.update();EVO.hash(EVO.order.update);EVO.click("form.submit .continue",function(){var t=!0,i=$(this).closest("form"),r=$(this).closest(".step-content").data("step"),n;EVO.order.steps[r]&&(n=EVO.order.steps[r].validate,n&&$.isFunction(n)&&(t=n.call(this,i)));t&&i.data("skip",$(this).data("skip")).submit()});EVO.click(".steps .clickable",function(){var n=$(this).data("step");EVO.updateState("step",n)});EVO.click(".vmax-upgrade .close",function(){$(".vmax-upgrade").remove()});EVO.submit("form.submit",function(){var n=$("#step-content-wrapper");if(n.isLoading())return!1;n.loading(!0);var t=$(this),r=$(".step-content.active",n).hide(),i=$(".steps li.active"),u=t.attr("action");n.data("stophashchange",!0);EVO.post({url:u,data:t.serialize(),success:function(r){var u,f,e,o;n.data("stophashchange",!1);EVO.redirectResponse(r)||(r&&r.masterpass?MasterPass.client.checkout(r.masterpass):(u=i.next(),f=t.data("skip"),f&&(u=i.siblings('[data-step="'+f+'"]')),e=u.data("step"),o=t.find("#Token").val(),EVO.pushState({token:o,step:e})))},error:function(t,i){n.data("stophashchange",!1);EVO.redirectResponse(i,t)||(EVO.Alert(t),n.stopLoading(),r.show())},errorMessage:"Unable to progress you to the next step"})});$(".cinebuzz-top-form form").data("submit-alternate",function(){EVO.topbar.closeMenuMask();$(".teaser").addClass("logged-in-teaser");$('.step-content[data-step="tickets"]').data("completed",!1);$(window).trigger("hashchange")});$("#CardExpiry").cardExpiry();$("#CardNumber").creditCardMask();$("#GiftCardNumber").numericInt();$("#CardSecurityCode").numericInt();$("#PIN").numericInt();$.each(EVO.order.steps,function(){this.init&&$.isFunction(this.init)&&this.init()})},update:function(){var i=EVO.getState(),n=i.step||"tickets",s=$('.steps li[data-step="'+n+'"]').data("url"),t,r,u,e,o,f;s?(t=$("#step-content-wrapper"),r=$('.step-content[data-step="'+n+'"]',t),$(".step-content.active",t).hide(),u=i.sessionId||$("#Token").val()!==i.token,u&&EVO.order.reset(),$("#step-content-wrapper .step-content").each(function(){u&&$(this).data("completed",!1);$(this).data("step")===n&&(u=!0)}),e=i.error,e&&(EVO.Alert(e),$(window).off("hashchange"),i.error="",EVO.pushState(i),EVO.hash(EVO.order.update)),isTrue(t.data("stophashchange"))?(o=t.data("step"),o!==n&&(f=$("#Token").val(),f&&f.length>0&&EVO.pushState({token:f,step:o}))):n==="confirm"?window.location="/Ticketing/Manage#token="+i.token:isTrue(r.data("completed"))?(t.data("stophashchange",!1),t.stopLoading(),EVO.order.setActiveStep(n)):(t.loading(!0),window.scrollTo(0,0),t.data("stophashchange",!0),t.data("step",n),i.isMobile=EVO.isMobile(),EVO.get({url:s,data:i,success:function(u){var o,e,f;if(t.data("stophashchange",!1),n=t.data("step"),u.ConfirmRedirect){window.location=u.ConfirmRedirect;return}i.sessionId?($(window).off("hashchange"),o=window.location.href.split("#")[0],window.location.replace(o+"#token="+u.token+"&step="+n),EVO.hash(EVO.order.update),EVO.order.reset()):i.token!==u.token&&EVO.pushState({token:u.token,step:n});EVO.order.setInApp(u.isApp);$(".body-content .steps li").each(function(){var n=$(this).data("step");$.inArray(n,u.validSteps)===-1&&$(this).remove()});isTrue(u.isMoonlight)&&($("body").hasClass("moonlight")||$("body").addClass("moonlight"));$(".session-details").length===0&&(e=$.tmpl($("#session-details-template"),u.sessionDetails),$(".session-details-wrapper").append(e.clone()).evoshow(),$(".mobile-session-info").append(e),EVO.order.addTicketsConcsToSummary(u.ticketDetails,$(".session-details-wrapper .session-details .ticket-info .tickets")),EVO.order.addTicketsConcsToSummary(u.concDetails,$(".session-details-wrapper .session-details .ticket-info .concs")),LazyLoadImages(null,{visibleOnly:!1}),$(".session-details").data("details",u.sessionDetails));$('input[name="Token"]').val(u.token);$(".step-content.active",t).inactive();r.active();u.model.validSteps=u.validSteps;r.trigger("response",u.model);t.stopLoading();document.title=$('.steps li[data-step="'+n+'"]').text();r.data("completed",!0);n==="confirm"?EVO.order.stopTimer():u.timeLeft&&u.timeLeft>0&&$(".time-remaining .seconds").removeClass("hasCountdown").countdown({until:+u.timeLeft,onExpiry:function(){n!=="confirm"&&EVO.Alert("Your time to complete this booking has been exceeded.<br />Press OK to start your booking again.",{onClose:function(){$.modal.close();$(".body-wrapper").loading(!0);window.location.href="/Ticketing/Order#sessionId="+$("#SessionId").val()+"&bookingSource=expired";location.reload()}})},onTick:function(n){n[5]<1&&$(this).addClass("expiring")},layout:"{mn}:{snn}"});EVO.order.setActiveStep(n);u.partner&&(f=EVO.order[u.partner],f&&$.isFunction(f)&&f.call());$("body").append($("<input/>").attr("type","hidden").attr("id",n+"-ready"));typeof evo_confList!="undefined"&&evo_confList.length>0&&$.each(evo_confList,function(t,i){var r=i.step||"confirm";if(n===r&&i.condition&&i.action&&$.isFunction(i.condition)&&$.isFunction(i.action))try{i.condition()&&i.action()}catch(u){}});$.isFunction(EVO.order.steps[n].postaction)&&EVO.order.steps[n].postaction.call(this,u.model)},error:function(n,i){t.data("stophashchange",!1);EVO.redirectResponse(i)||(n.indexOf("cinema cannot be contacted")>-1?EVO.Alert(n,{onClose:function(){window.location="/Sessions"}}):EVO.Alert(n))},errorMessage:"Error finding session"}))):EVO.Alert("Invalid step")},sessionTime:function(n){var t=EVO.ParseDate(n);return DateFormat.format.date(t,"E dd MMMM, h:mm a")},setActiveStep:function(n){$("#step-content-wrapper .step-content.active").inactive();$('#step-content-wrapper .step-content[data-step="'+n+'"]').show().active();$(".steps .active").inactive();$(".steps .clickable").removeClass("clickable");var t=$('.steps li[data-step="'+n+'"]').active();n!=="confirm"&&$(".steps li").each(function(){if($(this).isActive())return!1;$(this).addClass("clickable")})},toCurrency:function(n){return n.toCurrency()},pauseTimer:function(){$(".time-remaining .seconds").countdown("pause")},stopTimer:function(){EVO.order.pauseTimer();$(".time-remaining").remove()},aami:function(){$(".aami-img").length===0&&$(".price-info").after($.tmpl($("#aami-template")))},reset:function(){$(".session-details").remove();$(".vmax-upgrade").remove()},sendTrans:function(n){var i=getParam("token"),t;isTrue($.cookie("_evops-"+i))&&(t=new Date,t.setMinutes(t.getMinutes()+10),$.cookie("_evops-"+i,!1,{expires:t,path:"/"}),n&&$.isFunction(n)&&n.call(this))},setPaymentStarting:function(){var n=new Date,t;n.setDate(n.getDate()+1);t=getParam("token");$.cookie("_evops-"+t,!0,{expires:n,path:"/"})},addTicketsConcsToSummary:function(n,t){var r,i;t.find(".t-info").remove();n&&n.length>0&&(r=$("#ticket-details-template"),$.each(n,function(n,i){t.append($.tmpl(r,i))}));$(".session-details-wrapper .ticket-info").showHide($(".t-info").length>0);i=0;$(".ticket-info .t-info").each(function(n,t){i+=$(t).data("price")});$(".total-summary span").html(EVO.order.toCurrency(i))},truncateGC:function(n){var t=n.length;return n.substring(0,4)+"..."+n.substring(t-4,t)},setInApp:function(n){n=isTrue(n)||isTrue(EVO.storage.get("_evo_inapp"));n&&($("body").addClass("in-app"),EVO.click(".logo-wrapper .logo",function(){}),$(".logo-wrapper .logo").removeAttr("href").css("cursor","default"),EVO.storage.set("_evo_inapp",!0))},getUpcoming:function(n){if(n=$.extend({success:undefined,error:undefined,callServer:!1},n,{}),isTrue(n.callServer))EVO.get({url:"/Cinebuzz/GetUpcomingBookings",success:function(t){EVO.storage.set("evo_upcoming",t);$.isFunction(n.success)&&n.success.call(this,t)},error:function(){},errorMessage:"Error retrieving upcoming orders"});else{var t=EVO.storage.get("evo_upcoming")||[];t=EVO.order.sortRemoveUpcoming(t);$.isFunction(n.success)&&n.success.call(this,t)}},setUpcoming:function(n){EVO.order.getUpcoming({success:function(t){Array.isArray(n)?Array.prototype.push.apply(t,n):t.push(n);EVO.order.sortRemoveUpcoming(t)}})},removeUpcoming:function(){EVO.storage.remove("evo_upcoming")},sortRemoveUpcoming:function(n){if(n.length>0){var t=new Date,i=[];t.setHours(t.getHours()-3);n=n.filter(function(n){var r=EVO.ParseDate(n.Date);return r<t?!1:$.inArray(n.Token,i)>-1?!1:(n.Payments=null,i.push(n.Token),!0)});n=n.sort(function(n,t){var i=EVO.ParseDate(n.Date),r=EVO.ParseDate(t.Date);return i>r?1:i<r?-1:0})}return EVO.storage.set("evo_upcoming",n),n},getSeatClasses:function(n,t){var i=[],h=n.Status,u,r;if(n.AreaId&&n.AreaId>1&&(u=t.filter(function(t){return t.Id===n.AreaId}),u.length>0&&(r=u[0],r.Code&&(i.push(r.Code),r.SelectedSeatImage&&i.push("non-standard")),r.IsDoubleHeight&&i.push("double-height"),n.SeatImage=r.SeatImage,n.SelectedSeatImage=r.SelectedSeatImage,n.IsDoubleHeight=r.IsDoubleHeight)),n.Status==="Available"||n.Status==="Special"?(n.Wheelchair||n.Status==="Special")&&i.push("wheel-chair"):n.Status==="Booked"||n.Status==="House"||n.Status==="Broken"?(i.push("taken"),n.Initials&&i.push("attending")):n.Status==="Selected"?(i.push("selected"),i.push("current")):i.push("spacer"),n.CoupleSeat&&i.push("couple-seat"),EVO.any(n.RelatedSeats)){var f=!1,e=!1,o=function(n){return n.replace(/\D/g,"")*1},s=o(n.SeatName);$.each(n.RelatedSeats,function(n,t){var i=o(t);f=f||i<s;e=e||i>s});!f&&e?n.RelatedSeats.length===1?i.push("double"):n.RelatedSeats.length===2&&i.push("triple"):i.push("handled")}return i.join(" ")},getSeatStyle:function(n,t){var u,i,r;return n.AreaId&&n.AreaId>1&&(u=t.filter(function(t){return t.Id===n.AreaId}),u.length>0)?(i=u[0],r=[],n.Status==="Available"||n.Status==="Special"?(i.SeatColour&&r.push("background-color:"+i.SeatColour+";"),i.SeatImage&&r.push("background-image: url("+i.SeatImage+");")):(n.Status==="Selected"||n.Status==="Booked")&&i.SelectedSeatImage&&r.push("background-image: url("+i.SelectedSeatImage+");"),r.join("")):""}};EVO.order.steps={tickets:{init:function(){var n,t;$('.step-content[data-step="tickets"]').bind("response",function(n,t){var r=$("#product-model-template"),i=$("tbody",EVO.order.steps.tickets.table),f,e,o,s,u,h,c,l;i.find("tr").remove();f=i.closest("form");t.Recognitions&&$.each(t.Recognitions,function(n,t){t.Guid=EVO.Guid();t.Class="recog";t.Group="OrderTickets";t.ScreenHelp=(t.ScreenHelp||"")+"<p>The Cinebuzz member card must be present on collection.<\/p>";i.append($.tmpl(r,t))});t.Tickets&&$.each(t.Tickets,function(n,t){t.Guid=EVO.Guid();t.Group="OrderTickets";t.Barcode&&(t.Class="voucher");i.append($.tmpl(r,t))});t.ConcessionItems&&$.each(t.ConcessionItems,function(n,t){t.Guid=EVO.Guid();t.Group="OrderConcessionItems";i.append($.tmpl(r,t))});t.Terms&&t.Terms.length>0&&(e=$(".terms").show().html(""),o=$("#terms-template"),$.each(t.Terms,function(n,t){t.Guid=EVO.Guid();e.append($.tmpl(o,t))}));t.ratingTerms&&$(".rating-terms").html(t.ratingTerms);t.GiftCards&&t.GiftCards.length>0&&(s=$("#giftcardtemplate"),$.each(t.GiftCards,function(n,t){$(".giftcards").show().append($.tmpl(s,t))}));t.User&&($(".teaser").addClass("logged-in-teaser"),EVO.order.steps.tickets.setUserDetails(t.User.FirstName,t.User.CardNumber));t.validSteps.indexOf("seats")===-1&&(u=f.find(".continue"),u.html("Add Food &amp; Drink "),t.validSteps.indexOf("fab")===-1&&u.html("Proceed to Payment "));t.upgradeSessions&&t.upgradeSessions.length>0&&($(".vmax-upgrade").remove(),h=$("#vmax-upgrade-template"),c=EVO.ParseDate(t.StartTime),$.each(t.upgradeSessions,function(n,t){var i=EVO.ParseDate(t.StartTime)-c;t.timeDiff=Math.floor(i/6e4)}),l={sessions:t.upgradeSessions,hasGCUpgrade:t.hasGCUpgrade,hasVmaxUpgrade:t.hasVmaxUpgrade,upgradeMessage:t.upgradeMessage,movie:$(".session-details .title:first").text(),bookingSource:t.BookingSource,upgradeImageUrl:t.upgradeImageUrl},$('.step-content[data-step="tickets"]').prepend($.tmpl(h,l)),$(".vmax-upgrade .img").lazy());$("#SessionAvailableSeats").val(t.AvailableSeats);EVO.order.steps.tickets.table.trigger("change");EVO.order.steps.updateTicketQuantity();t.vistaMovieCode&&EVO.storage.set("evo_abandon",t.vistaMovieCode)});EVO.submit("form.voucher",function(){var t=$(this),r=t.btn(),n,u,f,i,e,o;if(!r.isLoading()){if(n=EVOValidate.getVoucherNo($("#Voucher").val()),n.length===0&&EVO.Alert("Number required"),u=$("#Pin"),u.is("visible")&&(u.val().length===0?EVO.Alert("PIN required"):u.val().length!==4&&EVO.Alert("Invalid pin code")),EVOValidate.testGiftCard(n))EVO.post({url:"/Ticketing/GiftCard/Validate",data:t.serialize(),success:function(n){$(".giftcards").show().append($.tmpl($("#giftcardtemplate"),n).hide().fadeIn());t.trigger("reset")},error:function(n){EVO.Alert(n)},errorMessage:"Error processing voucher"});else{if(f="Promo",i=[],$("tbody tr.voucher",EVO.order.steps.tickets.table).each(function(){i=i.concat(($(this).data("vouchers")||"").toLowerCase().commaSeparated())}),$.inArray(n.toLowerCase(),i)>-1){EVO.Alert("Already entered");return}if(EVOValidate.Regex.re.test(n)&&n.length>=5||EVOValidate.Regex.nzvc.test(n)||EVOValidate.Regex.village.test(n)||EVOValidate.Regex.village2.test(n)){if(f="Voucher",e=!1,o=!1,$.each(i,function(n,t){e=e||EVOValidate.Regex.village.test(t)||EVOValidate.Regex.village2.test(t);o=o||EVOValidate.Regex.re.test(t)}),o&&(EVOValidate.Regex.village.test(n)||EVOValidate.Regex.village2.test(n))||e&&EVOValidate.Regex.re.test(n)){EVO.Alert("Sorry, Village vouchers and Event Cinemas vouchers must be redeemed in separate transactions");return}}else{if(EVOValidate.Regex.nzoldvc.test(n)){EVO.Alert("Unfortunately Movie Vouchers issued prior to August 2013 can't be redeemed on-line for security reason;<br/>you will need to present your voucher at the box office at your local cinema. <br />The good news is vouchers issued after August 2013 have a unique PIN and can be used on-line.");return}if(EVOValidate.Regex.nzoldgiftc.test(n)){EVO.Alert("Unfortunately Gift Cards issued prior to August 2013 can't be redeemed on-line for security reason;<br />you will need to present your gift card at the box office at your local cinema. <br />The good news is gift cards issued after August 2013 have a unique PIN and can be used on-line.");return}}r.btnLoading();EVO.post({url:"/Ticketing/"+f+"/Validate",data:t.serialize(),success:function(n){n.Guid=EVO.Guid();n.Class="voucher";n.HideItem=!1;n.Group="OrderTickets";var i=$.tmpl($("#product-model-template"),n);$("tbody",EVO.order.steps.tickets.table).prepend(i);i.find(".qty").trigger("change");t.trigger("reset");r.stopLoading()},error:function(n){EVO.Alert(n);r.stopLoading()},errorMessage:"Error processing "+f})}console.log("voucher submitted.. awaiting approval")}});$("body").on("change","table.ticket-details",function(){$(this).find("tr").allVisible().each(function(n){n%2==0?$(this).addClass("even"):$(this).removeClass("even")})});EVO.click("table.ticket-details .name .info",function(){EVO.Message($(this).parent().find("> span").text(),$(this).html())});EVO.order.steps.tickets.table.on("change",'select[name$="Quantity"]',function(){var t=$(this).closest("tr"),n=t.closest("table"),o,r,u,i;if(t.data("category")!=="concessionitem"){if(isTrue(t.data("iscomp"))){var f=n.find('tr[data-category="ticket"][data-iscomp="true"] .qty').sum(function(){return $(this).val()}),s=n.find('[data-category="concessionitem"][data-iscomp="true"] .qty').val(f),e=s.closest("tr");f>0?e.removeClass("hidden"):e.addClass("hidden")}i=parseInt(t.find(".qty").val());i===0?(n.find("tr .qty").show(),n.find("tr").removeClass("invalid-area-row")):(o=t.data("area"),n.find('tr[data-category="ticket"][data-area!="'+o+'"]').addClass("invalid-area-row"));r=0;n.find('tr[data-category="ticket"] .qty').each(function(){r+=parseInt($(this).val())});n.find('[data-category="concessionitem"][data-iscomp="false"] .qty').val(r);u=t.data("children").commaSeparated();u.length>0&&(i=parseInt($(".qty",t).val()),$.each(u,function(t,r){var u=$('[data-hocode="'+r+'"]',n);u.length>0&&(i>0?u.removeClass("hidden"):($(".qty",u).val(0),u.addClass("hidden")))}),EVO.order.steps.tickets.table.trigger("change"))}EVO.order.steps.updateTicketQuantity()});n=EVO.getState().bookingSource;typeof n=="string"&&(n=n.toLowerCase(),t=n.indexOf("msite2")>-1||n.indexOf("ios")>-1||n.indexOf("android")>-1,EVO.order.setInApp(t));$("#Voucher").on("keyup",EVO.order.steps.tickets.showHidePin);$("#Voucher").on("change",EVO.order.steps.tickets.showHidePin)},validate:function(){var n=!0,t=0,i=10,r,u;return EVO.order.steps.tickets.table.find('tr[data-category="ticket"]').each(function(n,r){var u=$(".qty",r).val(),f=$(r).data("maxcount")||10;u>0&&f>i&&(i=f);t=t+u*1}),r=parseInt($("#SessionAvailableSeats").val()),t===0?(EVO.Alert("Please select tickets before continuing"),n=!1):t>r?(r===1?EVO.Alert("There is only 1 seat available. Change your ticket selection or choose another session"):EVO.Alert("There are only "+r+" seats available. Please change your ticket selection or choose another session"),n=!1):t>i?(EVO.Alert("You may only order a maximum of "+i+" tickets.<br />Complete another order to purchase more tickets"),n=!1):$(".terms").is(":visible")?($(".terms .eccheckbox").each(function(){$(this).isActive()||(n=!1)}),n||EVO.Alert("Please agree to the Terms and Conditions")):$(".giftcards .giftcard").length>0&&(u=!1,EVO.order.steps.tickets.table.find('tr[data-category="ticket"][data-gcallowed="false"]').each(function(n,t){$(t).find(".qty").val()>0&&(u=!0)}),u&&(n=!1,EVO.Confirm("You have selected tickets that are not accepted for Gift Card purchases.<br /><br />Would you like to proceed without the Gift Card?",function(){$(".giftcards .giftcard").remove();$(".giftcards").hide();$(".step-content.active form.submit .continue").trigger("click")}))),n},showHidePin:function(){var n=EVOValidate.getVoucherNo($("#Voucher").val());EVOValidate.showPin(n)?$("#Pin").show():$("#Pin").hide()},table:$("#ticket-table"),setUserDetails:function(n,t){$(".not-logged-in").hide();$(".logged-in").show().find("span").html(n);$('input[name^="MemberCards"][type="tel"]:first').val(t)}},seats:{init:function(){$('.step-content[data-step="seats"]').bind("response",function(n,t){$(this).html("").append($.tmpl($("#seats-template"),t));$(this).find("#Token").val(EVO.getState().token);EVO.order.steps.seats.populateSelectedSeats()});EVO.click(".seat-selection .seats li",function(){var n=$(this),t,i,r;n.data("seat")&&!n.hasClass("blacken")&&(t=$(".seat-selection"),i=parseInt(t.data("totalseats")),n.hasClass("selected")?n.removeClass("selected"):(r=t.find(" .seats .selected"),r.length<i?(n.addClass("selected"),n.hasClass("wheel-chair")&&setTimeout(function(){EVO.Alert("Please note you have selected a wheelchair space which does not have a seat")},300)):EVO.Alert("ALL SEATS HAVE BEEN SELECTED<br />You have already selected all of your seats.<br />To make alternative choices please toggle your seats(s) on and off<br />by clicking on them again.")),EVO.order.steps.seats.populateSelectedSeats())});$(window).konami(function(){EVO.minesweeper.init()},"83,87,69,69,80,69,82")},validate:function(){var u=$(this),t=!0,n,i,r;return EVO.order.steps.seats.populateSelectedSeats(),n=parseInt($(".seat-selection").data("totalseats")),i=$(".seats .selected").length,i<n&&(r=n-i,EVO.Alert("You should select "+n+" seat"+(n>1?"s":"")+" in total. Please select "+r+" more seat"+(r>1?"s.":".")),t=!1),$(".couple-seat.selected").length===1&&(EVO.order.steps.seats.coupleAlert||(EVO.Confirm("You have selected 1 couple seat. If you did not select the other couple seat next to this it may be occupied by another patron.<br/><br/>Do you wish to continue?",function(){EVO.order.steps.seats.coupleAlert=!0;u.trigger("click")}),t=!1)),t},populateSelectedSeats:function(){var n=$("#selected-seats").html(""),t=$("#seat-template");$(".seat-selection .seats .selected").each(function(){var i=$(this).data("seat");i&&n.prepend($.tmpl(t,i))})},ensureSelectedSeatsInView:function(){$(".seats-wrapper").each(function(n,t){var i=$(t),r=1e9,f=!1,u;$(".seat-row .selected",i).each(function(n,t){var i=$(t).offset().left;i<r&&(f=!0,r=i)});f&&(u=i.offset().left+i.width(),r>u&&i.scrollLeft(r-u+100))})}},fab:{init:function(){$('.step-content[data-step="fab"]').bind("response",function(n,t){EVO.order.steps.fab.response(t)});EVO.click(".operator",function(){var i=$(this),n=i.siblings("select"),t=n.prop("selectedIndex"),r;i.hasClass("plus")?(r=$("option",n).length,t<r-1&&n.prop("selectedIndex",t+1).trigger("change")):t>0&&n.prop("selectedIndex",t-1).trigger("change")})},response:function(n){var i=$("#fab-model-template"),t=EVO.order.steps.fab.table.find(".conc-wrapper").html("");if(n.ConcessionItems&&n.ConcessionItems.length>0){$.each(n.ConcessionItems,function(n,r){r.Guid=EVO.Guid();r.Group="OrderConcessionItems";t.append($.tmpl(i,r))});LazyLoadImages(null,{visibleOnly:!1});n.AdditionalClass&&t.addClass(n.AdditionalClass);$(".ticket-sub-total").data("total",n.TicketTotal);$(".ticket-sub-total .total").html(n.TicketTotal.toCurrency());EVO.order.steps.fab.table.trigger("change");EVO.order.steps.fab.updateTotals();EVO.order.steps.fab.table.on("change",'select[name$="Quantity"]',function(){EVO.order.steps.fab.updateTotals()})}},postaction:function(n){n.ConcessionItems&&n.ConcessionItems.length!==0||$(".step-content[data-step=fab] .btn.continue").trigger("click")},table:$("#concession-table"),updateTotals:function(){var n=0,t=[],i;$(".fab-details",EVO.order.steps.fab.table).each(function(i,r){var u=$(r),f=($("select",u).val()||0)*1,s=u.data("price"),e=f*s,o;n+=e;f>0&&(o=u.find(".name > span").text(),t.push({name:o,quantity:f,price:e}));$(".sub-total",u).html(e+f>0?e.toCurrency():"--")});i=parseFloat($(".ticket-sub-total").data("total"));$(".fab-sub-total .total").html(n.toCurrency());$(".final-total .total").html((i+n).toCurrency());EVO.order.addTicketsConcsToSummary(t,$(".session-details-wrapper .session-details .ticket-info .concs"))}},payment:{init:function(){$('.step-content[data-step="payment"]').bind("response",function(n,t){EVO.order.steps.payment.response(t)});$("body").on("change",".payments",function(){$(".payments .payment").each(function(n){n%2==1?$(this).addClass("even"):$(this).removeClass("even")})});$("#CardNumber").bind("validcardtype",function(n,t){$(".options img.active").inactive();var i=$("[data-id=CardNumber]");t?($(this).data("type",t.code),$("#CardTypeId").val(t.id),$('.options img[data-cardtypeid="'+t.id+'"]').active(),i.attr("data-selectedtype",t.code)):($(this).data("type",""),$("#CardTypeId").val(""),i.attr("data-selectedtype",""))});EVO.click(".payments .payment .payment-banner",function(){var n=$(this).closest(".payment"),t=n.isActive();$(".payments .payment").inactive();t||(n.active(),n.trigger("selected"))});EVO.click("[data-paymenttypeid]",function(){isTrue($(this).data("ignoreupdate"))||$("#SelectedPaymentType").val($(this).data("paymenttypeid"))},!0);EVO.click(".digital-btn",function(){$("form.payment-form").submit()});EVO.change('.eccheckbox[data-checkboxgroup="selectedStoredCard"]',function(n,t){if($("#SelectedStoredCard").val(t?$(this).data("id"):""),t){$(".card-details").hide();var i=$(".stored-cards").data("stored");$(".debit-cards .payment-banner").data("paymenttypeid",i);$("#SelectedPaymentType").val(i)}else $("#RevealNormal").trigger("click")});EVO.click("#RevealNormal",function(){$(".card-details").show();var n=$(".stored-cards").data("normal");$(".debit-cards .payment-banner").data("paymenttypeid",n);$("#SelectedPaymentType").val(n);$('.eccheckbox[data-checkboxgroup="selectedStoredCard"].active').inactive();$("#SelectedStoredCard").val("")});EVO.change("#OptinSignup_checkbox",function(n,t){$(".opt-dob").showHide(t)});$(".gift-card.payment").on("selected",function(){if(isTrue($(this).data("hasMemberGiftCards"))){var n=$(".member-gift-cards");if(n.isLoading())return;n.loading();EVO.cinebuzz.getUserGiftCards({success:function(t){var i=$(".member-gift-cards tbody"),r;i.html("");t.cards&&t.cards.length>0?(r=$("#member-giftcard-template"),$.each(t.cards,function(n,t){i.append($.tmpl(r,t))}),n.show()):n.hide();n.stopLoading()},error:function(n){EVO.Alert(n)}})}});$("body").on("keyup",".gc-amount",function(){delay(function(){EVO.order.steps.payment.updateTotals()},1e3)});EVO.click(".gift-card.payment .blue.btn",function(){var t=EVOValidate.getVoucherNo($("#GiftCardNumber").val()),i=$.trim($("#PIN").val()),n=[];t.length===0&&n.push("Card Number required");i.length===0?n.push("PIN required"):i.length!==4&&n.push("Invalid pin code");EVOValidate.testGiftCard(t)||n.push("Invalid Gift Card");n.length===0?EVO.post({url:"/Ticketing/GiftCard/Validate",data:{voucher:t,token:EVO.getState().token,pin:i,rememberGiftCard:$("#RememberGiftCard").isChecked()},success:function(n){n.Guid=EVO.Guid();$(".paymentgiftcards table tbody").append($.tmpl($("#paymentgiftcardtemplate"),n));$(".paymentgiftcards").show().get(0).scrollIntoView({behavior:"smooth",block:"start",inline:"start"});EVO.order.steps.payment.updateTotals(!0);$("#GiftCardNumber").val("");$("#PIN").val("")},error:function(n){EVO.Alert(n)},errorMessage:"Error processing voucher"}):EVO.Alert(n.join("<br/>"))});EVO.click(".use-member-card",function(){var n=$(this).data("cardnumber"),t=$(this).data("pin");$("#GiftCardNumber").setVal(n);$("#PIN").setVal(t);$("#RememberGiftCard").isChecked()&&$("#RememberGiftCard_checkbox").trigger("click");$(".gift-card.payment .blue.btn").trigger("click")});EVO.click(".innards .info",function(){var n=$(this).closest(".innards");EVO.Message("Info",n.find(".info-details").html())});$(".gift-card.payment .innards input").onEnterClick(".gift-card.payment .blue.btn");$(".debit-cards.payment .innards input").onEnterClick(".debit-cards.payment .continue.btn")},response:function(n){var t,o,r,u,f,s,h,i,e;n.OrderTotal&&$(".payment-total .total").html(n.OrderTotal.toCurrency());$(".payments .payment").each(function(n,t){n%2==1?$(t).addClass("even"):$(t).removeClass("even")});t=$(".payment-form");$("#CardNumber",t).data("validtypes",n.CardTypes);n.CardTypes&&(o=n.CardTypes.map(function(n){return n.id}),$("[data-cardtypeid]").each(function(n,t){var i=parseInt($(t).data("cardtypeid"));i&&$.inArray(i,o)!==-1||$(t).remove()}));n.PaymentTypes&&$("[data-paymenttypeid]").each(function(t,i){var u=parseInt($(i).data("paymenttypeid")),r;u&&$.inArray(u,n.PaymentTypes)!==-1||(r=$(i).data("subpaymenttypeid"),r&&$.inArray(r,n.PaymentTypes)!==-1?$(".payment.debit-cards").data("subpayment-required",!0):$(i).remove())});$("#Name",t).setVal(n.CustomerName);$("#Email",t).setVal(n.CustomerEmail);$("#Mobile",t).setVal(n.CustomerMobile);$(".payments .payment .options").each(function(n,t){$(">*",t).length===0&&$(t).closest(".payment").remove()});r=$("#visacheckout");r.length>0&&$("body").append($.tmpl(r,{}));isTrue(n.ShowMobile)&&$(".mobile").show();u=$("#masterpass");u.length>0&&$("body").append($.tmpl(u,{}));f=$("#paypal-context");f.length>0&&$("body").append($.tmpl(f,n));$(".paymentgiftcards table tbody").html("");n.GiftCards&&n.GiftCards.length>0&&(s=$("#paymentgiftcardtemplate"),$.each(n.GiftCards,function(n,t){t.Guid=EVO.Guid();$(".paymentgiftcards table tbody").append($.tmpl(s,t))}),$(".paymentgiftcards .gc-amount").numeric());isTrue(n.ShowRememberMe)&&$(".remember-me").show();$(".gift-card.payment").data("hasMemberGiftCards",n.hasMemberGiftCards);n.UserStoredCards&&n.UserStoredCards.length>0&&(h=$("#storedcardtemplate"),i=$(".stored-cards-items"),i.find(".eccheckbox").remove(),$.each(n.UserStoredCards,function(n,t){t.Guid=EVO.Guid();i.append($.tmpl(h,t))}),$(".stored-cards").show(),i.find(".eccheckbox:first").trigger("click"),$(".card-details").hide(),$(".debit-cards .payment-banner").data("paymenttypeid","5").trigger("click"));isTrue(n.hasCinebuzzAlready)&&$(".optin-signup").hide();e=$(".payment-banner");e.length===1&&e.trigger("click");EVO.order.steps.payment.table.trigger("change");EVO.order.steps.payment.updateTotals(!0);EVO.order.setPaymentStarting()},validate:function(n){var t=n.valid(),r,i;return t&&(r=parseInt($(".remaining-total .total").data("remaining")),!isNaN(r)&&r>0&&(i=$("#SelectedPaymentType").val(),i&&i!=="0"?i==="1"&&($(".payment.debit-cards").isActive()||($(".payment.debit-cards .payment-banner").trigger("click"),t=n.valid()),isTrue($(".payment.debit-cards").data("subpayment-required"))&&!$("#RememberCreditCard").isChecked()&&($(".remember-me").append('<span class="field-validation-error"><span>To redeem this offer, you must choose to store your credit card. To proceed without storing, please select an alternate ticket to purchase<\/span><\/span>'),t=!1)):(t=!1,EVO.Alert("Please select a payment type")))),t&&EVO.order.pauseTimer(),t},updateTotals:function(n){var t=parseFloat($(".payment-total .total").html().replace("$","")),i;if(isNaN(t)&&(t=0),i=[],$(".paymentgiftcards .gc-amount").each(function(n,r){var u,f,e;$(".paymentgiftcards").show();u=parseFloat($(r).val());f=$(r).data("available");isNaN(u)?i.push("Please enter a valid number"):u<0?i.push("Amount allocated must be greater than 0 and less than $"+f.toFixed(2)):u>f?i.push("You do not have sufficient funds on the gift card."):(t-=u,$(r).val(u.toFixed(2)),e=$(r).data("lastval"),e!==u&&($(r).data("lastval",u),EVO.post({url:"/Ticketing/GiftCard/UpdateAmount",data:{token:EVO.getState().token,paymentId:$(r).data("id"),amount:u},error:function(n){EVO.Alert(n)},errorMessage:"Error updating gift card amount on server"})))}),t<0&&i.push("You have allocated too much money from the gift cards"),i.length>0)return $(".remaining-total .total").html("--"),EVO.Alert(i.join("<br />")),!1;n?($(".paymentgiftcards .gc-amount").each(function(n,i){var u=parseFloat($(i).val()),f=$(i).data("available"),r;u===0&&(r=Math.min(t,f),r!==u&&($(i).val(r),t-=r))}),EVO.order.steps.payment.updateTotals()):(t===0?($(".payments").hide(),$(".zerobalance-complete").show()):($(".payments").show(),$(".zerobalance-complete").hide()),$(".remaining-total .total").data("remaining",t),$(".remaining-total .total").html(t.toCurrency()))},table:$(".payments"),paypalContext:function(n){return window.paypalCheckoutReady=function(){$(".paypal-btn").hide();$("#paypal-btn").show();paypal.checkout.setup(n,{environment:$("#paypal-incontext-container").data("env"),container:"paypal-incontext-container",click:function(n){n.preventDefault();var t=$("form.payment-form");$("#SelectedPaymentType").val($("#paypal-incontext-container").data("paymenttypeid"));paypal.checkout.initXO();EVO.post({url:t.attr("action"),data:t.serialize(),success:function(n){paypal.checkout.startFlow(n.Redirect)},error:function(n){paypal.checkout.closeFlow();EVO.Alert(n)},errorMessage:"Error connecting to Paypal"})},condition:function(){return $("#SelectedPaymentType").val($("#paypal-incontext-container").data("paymenttypeid")),$("body.addon").length>0?EVO.addon.validate($("form.payment-form")):EVO.order.steps.payment.validate($("form.payment-form"))},button:"paypal-btn"})},""}},confirm:{init:function(){$('.step-content[data-step="confirm"]').bind("response",function(n,t){$(this).html(t.html);EVO.storage.remove("evo_abandon");var i=EVO.preferences.getFaveCinema();i||EVO.preferences.setFaveCinema(t.cinema);typeof dataLayer!="undefined"&&(EVO.order.sendTrans(function(){dataLayer.push({event:"paymentconfirmation"})}),dataLayer.push({event:"confirmationok"}));new Clipboard(".copy-btn")})}},updateTicketQuantity:function(){var e=0,u=[],o=[],f=0,l=0,s=0,h=[],t,n,i,c,r;for($("tbody tr",EVO.order.steps.tickets.table).each(function(n,t){var r=$(t),i=($("select",r).val()||0)*1,p=r.data("price"),o=i*p,y,c,a,v;if(e+=o,i>0){for(y=r.find(".name > span").text(),$(this).data("category")==="ticket"&&(c=$(this).data("pointscost"),(!c||isNaN(c)||c===0)&&(s+=i),l+=i),a=r.data("bookigfee"),v=i*a,f+=v,e+=v,n=0;n<i;n++)u.push(a);h.push({name:y,quantity:i,price:o})}$(".sub-total",r).html(o+i>0?o.toCurrency():"--")}),u.sort(),t=1,n=0,i=0,c=u.length;i<c;i++)r=u[i],r>0&&n!==r&&(n>0&&o.push(t-1+"x "+n.toCurrency()),n=r,t=1),n>0&&i===c-1&&o.push(t+"x "+r.toCurrency()),t++;l>0&&s===0?$(".cinebuzz-section").hide():$(".cinebuzz-section").show();$('.additional-numbers input[name^="MemberCards"]').each(function(n){n+1<s?$(this).show():$(this).hide()});$(".ticket-totals .booking-fees .bf-fee").html(o.join());$(".ticket-totals .booking-fees .total").html(f.toCurrency());$(".ticket-totals .total-price .total").html(e.toCurrency());f>0&&h.push({name:"Booking Fee",price:f});EVO.order.addTicketsConcsToSummary(h,$(".session-details-wrapper .session-details .ticket-info .tickets"))}};EVOValidate={Regex:{re:new RegExp("[g]+[0-9]+[a-z]"),giftc:new RegExp("[9]+[0]+[3]+[6]"),nzoldgiftc:new RegExp("^(60001[0-9]{9})"),nzgiftc:new RegExp("^(60001[0-9]{7})"),nzgiftc2:new RegExp("([8][0][0][0][0-9]{10})"),mbf:new RegExp("[g]+[0-1]+[e]+[0]+[1-2]"),nzoldvc:new RegExp("^(50[5,6][0-9][0-9])"),nzvc:new RegExp("[n]+[0145]+[a-z]+[0-9]+[0-9]"),village:new RegExp("[v]+[0-9]"),village2:new RegExp("^[c]{1}[0-9a-z]{11}$"),cinebuzz:new RegExp("^[8][0][0][0-9]{9}$")},showPin:function(n){return EVOValidate.Regex.giftc.test(n)&&n.length===19||EVOValidate.Regex.nzgiftc.test(n)&&n.length===12||EVOValidate.Regex.nzgiftc2.test(n)&&n.length===14||(EVOValidate.Regex.re.test(n)||EVOValidate.Regex.mbf.test(n))&&n.length>=5||EVOValidate.Regex.nzvc.test(n)&&n.length===12||EVOValidate.Regex.village2.test(n)||EVOValidate.Regex.village.test(n)&&n.length===12},testGiftCard:function(n){return EVOValidate.Regex.giftc.test(n)&&n.length===19||EVOValidate.Regex.nzgiftc.test(n)||EVOValidate.Regex.nzgiftc2.test(n)},getVoucherNo:function(n){return n=n||"",n=$.trim(n.toLowerCase()),n.indexOf("30866")===0&&(n=n.substring(5)),n}};V=V||{}